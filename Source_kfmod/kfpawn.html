<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<title>UnCodeX - Source: KFMod.KFPawn</title>
	<meta name="Generator" content="UnCodeX 241" />
	<link rel="stylesheet" href="../DocStyle2.css" type="text/css" title="Original Purple" />
	<link rel="alternative stylesheet" href="../DocStyle2-blue.css" type="text/css" title="Blue" />
	<link rel="alternative stylesheet" href="../DocStyle2-red.css" type="text/css" title="Red" />
	<!--[if IE]>
	<link rel="stylesheet" href="../DocStyle2-msie.css" type="text/css" />
	<![endif]-->
	<script src="../styleswitcher.js" type="text/javascript"></script>
</head>
<body>

<div class="header">
<table class="header">
<tr class="header">
	<td class="header"><a href="../overview.html">Overview</a></td>
	<td class="header"><a href="../kfmod/kfmod-overview.html">Package</a></td>
	<td class="header"><a href="../kfmod/kfpawn.html">Class</a></td>
	<td class="header_hilight">Source</td>
	<td class="header"><a class="header" href="../classtree.html#KFPawn">Class tree</a></td>
	<td class="header"><a class="header" href="../glossary_A.html">Glossary</a></td>
	<td class="logo" rowspan="2">UnrealScript<br />Documentation</td>
</tr>
<tr>
	<td class="subheader" colspan="3"><a href="../Source_kfmod/kfonlinelostrigger.html">previous class</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="../Source_kfmod/kfpawnfootadjuster.html">next class</a></td>
	<td class="subheader" colspan="2"><a href="../index.html#Source_kfmod/kfpawn.html" target="_top">frames</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="" target="_top">no frames</a></td>
</tr>
</table>
</div>
<div class="spacer"></div>

<h1><a href="../kfmod/kfmod-overview.html">KFMod</a>.<a href="../kfmod/kfpawn.html">KFPawn</a></h1>
<br />
<div class="source"><table class="source"><tr><td class="source_lineno"><span class="source_lineno">00001<br />00002<br />00003<br />00004<br />00005<br />00006<br />00007<br />00008<br />00009<br />00010<br />00011<br />00012<br />00013<br />00014<br />00015<br />00016<br />00017<br />00018<br />00019<br />00020<br />
00021<br />00022<br />00023<br />00024<br />00025<br />00026<br />00027<br />00028<br />00029<br />00030<br />00031<br />00032<br />00033<br />00034<br />00035<br />00036<br />00037<br />00038<br />00039<br />00040<br />
00041<br />00042<br />00043<br />00044<br />00045<br />00046<br />00047<br />00048<br />00049<br />00050<br />00051<br />00052<br />00053<br />00054<br />00055<br />00056<br />00057<br />00058<br />00059<br />00060<br />
00061<br />00062<br />00063<br />00064<br />00065<br />00066<br />00067<br />00068<br />00069<br />00070<br />00071<br />00072<br />00073<br />00074<br />00075<br />00076<br />00077<br />00078<br />00079<br />00080<br />
00081<br />00082<br />00083<br />00084<br />00085<br />00086<br />00087<br />00088<br />00089<br />00090<br />00091<br />00092<br />00093<br />00094<br />00095<br />00096<br />00097<br />00098<br />00099<br />00100<br />
00101<br />00102<br />00103<br />00104<br />00105<br />00106<br />00107<br />00108<br />00109<br />00110<br />00111<br />00112<br />00113<br />00114<br />00115<br />00116<br />00117<br />00118<br />00119<br />00120<br />
00121<br />00122<br />00123<br />00124<br />00125<br />00126<br />00127<br />00128<br />00129<br />00130<br />00131<br />00132<br />00133<br />00134<br />00135<br />00136<br />00137<br />00138<br />00139<br />00140<br />
00141<br />00142<br />00143<br />00144<br />00145<br />00146<br />00147<br />00148<br />00149<br />00150<br />00151<br />00152<br />00153<br />00154<br />00155<br />00156<br />00157<br />00158<br />00159<br />00160<br />
00161<br />00162<br />00163<br />00164<br />00165<br />00166<br />00167<br />00168<br />00169<br />00170<br />00171<br />00172<br />00173<br />00174<br />00175<br />00176<br />00177<br />00178<br />00179<br />00180<br />
00181<br />00182<br />00183<br />00184<br />00185<br />00186<br />00187<br />00188<br />00189<br />00190<br />00191<br />00192<br />00193<br />00194<br />00195<br />00196<br />00197<br />00198<br />00199<br />00200<br />
00201<br />00202<br />00203<br />00204<br />00205<br />00206<br />00207<br />00208<br />00209<br />00210<br />00211<br />00212<br />00213<br />00214<br />00215<br />00216<br />00217<br />00218<br />00219<br />00220<br />
00221<br />00222<br />00223<br />00224<br />00225<br />00226<br />00227<br />00228<br />00229<br />00230<br />00231<br />00232<br />00233<br />00234<br />00235<br />00236<br />00237<br />00238<br />00239<br />00240<br />
00241<br />00242<br />00243<br />00244<br />00245<br />00246<br />00247<br />00248<br />00249<br />00250<br />00251<br />00252<br />00253<br />00254<br />00255<br />00256<br />00257<br />00258<br />00259<br />00260<br />
00261<br />00262<br />00263<br />00264<br />00265<br />00266<br />00267<br />00268<br />00269<br />00270<br />00271<br />00272<br />00273<br />00274<br />00275<br />00276<br />00277<br />00278<br />00279<br />00280<br />
00281<br />00282<br />00283<br />00284<br />00285<br />00286<br />00287<br />00288<br />00289<br />00290<br />00291<br />00292<br />00293<br />00294<br />00295<br />00296<br />00297<br />00298<br />00299<br />00300<br />
00301<br />00302<br />00303<br />00304<br />00305<br />00306<br />00307<br />00308<br />00309<br />00310<br />00311<br />00312<br />00313<br />00314<br />00315<br />00316<br />00317<br />00318<br />00319<br />00320<br />
00321<br />00322<br />00323<br />00324<br />00325<br />00326<br />00327<br />00328<br />00329<br />00330<br />00331<br />00332<br />00333<br />00334<br />00335<br />00336<br />00337<br />00338<br />00339<br />00340<br />
00341<br />00342<br />00343<br />00344<br />00345<br />00346<br />00347<br />00348<br />00349<br />00350<br />00351<br />00352<br />00353<br />00354<br />00355<br />00356<br />00357<br />00358<br />00359<br />00360<br />
00361<br />00362<br />00363<br />00364<br />00365<br />00366<br />00367<br />00368<br />00369<br />00370<br />00371<br />00372<br />00373<br />00374<br />00375<br />00376<br />00377<br />00378<br />00379<br />00380<br />
00381<br />00382<br />00383<br />00384<br />00385<br />00386<br />00387<br />00388<br />00389<br />00390<br />00391<br />00392<br />00393<br />00394<br />00395<br />00396<br />00397<br />00398<br />00399<br />00400<br />
00401<br />00402<br />00403<br />00404<br />00405<br />00406<br />00407<br />00408<br />00409<br />00410<br />00411<br />00412<br />00413<br />00414<br />00415<br />00416<br />00417<br />00418<br />00419<br />00420<br />
00421<br />00422<br />00423<br />00424<br />00425<br />00426<br />00427<br />00428<br />00429<br />00430<br />00431<br />00432<br />00433<br />00434<br />00435<br />00436<br />00437<br />00438<br />00439<br />00440<br />
00441<br />00442<br />00443<br />00444<br />00445<br />00446<br />00447<br />00448<br />00449<br />00450<br />00451<br />00452<br />00453<br />00454<br />00455<br />00456<br />00457<br />00458<br />00459<br />00460<br />
00461<br />00462<br />00463<br />00464<br />00465<br />00466<br />00467<br />00468<br />00469<br />00470<br />00471<br />00472<br />00473<br />00474<br />00475<br />00476<br />00477<br />00478<br />00479<br />00480<br />
00481<br />00482<br />00483<br />00484<br />00485<br />00486<br />00487<br />00488<br />00489<br />00490<br />00491<br />00492<br />00493<br />00494<br />00495<br />00496<br />00497<br />00498<br />00499<br />00500<br />
00501<br />00502<br />00503<br />00504<br />00505<br />00506<br />00507<br />00508<br />00509<br />00510<br />00511<br />00512<br />00513<br />00514<br />00515<br />00516<br />00517<br />00518<br />00519<br />00520<br />
00521<br />00522<br />00523<br />00524<br />00525<br />00526<br />00527<br />00528<br />00529<br />00530<br />00531<br />00532<br />00533<br />00534<br />00535<br />00536<br />00537<br />00538<br />00539<br />00540<br />
00541<br />00542<br />00543<br />00544<br />00545<br />00546<br />00547<br />00548<br />00549<br />00550<br />00551<br />00552<br />00553<br />00554<br />00555<br />00556<br />00557<br />00558<br />00559<br />00560<br />
00561<br />00562<br />00563<br />00564<br />00565<br />00566<br />00567<br />00568<br />00569<br />00570<br />00571<br />00572<br />00573<br />00574<br />00575<br />00576<br />00577<br />00578<br />00579<br />00580<br />
00581<br />00582<br />00583<br />00584<br />00585<br />00586<br />00587<br />00588<br />00589<br />00590<br />00591<br />00592<br />00593<br />00594<br />00595<br />00596<br />00597<br />00598<br />00599<br />00600<br />
00601<br />00602<br />00603<br />00604<br />00605<br />00606<br />00607<br />00608<br />00609<br />00610<br />00611<br />00612<br />00613<br />00614<br />00615<br />00616<br />00617<br />00618<br />00619<br />00620<br />
00621<br />00622<br />00623<br />00624<br />00625<br />00626<br />00627<br />00628<br />00629<br />00630<br />00631<br />00632<br />00633<br />00634<br />00635<br />00636<br />00637<br />00638<br />00639<br />00640<br />
00641<br />00642<br />00643<br />00644<br />00645<br />00646<br />00647<br />00648<br />00649<br />00650<br />00651<br />00652<br />00653<br />00654<br />00655<br />00656<br />00657<br />00658<br />00659<br />00660<br />
00661<br />00662<br />00663<br />00664<br />00665<br />00666<br />00667<br />00668<br />00669<br />00670<br />00671<br />00672<br />00673<br />00674<br />00675<br />00676<br />00677<br />00678<br />00679<br />00680<br />
00681<br />00682<br />00683<br />00684<br />00685<br />00686<br />00687<br />00688<br />00689<br />00690<br />00691<br />00692<br />00693<br />00694<br />00695<br />00696<br />00697<br />00698<br />00699<br />00700<br />
00701<br />00702<br />00703<br />00704<br />00705<br />00706<br />00707<br />00708<br />00709<br />00710<br />00711<br />00712<br />00713<br />00714<br />00715<br />00716<br />00717<br />00718<br />00719<br />00720<br />
00721<br />00722<br />00723<br />00724<br />00725<br />00726<br />00727<br />00728<br />00729<br />00730<br />00731<br />00732<br />00733<br />00734<br />00735<br />00736<br />00737<br />00738<br />00739<br />00740<br />
00741<br />00742<br />00743<br />00744<br />00745<br />00746<br />00747<br />00748<br />00749<br />00750<br />00751<br />00752<br />00753<br />00754<br />00755<br />00756<br />00757<br />00758<br />00759<br />00760<br />
00761<br />00762<br />00763<br />00764<br />00765<br />00766<br />00767<br />00768<br />00769<br />00770<br />00771<br />00772<br />00773<br />00774<br />00775<br />00776<br />00777<br />00778<br />00779<br />00780<br />
00781<br />00782<br />00783<br />00784<br />00785<br />00786<br />00787<br />00788<br />00789<br />00790<br />00791<br />00792<br />00793<br />00794<br />00795<br />00796<br />00797<br />00798<br />00799<br />00800<br />
00801<br />00802<br />00803<br />00804<br />00805<br />00806<br />00807<br />00808<br />00809<br />00810<br />00811<br />00812<br />00813<br />00814<br />00815<br />00816<br />00817<br />00818<br />00819<br />00820<br />
00821<br />00822<br />00823<br />00824<br />00825<br />00826<br />00827<br />00828<br />00829<br />00830<br />00831<br />00832<br />00833<br />00834<br />00835<br />00836<br />00837<br />00838<br />00839<br />00840<br />
00841<br />00842<br />00843<br />00844<br />00845<br />00846<br />00847<br />00848<br />00849<br />00850<br />00851<br />00852<br />00853<br />00854<br />00855<br />00856<br />00857<br />00858<br />00859<br />00860<br />
00861<br />00862<br />00863<br />00864<br />00865<br />00866<br />00867<br />00868<br />00869<br />00870<br />00871<br />00872<br />00873<br />00874<br />00875<br />00876<br />00877<br />00878<br />00879<br />00880<br />
00881<br />00882<br />00883<br />00884<br />00885<br />00886<br />00887<br />00888<br />00889<br />00890<br />00891<br />00892<br />00893<br />00894<br />00895<br />00896<br />00897<br />00898<br />00899<br />00900<br />
00901<br />00902<br />00903<br />00904<br />00905<br />00906<br />00907<br />00908<br />00909<br />00910<br />00911<br />00912<br />00913<br />00914<br />00915<br />00916<br />00917<br />00918<br />00919<br />00920<br />
00921<br />00922<br />00923<br />00924<br />00925<br />00926<br />00927<br />00928<br />00929<br />00930<br />00931<br />00932<br />00933<br />00934<br />00935<br />00936<br />00937<br />00938<br />00939<br />00940<br />
00941<br />00942<br />00943<br />00944<br />00945<br />00946<br />00947<br />00948<br />00949<br />00950<br />00951<br />00952<br />00953<br />00954<br />00955<br />00956<br />00957<br />00958<br />00959<br />00960<br />
00961<br />00962<br />00963<br />00964<br />00965<br />00966<br />00967<br />00968<br />00969<br />00970<br />00971<br />00972<br />00973<br />00974<br />00975<br />00976<br />00977<br />00978<br />00979<br />00980<br />
00981<br />00982<br />00983<br />00984<br />00985<br />00986<br />00987<br />00988<br />00989<br />00990<br />00991<br />00992<br />00993<br />00994<br />00995<br />00996<br />00997<br />00998<br />00999<br />01000<br />
01001<br />01002<br />01003<br />01004<br />01005<br />01006<br />01007<br />01008<br />01009<br />01010<br />01011<br />01012<br />01013<br />01014<br />01015<br />01016<br />01017<br />01018<br />01019<br />01020<br />
01021<br />01022<br />01023<br />01024<br />01025<br />01026<br />01027<br />01028<br />01029<br />01030<br />01031<br />01032<br />01033<br />01034<br />01035<br />01036<br />01037<br />01038<br />01039<br />01040<br />
01041<br />01042<br />01043<br />01044<br />01045<br />01046<br />01047<br />01048<br />01049<br />01050<br />01051<br />01052<br />01053<br />01054<br />01055<br />01056<br />01057<br />01058<br />01059<br />01060<br />
01061<br />01062<br />01063<br />01064<br />01065<br />01066<br />01067<br />01068<br />01069<br />01070<br />01071<br />01072<br />01073<br />01074<br />01075<br />01076<br />01077<br />01078<br />01079<br />01080<br />
01081<br />01082<br />01083<br />01084<br />01085<br />01086<br />01087<br />01088<br />01089<br />01090<br />01091<br />01092<br />01093<br />01094<br />01095<br />01096<br />01097<br />01098<br />01099<br />01100<br />
01101<br />01102<br />01103<br />01104<br />01105<br />01106<br />01107<br />01108<br />01109<br />01110<br />01111<br />01112<br />01113<br />01114<br />01115<br />01116<br />01117<br />01118<br />01119<br />01120<br />
01121<br />01122<br />01123<br />01124<br />01125<br />01126<br />01127<br />01128<br />01129<br />01130<br />01131<br />01132<br />01133<br />01134<br />01135<br />01136<br />01137<br />01138<br />01139<br />01140<br />
01141<br />01142<br />01143<br />01144<br />01145<br />01146<br />01147<br />01148<br />01149<br />01150<br />01151<br />01152<br />01153<br />01154<br />01155<br />01156<br />01157<br />01158<br />01159<br />01160<br />
01161<br />01162<br />01163<br />01164<br />01165<br />01166<br />01167<br />01168<br />01169<br />01170<br />01171<br />01172<br />01173<br />01174<br />01175<br />01176<br />01177<br />01178<br />01179<br />01180<br />
01181<br />01182<br />01183<br />01184<br />01185<br />01186<br />01187<br />01188<br />01189<br />01190<br />01191<br />01192<br />01193<br />01194<br />01195<br />01196<br />01197<br />01198<br />01199<br />01200<br />
01201<br />01202<br />01203<br />01204<br />01205<br />01206<br />01207<br />01208<br />01209<br />01210<br />01211<br />01212<br />01213<br />01214<br />01215<br />01216<br />01217<br />01218<br />01219<br />01220<br />
01221<br />01222<br />01223<br />01224<br />01225<br />01226<br />01227<br />01228<br />01229<br />01230<br />01231<br />01232<br />01233<br />01234<br />01235<br />01236<br />01237<br />01238<br />01239<br />01240<br />
01241<br />01242<br />01243<br />01244<br />01245<br />01246<br />01247<br />01248<br />01249<br />01250<br />01251<br />01252<br />01253<br />01254<br />01255<br />01256<br />01257<br />01258<br />01259<br />01260<br />
01261<br />01262<br />01263<br />01264<br />01265<br />01266<br />01267<br />01268<br />01269<br />01270<br />01271<br />01272<br />01273<br />01274<br />01275<br />01276<br />01277<br />01278<br />01279<br />01280<br />
01281<br />01282<br />01283<br />01284<br />01285<br />01286<br />01287<br />01288<br />01289<br />01290<br />01291<br />01292<br />01293<br />01294<br />01295<br />01296<br />01297<br />01298<br />01299<br />01300<br />
01301<br />01302<br />01303<br />01304<br />01305<br />01306<br />01307<br />01308<br />01309<br />01310<br />01311<br />01312<br />01313<br />01314<br />01315<br />01316<br />01317<br />01318<br />01319<br />01320<br />
01321<br />01322<br />01323<br />01324<br />01325<br />01326<br />01327<br />01328<br />01329<br />01330<br />01331<br />01332<br />01333<br />01334<br />01335<br />01336<br />01337<br />01338<br />01339<br />01340<br />
01341<br />01342<br />01343<br />01344<br />01345<br />01346<br />01347<br />01348<br />01349<br />01350<br />01351<br />01352<br />01353<br />01354<br />01355<br />01356<br />01357<br />01358<br />01359<br />01360<br />
01361<br />01362<br />01363<br />01364<br />01365<br />01366<br />01367<br />01368<br />01369<br />01370<br />01371<br />01372<br />01373<br />01374<br />01375<br />01376<br />01377<br />01378<br />01379<br />01380<br />
01381<br />01382<br />01383<br />01384<br />01385<br />01386<br />01387<br />01388<br />01389<br />01390<br />01391<br />01392<br />01393<br />01394<br />01395<br />01396<br />01397<br />01398<br />01399<br />01400<br />
01401<br />01402<br />01403<br />01404<br />01405<br />01406<br />01407<br />01408<br />01409<br />01410<br />01411<br />01412<br />01413<br />01414<br />01415<br />01416<br />01417<br />01418<br />01419<br />01420<br />
01421<br />01422<br />01423<br />01424<br />01425<br />01426<br />01427<br />01428<br />01429<br />01430<br />01431<br />01432<br />01433<br />01434<br />01435<br />01436<br />01437<br />01438<br />01439<br />01440<br />
01441<br />01442<br />01443<br />01444<br />01445<br />01446<br />01447<br />01448<br />01449<br />01450<br />01451<br />01452<br />01453<br />01454<br />01455<br />01456<br />01457<br />01458<br />01459<br />01460<br />
01461<br />01462<br />01463<br />01464<br />01465<br />01466<br />01467<br />01468<br />01469<br />01470<br />01471<br />01472<br />01473<br />01474<br />01475<br />01476<br />01477<br />01478<br />01479<br />01480<br />
01481<br />01482<br />01483<br />01484<br />01485<br />01486<br />01487<br />01488<br />01489<br />01490<br />01491<br />01492<br />01493<br />01494<br />01495<br />01496<br />01497<br />01498<br />01499<br />01500<br />
01501<br />01502<br />01503<br />01504<br />01505<br />01506<br />01507<br />01508<br />01509<br />01510<br />01511<br />01512<br />01513<br />01514<br />01515<br />01516<br />01517<br />01518<br />01519<br />01520<br />
01521<br />01522<br />01523<br />01524<br />01525<br />01526<br />01527<br />01528<br />01529<br />01530<br />01531<br />01532<br />01533<br />01534<br />01535<br />01536<br />01537<br />01538<br />01539<br />01540<br />
01541<br />01542<br />01543<br />01544<br />01545<br />01546<br />01547<br />01548<br />01549<br />01550<br />01551<br />01552<br />01553<br />01554<br />01555<br />01556<br />01557<br />01558<br />01559<br />01560<br />
01561<br />01562<br />01563<br />01564<br />01565<br />01566<br />01567<br />01568<br />01569<br />01570<br />01571<br />01572<br />01573<br />01574<br />01575<br />01576<br />01577<br />01578<br />01579<br />01580<br />
01581<br />01582<br />01583<br />01584<br />01585<br />01586<br />01587<br />01588<br />01589<br />01590<br />01591<br />01592<br />01593<br />01594<br />01595<br />01596<br />01597<br />01598<br />01599<br />01600<br />
01601<br />01602<br />01603<br />01604<br />01605<br />01606<br />01607<br />01608<br />01609<br />01610<br />01611<br />01612<br />01613<br />01614<br />01615<br />01616<br />01617<br />01618<br />01619<br />01620<br />
01621<br />01622<br />01623<br />01624<br />01625<br />01626<br />01627<br />01628<br />01629<br />01630<br />01631<br />01632<br />01633<br />01634<br />01635<br />01636<br />01637<br />01638<br />01639<br />01640<br />
01641<br />01642<br />01643<br />01644<br />01645<br />01646<br />01647<br />01648<br />01649<br />01650<br />01651<br />01652<br />01653<br />01654<br />01655<br />01656<br />01657<br />01658<br />01659<br />01660<br />
01661<br />01662<br />01663<br />01664<br />01665<br />01666<br />01667<br />01668<br />01669<br />01670<br />01671<br />01672<br />01673<br />01674<br />01675<br />01676<br />01677<br />01678<br />01679<br />01680<br />
01681<br />01682<br />01683<br />01684<br />01685<br />01686<br />01687<br />01688<br />01689<br />01690<br />01691<br />01692<br />01693<br />01694<br />01695<br />01696<br />01697<br />01698<br />01699<br />01700<br />
01701<br />01702<br />01703<br />01704<br />01705<br />01706<br />01707<br />01708<br />01709<br />01710<br />01711<br />01712<br />01713<br />01714<br />01715<br />01716<br />01717<br />01718<br />01719<br />01720<br />
01721<br />01722<br />01723<br />01724<br />01725<br />01726<br />01727<br />01728<br />01729<br />01730<br />01731<br />01732<br />01733<br />01734<br />01735<br />01736<br />01737<br />01738<br />01739<br />01740<br />
01741<br />01742<br />01743<br />01744<br />01745<br />01746<br />01747<br />01748<br />01749<br />01750<br />01751<br />01752<br />01753<br />01754<br />01755<br />01756<br />01757<br />01758<br />01759<br />01760<br />
01761<br />01762<br />01763<br />01764<br />01765<br />01766<br />01767<br />01768<br />01769<br />01770<br />01771<br />01772<br />01773<br />01774<br />01775<br />01776<br />01777<br />01778<br />01779<br />01780<br />
01781<br />01782<br />01783<br />01784<br />01785<br />01786<br />01787<br />01788<br />01789<br />01790<br />01791<br />01792<br />01793<br />01794<br />01795<br />01796<br />01797<br />01798<br />01799<br />01800<br />
01801<br />01802<br />01803<br />01804<br />01805<br />01806<br />01807<br />01808<br />01809<br />01810<br />01811<br />01812<br />01813<br />01814<br />01815<br />01816<br />01817<br />01818<br />01819<br />01820<br />
01821<br />01822<br />01823<br />01824<br />01825<br />01826<br />01827<br />01828<br />01829<br />01830<br />01831<br />01832<br />01833<br />01834<br />01835<br />01836<br />01837<br />01838<br />01839<br />01840<br />
01841<br />01842<br />01843<br />01844<br />01845<br />01846<br />01847<br />01848<br />01849<br />01850<br />01851<br />01852<br />01853<br />01854<br />01855<br />01856<br />01857<br />01858<br />01859<br />01860<br />
01861<br />01862<br />01863<br />01864<br />01865<br />01866<br />01867<br />01868<br />01869<br />01870<br />01871<br />01872<br />01873<br />01874<br />01875<br />01876<br />01877<br />01878<br />01879<br />01880<br />
01881<br />01882<br />01883<br />01884<br />01885<br />01886<br />01887<br />01888<br />01889<br />01890<br />01891<br />01892<br />01893<br />01894<br />01895<br />01896<br />01897<br />01898<br />01899<br />01900<br />
01901<br />01902<br />01903<br />01904<br />01905<br />01906<br />01907<br />01908<br />01909<br />01910<br />01911<br />01912<br />01913<br />01914<br />01915<br />01916<br />01917<br />01918<br />01919<br />01920<br />
01921<br />01922<br />01923<br />01924<br />01925<br />01926<br />01927<br />01928<br />01929<br />01930<br />01931<br />01932<br />01933<br />01934<br />01935<br />01936<br />01937<br />01938<br />01939<br />01940<br />
01941<br />01942<br />01943<br />01944<br />01945<br />01946<br />01947<br />01948<br />01949<br />01950<br />01951<br />01952<br />01953<br />01954<br />01955<br />01956<br />01957<br />01958<br />01959<br />01960<br />
01961<br />01962<br />01963<br />01964<br />01965<br />01966<br />01967<br />01968<br />01969<br />01970<br />01971<br />01972<br />01973<br />01974<br />01975<br />01976<br />01977<br />01978<br />01979<br />01980<br />
01981<br />01982<br />01983<br />01984<br />01985<br />01986<br />01987<br />01988<br />01989<br />01990<br />01991<br />01992<br />01993<br />01994<br />01995<br />01996<br />01997<br />01998<br />01999<br />02000<br />
02001<br />02002<br />02003<br />02004<br />02005<br />02006<br />02007<br />02008<br />02009<br />02010<br />02011<br />02012<br />02013<br />02014<br />02015<br />02016<br />02017<br />02018<br />02019<br />02020<br />
02021<br />02022<br />02023<br />02024<br />02025<br />02026<br />02027<br />02028<br />02029<br />02030<br />02031<br />02032<br />02033<br />02034<br />02035<br />02036<br />02037<br />02038<br />02039<br />02040<br />
02041<br />02042<br />02043<br />02044<br />02045<br />02046<br />02047<br />02048<br />02049<br />02050<br />02051<br />02052<br />02053<br />02054<br />02055<br />02056<br />02057<br />02058<br />02059<br />02060<br />
02061<br />02062<br />02063<br />02064<br />02065<br />02066<br />02067<br />02068<br />02069<br />02070<br />02071<br />02072<br />02073<br />02074<br />02075<br />02076<br />02077<br />02078<br />02079<br />02080<br />
02081<br />02082<br />02083<br />02084<br />02085<br />02086<br />02087<br />02088<br />02089<br />02090<br />02091<br />02092<br />02093<br />02094<br />02095<br />02096<br />02097<br />02098<br />02099<br />02100<br />
02101<br />02102<br />02103<br />02104<br />02105<br />02106<br />02107<br />02108<br />02109<br />02110<br />02111<br />02112<br />02113<br />02114<br />02115<br />02116<br />02117<br />02118<br />02119<br />02120<br />
02121<br />02122<br />02123<br />02124<br />02125<br />02126<br />02127<br />02128<br />02129<br />02130<br />02131<br />02132<br />02133<br />02134<br />02135<br />02136<br />02137<br />02138<br />02139<br />02140<br />
02141<br />02142<br />02143<br />02144<br />02145<br />02146<br />02147<br />02148<br />02149<br />02150<br />02151<br />02152<br />02153<br />02154<br />02155<br />02156<br />02157<br />02158<br />02159<br />02160<br />
02161<br />02162<br />02163<br />02164<br />02165<br />02166<br />02167<br />02168<br />02169<br />02170<br />02171<br />02172<br />02173<br />02174<br />02175<br />02176<br />02177<br />02178<br />02179<br />02180<br />
02181<br />02182<br />02183<br />02184<br />02185<br />02186<br />02187<br />02188<br />02189<br />02190<br />02191<br />02192<br />02193<br />02194<br />02195<br />02196<br />02197<br />02198<br />02199<br />02200<br />
02201<br />02202<br />02203<br />02204<br />02205<br />02206<br />02207<br />02208<br />02209<br />02210<br />02211<br />02212<br />02213<br />02214<br />02215<br />02216<br />02217<br />02218<br />02219<br />02220<br />
02221<br />02222<br />02223<br />02224<br />02225<br />02226<br />02227<br />02228<br />02229<br />02230<br />02231<br />02232<br />02233<br />02234<br />02235<br />02236<br />02237<br />02238<br />02239<br />02240<br />
02241<br />02242<br />02243<br />02244<br />02245<br />02246<br />02247<br />02248<br />02249<br />02250<br />02251<br />02252<br />02253<br />02254<br />02255<br />02256<br />02257<br />02258<br />02259<br />02260<br />
02261<br />02262<br />02263<br />02264<br />02265<br />02266<br />02267<br />02268<br />02269<br />02270<br />02271<br />02272<br />02273<br />02274<br />02275<br />02276<br />02277<br />02278<br />02279<br />02280<br />
02281<br />02282<br />02283<br />02284<br />02285<br />02286<br />02287<br />02288<br />02289<br />02290<br />02291<br />02292<br />02293<br />02294<br />02295<br />02296<br />02297<br />02298<br />02299<br />02300<br />
02301<br />02302<br />02303<br />02304<br />02305<br />02306<br />02307<br />02308<br />02309<br />02310<br />02311<br />02312<br />02313<br />02314<br />02315<br />02316<br />02317<br />02318<br />02319<br />02320<br />
02321<br />02322<br />02323<br />02324<br />02325<br />02326<br />02327<br />02328<br />02329<br />02330<br />02331<br />02332<br />02333<br />02334<br />02335<br />02336<br />02337<br />02338<br />02339<br />02340<br />
02341<br />02342<br />02343<br />02344<br />02345<br />02346<br />02347<br />02348<br />02349<br />02350<br />02351<br />02352<br />02353<br />02354<br />02355<br />02356<br />02357<br />02358<br />02359<br />02360<br />
02361<br />02362<br />02363<br />02364<br />02365<br />02366<br />02367<br />02368<br />02369<br />02370<br />02371<br />02372<br />02373<br />02374<br />02375<br />02376<br />02377<br />02378<br />02379<br />02380<br />
02381<br />02382<br />02383<br />02384<br />02385<br />02386<br />02387<br />02388<br />02389<br />02390<br />02391<br />02392<br />02393<br />02394<br />02395<br />02396<br />02397<br />02398<br />02399<br />02400<br />
02401<br />02402<br />02403<br />02404<br />02405<br />02406<br />02407<br />02408<br />02409<br />02410<br />02411<br />02412<br />02413<br />02414<br />02415<br />02416<br />02417<br />02418<br />02419<br />02420<br />
02421<br />02422<br />02423<br />02424<br />02425<br />02426<br />02427<br />02428<br />02429<br />02430<br />02431<br />02432<br />02433<br />02434<br />02435<br />02436<br />02437<br />02438<br />02439<br />02440<br />
02441<br />02442<br />02443<br />02444<br />02445<br />02446<br />02447<br />02448<br />02449<br />02450<br />02451<br />02452<br />02453<br />02454<br />02455<br />02456<br />02457<br />02458<br />02459<br />02460<br />
02461<br />02462<br />02463<br />02464<br />02465<br />02466<br />02467<br />02468<br />02469<br />02470<br />02471<br />02472<br />02473<br />02474<br />02475<br />02476<br />02477<br />02478<br />02479<br />02480<br />
02481<br />02482<br />02483<br />02484<br />02485<br />02486<br />02487<br />02488<br />02489<br />02490<br />02491<br />02492<br />02493<br />02494<br />02495<br />02496<br />02497<br />02498<br />02499<br />02500<br />
02501<br />02502<br />02503<br />02504<br />02505<br />02506<br />02507<br />02508<br />02509<br />02510<br />02511<br />02512<br />02513<br />02514<br />02515<br />02516<br />02517<br />02518<br />02519<br />02520<br />
02521<br />02522<br />02523<br />02524<br />02525<br />02526<br />02527<br />02528<br />02529<br />02530<br />02531<br />02532<br />02533<br />02534<br />02535<br />02536<br />02537<br />02538<br />02539<br />02540<br />
02541<br />02542<br />02543<br />02544<br />02545<br />02546<br />02547<br />02548<br />02549<br />02550<br />02551<br />02552<br />02553<br />02554<br />02555<br />02556<br />02557<br />02558<br />02559<br />02560<br />
02561<br />02562<br />02563<br />02564<br />02565<br />02566<br />02567<br />02568<br />02569<br />02570<br />02571<br />02572<br />02573<br />02574<br />02575<br />02576<br />02577<br />02578<br />02579<br />02580<br />
02581<br />02582<br />02583<br />02584<br />02585<br />02586<br />02587<br />02588<br />02589<br />02590<br />02591<br />02592<br />02593<br />02594<br />02595<br />02596<br />02597<br />02598<br />02599<br />02600<br />
02601<br />02602<br />02603<br />02604<br />02605<br />02606<br />02607<br />02608<br />02609<br />02610<br />02611<br />02612<br />02613<br />02614<br />02615<br />02616<br />02617<br />02618<br />02619<br />02620<br />
02621<br />02622<br />02623<br />02624<br />02625<br />02626<br />02627<br />02628<br />02629<br />02630<br />02631<br />02632<br />02633<br />02634<br />02635<br />02636<br />02637<br />02638<br />02639<br />02640<br />
02641<br />02642<br />02643<br />02644<br />02645<br />02646<br />02647<br />02648<br />02649<br />02650<br />02651<br />02652<br />02653<br />02654<br />02655<br />02656<br />02657<br />02658<br />02659<br />02660<br />
02661<br />02662<br />02663<br />02664<br />02665<br />02666<br />02667<br />02668<br />02669<br />02670<br />02671<br />02672<br />02673<br />02674<br />02675<br />02676<br />02677<br />02678<br />02679<br />02680<br />
02681<br />02682<br />02683<br />02684<br />02685<br />02686<br />02687<br />02688<br />02689<br />02690<br />02691<br />02692<br />02693<br />02694<br />02695<br />02696<br />02697<br />02698<br />02699<br />02700<br />
02701<br />02702<br />02703<br />02704<br />02705<br />02706<br />02707<br />02708<br />02709<br />02710<br />02711<br />02712<br />02713<br />02714<br />02715<br />02716<br />02717<br />02718<br />02719<br />02720<br />
02721<br />02722<br />02723<br />02724<br />02725<br />02726<br />02727<br />02728<br />02729<br />02730<br />02731<br />02732<br />02733<br />02734<br />02735<br />02736<br />02737<br />02738<br />02739<br />02740<br />
02741<br />02742<br />02743<br />02744<br />02745<br />02746<br />02747<br />02748<br />02749<br />02750<br />02751<br />02752<br />02753<br />02754<br />02755<br />02756<br />02757<br />02758<br />02759<br />02760<br />
02761<br />02762<br />02763<br />02764<br />02765<br />02766<br />02767<br />02768<br />02769<br />02770<br />02771<br />02772<br />02773<br />02774<br />02775<br />02776<br />02777<br />02778<br />02779<br />02780<br />
02781<br />02782<br />02783<br />02784<br />02785<br />02786<br />02787<br />02788<br />02789<br />02790<br />02791<br />02792<br />02793<br />02794<br />02795<br />02796<br />02797<br />02798<br />02799<br />02800<br />
02801<br />02802<br />02803<br />02804<br />02805<br />02806<br />02807<br />02808<br />02809<br />02810<br />02811<br />02812<br />02813<br />02814<br />02815<br />02816<br />02817<br />02818<br />02819<br />02820<br />
02821<br />02822<br />02823<br />02824<br />02825<br />02826<br />02827<br />02828<br />02829<br />02830<br />02831<br />02832<br />02833<br />02834<br />02835<br />02836<br />02837<br />02838<br />02839<br />02840<br />
02841<br />02842<br />02843<br />02844<br />02845<br />02846<br />02847<br />02848<br />02849<br />02850<br />02851<br />02852<br />02853<br />02854<br />02855<br />02856<br />02857<br />02858<br />02859<br />02860<br />
02861<br />02862<br />02863<br />02864<br />02865<br />02866<br />02867<br />02868<br />02869<br />02870<br />02871<br />02872<br />02873<br />02874<br />02875<br />02876<br />02877<br />02878<br />02879<br />02880<br />
02881<br />02882<br />02883<br />02884<br />02885<br />02886<br />02887<br />02888<br />02889<br />02890<br />02891<br />02892<br />02893<br />02894<br />02895<br />02896<br />02897<br />02898<br />02899<br />02900<br />
02901<br />02902<br />02903<br />02904<br />02905<br />02906<br />02907<br />02908<br />02909<br />02910<br />02911<br />02912<br />02913<br />02914<br />02915<br />02916<br />02917<br />02918<br />02919<br />02920<br />
02921<br />02922<br />02923<br />02924<br />02925<br />02926<br />02927<br />02928<br />02929<br />02930<br />02931<br />02932<br />02933<br />02934<br />02935<br />02936<br />02937<br />02938<br />02939<br />02940<br />
02941<br />02942<br />02943<br />02944<br />02945<br />02946<br />02947<br />02948<br />02949<br />02950<br />02951<br />02952<br />02953<br />02954<br />02955<br />02956<br />02957<br />02958<br />02959<br />02960<br />
02961<br />02962<br />02963<br />02964<br />02965<br />02966<br />02967<br />02968<br />02969<br />02970<br />02971<br />02972<br />02973<br />02974<br />02975<br />02976<br />02977<br />02978<br />02979<br />02980<br />
02981<br />02982<br />02983<br />02984<br />02985<br />02986<br />02987<br />02988<br />02989<br />02990<br />02991<br />02992<br />02993<br />02994<br />02995<br />02996<br />02997<br />02998<br />02999<br />03000<br />
03001<br />03002<br />03003<br />03004<br />03005<br />03006<br />03007<br />03008<br />03009<br />03010<br />03011<br />03012<br />03013<br />03014<br />03015<br />03016<br />03017<br />03018<br />03019<br />03020<br />
03021<br />03022<br />03023<br />03024<br />03025<br />03026<br />03027<br />03028<br />03029<br />03030<br />03031<br />03032<br />03033<br />03034<br />03035<br />03036<br />03037<br />03038<br />03039<br />03040<br />
03041<br />03042<br />03043<br />03044<br />03045<br />03046<br />03047<br />03048<br />03049<br />03050<br />03051<br />03052<br />03053<br />03054<br />03055<br />03056<br />03057<br />03058<br />03059<br />03060<br />
03061<br />03062<br />03063<br />03064<br />03065<br />03066<br />03067<br />03068<br />03069<br />03070<br />03071<br />03072<br />03073<br />03074<br />03075<br />03076<br />03077<br />03078<br />03079<br />03080<br />
03081<br />03082<br />03083<br />03084<br />03085<br />03086<br />03087<br />03088<br />03089<br />03090<br />03091<br />03092<br />03093<br />03094<br />03095<br />03096<br />03097<br />03098<br />03099<br />03100<br />
03101<br />03102<br />03103<br />03104<br />03105<br />03106<br />03107<br />03108<br />03109<br />03110<br />03111<br />03112<br />03113<br />03114<br />03115<br />03116<br />03117<br />03118<br />03119<br />03120<br />
03121<br />03122<br />03123<br />03124<br />03125<br />03126<br />03127<br />03128<br />03129<br />03130<br />03131<br />03132<br />03133<br />03134<br />03135<br />03136<br />03137<br />03138<br />03139<br />03140<br />
03141<br />03142<br />03143<br />03144<br />03145<br />03146<br />03147<br />03148<br />03149<br />03150<br />03151<br />03152<br />03153<br />03154<br />03155<br />03156<br />03157<br />03158<br />03159<br />03160<br />
03161<br />03162<br />03163<br />03164<br />03165<br />03166<br />03167<br />03168<br />03169<br />03170<br />03171<br />03172<br />03173<br />03174<br />03175<br />03176<br />03177<br />03178<br />03179<br />03180<br />
03181<br />03182<br />03183<br />03184<br />03185<br />03186<br />03187<br />03188<br />03189<br />03190<br />03191<br />03192<br />03193<br />03194<br />03195<br />03196<br />03197<br />03198<br />03199<br />03200<br />
03201<br />03202<br />03203<br />03204<br />03205<br />03206<br />03207<br />03208<br />03209<br />03210<br />03211<br />03212<br />03213<br />03214<br />03215<br />03216<br />03217<br />03218<br />03219<br />03220<br />
03221<br />03222<br />03223<br />03224<br />03225<br />03226<br />03227<br />03228<br />03229<br />03230<br />03231<br />03232<br />03233<br />03234<br />03235<br />03236<br />03237<br />03238<br />03239<br />03240<br />
03241<br />03242<br />03243<br />03244<br />03245<br />03246<br />03247<br />03248<br />03249<br />03250<br />03251<br />03252<br />03253<br />03254<br />03255<br />03256<br />03257<br />03258<br />03259<br />03260<br />
03261<br />03262<br />03263<br />03264<br />03265<br />03266<br />03267<br />03268<br />03269<br />03270<br />03271<br />03272<br />03273<br />03274<br />03275<br />03276<br />03277<br />03278<br />03279<br />03280<br />
03281<br />03282<br />03283<br />03284<br />03285<br />03286<br />03287<br />03288<br />03289<br />03290<br />03291<br />03292<br />03293<br />03294<br />03295<br />03296<br />03297<br />03298<br />03299<br />03300<br />
03301<br />03302<br />03303<br />03304<br />03305<br />03306<br />03307<br />03308<br />03309<br />03310<br />03311<br />03312<br />03313<br />03314<br />03315<br />03316<br />03317<br />03318<br />03319<br />03320<br />
03321<br />03322<br />03323<br />03324<br />03325<br />03326<br />03327<br />03328<br />03329<br />03330<br />03331<br />03332<br />03333<br />03334<br />03335<br />03336<br />03337<br />03338<br />03339<br />03340<br />
03341<br />03342<br />03343<br />03344<br />03345<br />03346<br />03347<br />03348<br />03349<br />03350<br />03351<br />03352<br />03353<br />03354<br />03355<br />03356<br />03357<br />03358<br />03359<br />03360<br />
03361<br />03362<br />03363<br />03364<br />03365<br />03366<br />03367<br />03368<br />03369<br />03370<br />03371<br />03372<br />03373<br />03374<br />03375<br />03376<br />03377<br />03378<br />03379<br />03380<br />
03381<br />03382<br />03383<br />03384<br />03385<br />03386<br />03387<br />03388<br />03389<br />03390<br />03391<br />03392<br />03393<br />03394<br />03395<br />03396<br />03397<br />03398<br />03399<br />03400<br />
03401<br />03402<br />03403<br />03404<br />03405<br />03406<br />03407<br />03408<br />03409<br />03410<br />03411<br />03412<br />03413<br />03414<br />03415<br />03416<br />03417<br />03418<br />03419<br />03420<br />
03421<br />03422<br />03423<br />03424<br />03425<br />03426<br />03427<br />03428<br />03429<br />03430<br />03431<br />03432<br />03433<br />03434<br />03435<br />03436<br />03437<br />03438<br />03439<br />03440<br />
03441<br />03442<br />03443<br />03444<br />03445<br />03446<br />03447<br />03448<br />03449<br />03450<br />03451<br />03452<br />03453<br />03454<br />03455<br />03456<br />03457<br />03458<br />03459<br />03460<br />
03461<br />03462<br />03463<br />03464<br />03465<br />03466<br />03467<br />03468<br />03469<br />03470<br />03471<br />03472<br />03473<br />03474<br />03475<br />03476<br />03477<br />03478<br />03479<br />03480<br />
03481<br />03482<br />03483<br />03484<br />03485<br />03486<br />03487<br />03488<br />03489<br />03490<br />03491<br />03492<br />03493<br />03494<br />03495<br />03496<br />03497<br />03498<br />03499<br />03500<br />
03501<br />03502<br />03503<br />03504<br />03505<br />03506<br />03507<br />03508<br />03509<br />03510<br />03511<br />03512<br />03513<br />03514<br />03515<br />03516<br />03517<br />03518<br />03519<br />03520<br />
03521<br />03522<br />03523<br />03524<br />03525<br />03526<br />03527<br />03528<br />03529<br />03530<br />03531<br />03532<br />03533<br />03534<br />03535<br />03536<br />03537<br />03538<br />03539<br />03540<br />
03541<br />03542<br />03543<br />03544<br />03545<br />03546<br />03547<br />03548<br />03549<br />03550<br />03551<br />03552<br />03553<br />03554<br />03555<br />03556<br />03557<br />03558<br />03559<br />03560<br />
03561<br />03562<br />03563<br />03564<br />03565<br />03566<br />03567<br />03568<br />03569<br />03570<br />03571<br />03572<br />03573<br />03574<br />03575<br />03576<br />03577<br />03578<br />03579<br />03580<br />
03581<br />03582<br />03583<br />03584<br />03585<br />03586<br />03587<br />03588<br />03589<br />03590<br />03591<br />03592<br />03593<br />03594<br />03595<br />03596<br />03597<br />03598<br />03599<br />03600<br />
03601<br />03602<br />03603<br />03604<br />03605<br />03606<br />03607<br />03608<br />03609<br />03610<br />03611<br />03612<br />03613<br />03614<br />03615<br />03616<br />03617<br />03618<br />03619<br />03620<br />
03621<br />03622<br />03623<br />03624<br />03625<br />03626<br />03627<br />03628<br />03629<br />03630<br />03631<br />03632<br />03633<br />03634<br />03635<br />03636<br />03637<br />03638<br />03639<br />03640<br />
03641<br />03642<br />03643<br />03644<br />03645<br />03646<br />03647<br />03648<br />03649<br />03650<br />03651<br />03652<br />03653<br />03654<br />03655<br />03656<br />03657<br />03658<br />03659<br />03660<br />
03661<br />03662<br />03663<br />03664<br />03665<br />03666<br />03667<br />03668<br />03669<br />03670<br />03671<br />03672<br />03673<br />03674<br />03675<br />03676<br />03677<br />03678<br />03679<br />03680<br />
03681<br />03682<br />03683<br />03684<br />03685<br />03686<br />03687<br />03688<br />03689<br />03690<br />03691<br />03692<br />03693<br />03694<br />03695<br />03696<br />03697<br />03698<br />03699<br />03700<br />
03701<br />03702<br />03703<br />03704<br />03705<br />03706<br />03707<br />03708<br />03709<br />03710<br />03711<br />03712<br />03713<br />03714<br />03715<br />03716<br />03717<br />03718<br />03719<br />03720<br />
03721<br />03722<br />03723<br />03724<br />03725<br />03726<br />03727<br />03728<br />03729<br />03730<br />03731<br />03732<br />03733<br />03734<br />03735<br />03736<br />03737<br />03738<br />03739<br />03740<br />
03741<br />03742<br />03743<br />03744<br />03745<br />03746<br />03747<br />03748<br />03749<br />03750<br />03751<br />03752<br />03753<br />03754<br />03755<br />03756<br />03757<br />03758<br />03759<br />03760<br />
03761<br />03762<br />03763<br />03764<br />03765<br />03766<br />03767<br />03768<br />03769<br />03770<br />03771<br />03772<br />03773<br />03774<br />03775<br />03776<br />03777<br />03778<br />03779<br />03780<br />
03781<br />03782<br />03783<br />03784<br />03785<br />03786<br />03787<br />03788<br />03789<br />03790<br />03791<br />03792<br />03793<br />03794<br />03795<br />03796<br />03797<br />03798<br />03799<br />03800<br />
03801<br />03802<br />03803<br />03804<br />03805<br />03806<br />03807<br />03808<br />03809<br />03810<br />03811<br />03812<br />03813<br />03814<br />03815<br />03816<br />03817<br />03818<br />03819<br />03820<br />
03821<br />03822<br />03823<br />03824<br />03825<br />03826<br />03827<br />03828<br />03829<br />03830<br />03831<br />03832<br />03833<br />03834<br />03835<br />03836<br />03837<br />03838<br />03839<br />03840<br />
03841<br />03842<br />03843<br />03844<br />03845<br />03846<br />03847<br />03848<br />03849<br />03850<br />03851<br />03852<br />03853<br />03854<br />03855<br />03856<br />03857<br />03858<br />03859<br />03860<br />
03861<br />03862<br />03863<br />03864<br />03865<br />03866<br />03867<br />03868<br />03869<br />03870<br />03871<br />03872<br />03873<br />03874<br />03875<br />03876<br />03877<br />03878<br />03879<br />03880<br />
03881<br />03882<br />03883<br />03884<br />03885<br />03886<br />03887<br />03888<br />03889<br />03890<br />03891<br />03892<br />03893<br />03894<br />03895<br />03896<br />03897<br />03898<br />03899<br />03900<br />
03901<br />03902<br />03903<br />03904<br />03905<br />03906<br />03907<br />03908<br />03909<br />03910<br />03911<br />03912<br />03913<br />03914<br />03915<br />03916<br />03917<br />03918<br />03919<br />03920<br />
03921<br />03922<br />03923<br />03924<br />03925<br />03926<br />03927<br />03928<br />03929<br />03930<br />03931<br />03932<br />03933<br />03934<br />03935<br />03936<br />03937<br />03938<br />03939<br />03940<br />
03941<br />03942<br />03943<br />03944<br />03945<br />03946<br />03947<br />03948<br />03949<br />03950<br />03951<br />03952<br />03953<br />03954<br />03955<br />03956<br />03957<br />03958<br />03959<br />03960<br />
03961<br />03962<br />03963<br />03964<br />03965<br />03966<br />03967<br />03968<br />03969<br />03970<br />03971<br />03972<br />03973<br />03974<br />03975<br />03976<br />03977<br />03978<br />03979<br />03980<br />
03981<br />03982<br />03983<br />03984<br />03985<br />03986<br />03987<br />03988<br />03989<br />03990<br />03991<br />03992<br />03993<br />03994<br />03995<br />03996<br />03997<br />03998<br />03999<br />04000<br />
04001<br />04002<br />04003<br />04004<br />04005<br />04006<br />04007<br />04008<br />04009<br />04010<br />04011<br />04012<br />04013<br />04014<br />04015<br />04016<br />04017<br />04018<br />04019<br />04020<br />
04021<br />04022<br />04023<br />04024<br />04025<br />04026<br />04027<br />04028<br />04029<br />04030<br />04031<br />04032<br />04033<br />04034<br />04035<br />04036<br />04037<br />04038<br />04039<br />04040<br />
04041<br />04042<br />04043<br />04044<br />04045<br />04046<br />04047<br />04048<br />04049<br />04050<br />04051<br />04052<br />04053<br />04054<br />04055<br />04056<br />04057<br />04058<br />04059<br />04060<br />
04061<br />04062<br />04063<br />04064<br />04065<br />04066<br />04067<br />04068<br />04069<br />04070<br />04071<br />04072<br />04073<br />04074<br />04075<br />04076<br />04077<br />04078<br />04079<br />04080<br />
04081<br />04082<br />04083<br />04084<br />04085<br />04086<br />04087<br />04088<br />04089<br />04090<br />04091<br />04092<br />04093<br />04094<br />04095<br />04096<br />04097<br />04098<br />04099<br />04100<br />
04101<br />04102<br />04103<br />04104<br />04105<br />04106<br />04107<br />04108<br />04109<br />04110<br />04111<br />04112<br />04113<br />04114<br />04115<br />04116<br />04117<br />04118<br />04119<br />04120<br />
04121<br />04122<br />04123<br />04124<br />04125<br />04126<br />04127<br />04128<br />04129<br />04130<br />04131<br />04132<br />04133<br />04134<br />04135<br />04136<br />04137<br />04138<br />04139<br />04140<br />
04141<br />04142<br />04143<br />04144<br />04145<br />04146<br />04147<br />04148<br />04149<br />04150<br />04151<br />04152<br />04153<br />04154<br />04155<br />04156<br />04157<br />04158<br />04159<br />04160<br />
04161<br />04162<br />04163<br />04164<br />04165<br />04166<br />04167<br />04168<br />04169<br />04170<br />04171<br />04172<br />04173<br />04174<br />04175<br />04176<br />04177<br />04178<br />04179<br />04180<br />
04181<br />04182<br />04183<br />04184<br />04185<br />04186<br />04187<br />04188<br />04189<br />04190<br />04191<br />04192<br />04193<br />04194<br />04195<br />04196<br />04197<br />04198<br />04199<br />04200<br />
04201<br />04202<br />04203<br />04204<br />04205<br />04206<br />04207<br />04208<br />04209<br />04210<br />04211<br />04212<br />04213<br />04214<br />04215<br />04216<br />04217<br />04218<br />04219<br />04220<br />
04221<br />04222<br />04223<br />04224<br />04225<br />04226<br />04227<br />04228<br />04229<br />04230<br />04231<br />04232<br />04233<br />04234<br />04235<br />04236<br />04237<br />04238<br />04239<br />04240<br />
04241<br />04242<br />04243<br />04244<br />04245<br />04246<br />04247<br />04248<br />04249<br />04250<br />04251<br />04252<br />04253<br />04254<br />04255<br />04256<br />04257<br />04258<br />04259<br />04260<br />
04261<br />04262<br />04263<br />04264<br />04265<br />04266<br />04267<br />04268<br />04269<br />04270<br />04271<br />04272<br />04273<br />04274<br />04275<br />04276<br />04277<br />04278<br />04279<br />04280<br />
04281<br />04282<br />04283<br />04284<br />04285<br />04286<br />04287<br />04288<br />04289<br />04290<br />04291<br />04292<br />04293<br />04294<br />04295<br />04296<br />04297<br />04298<br />04299<br />04300<br />
04301<br />04302<br />04303<br />04304<br />04305<br />04306<br />04307<br />04308<br />04309<br />04310<br />04311<br />04312<br />04313<br />04314<br />04315<br />04316<br />04317<br />04318<br />04319<br />04320<br />
04321<br />04322<br />04323<br />04324<br />04325<br />04326<br />04327<br />04328<br />04329<br />04330<br />04331<br />04332<br />04333<br />04334<br />04335<br />04336<br />04337<br />04338<br />04339<br />04340<br />
04341<br />04342</span></td>
<td class="source"><pre class="source"><a name="1"></a><span class="source_comment">//=============================================================================
</span><a name="2"></a><span class="source_comment">// KFPawn
</span><a name="3"></a><span class="source_comment">//=============================================================================
</span><a name="4"></a><span class="source_type">class</span> <span class="source_type"><a href="../kfmod/kfpawn.html" class="source">KFPawn</a></span> extends <span class="source_type"><a href="../xgame/xpawn.html" class="source">xPawn</a></span>
<a name="5"></a>      dependsOn(<span class="source_type"><a href="../old2k4/xpawngibgroup.html" class="source">xPawnGibGroup</a></span>);
<a name="6"></a>
<a name="7"></a><span class="source_macro">#exec OBJ LOAD FILE=Inf_Weapons.uax
</span><a name="8"></a><span class="source_macro">#exec OBJ LOAD FILE=Inf_Player.uax
</span><a name="9"></a>
<a name="10"></a><span class="source_comment">// From XPawn
</span><a name="11"></a>var(<span class="source_type"><a href="../old2k4/gib.html" class="source">Gib</a></span>) <span class="source_type">class</span>&lt;<span class="source_type"><a href="../old2k4/xpawngibgroup.html" class="source">xPawnGibGroup</a></span>&gt; GibGroupClass;
<a name="12"></a>var(<span class="source_type"><a href="../old2k4/gib.html" class="source">Gib</a></span>) <span class="source_type">int</span> GibCountCalf;
<a name="13"></a>var(<span class="source_type"><a href="../old2k4/gib.html" class="source">Gib</a></span>) <span class="source_type">int</span> GibCountForearm;
<a name="14"></a>var(<span class="source_type"><a href="../old2k4/gib.html" class="source">Gib</a></span>) <span class="source_type">int</span> GibCountHead;
<a name="15"></a>var(<span class="source_type"><a href="../old2k4/gib.html" class="source">Gib</a></span>) <span class="source_type">int</span> GibCountTorso;
<a name="16"></a>var(<span class="source_type"><a href="../old2k4/gib.html" class="source">Gib</a></span>) <span class="source_type">int</span> GibCountUpperArm;
<a name="17"></a>
<a name="18"></a>var <span class="source_type">string</span> KFBSkin;
<a name="19"></a>var <span class="source_type">string</span> KFFSkin;
<a name="20"></a>var <span class="source_type">mesh</span>  KFSMesh;
<a name="21"></a>
<a name="22"></a>var <span class="source_type">bool</span> bCanBeHealed;
<a name="23"></a>var <span class="source_type">float</span> healthToGive, lastHealTime;
<a name="24"></a>
<a name="25"></a>var <span class="source_type">bool</span> bResetingAnimAct;
<a name="26"></a>var <span class="source_type">float</span> NextBileTime, BileFrequency, AnimActResetTime;
<a name="27"></a>var <span class="source_type">int</span> BileCount;
<a name="28"></a>var <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> BileInstigator;
<a name="29"></a>var <span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/damtypevomit.html" class="source">DamTypeVomit</a></span>&gt; LastBileDamagedByType;
<a name="30"></a>
<a name="31"></a>var <span class="source_type">name</span> ClientIdleWeaponAnim;
<a name="32"></a>
<a name="33"></a>var <span class="source_type">bool</span> bThrowingNade; <span class="source_comment">// ARE WE ALREADY THROWING ONE?
</span><a name="34"></a>
<a name="35"></a>var <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> SecondaryItem;
<a name="36"></a>
<a name="37"></a><span class="source_comment">// Player Health Bar textures
</span><a name="38"></a>var <span class="source_type"><a href="../engine/texture.html" class="source">Texture</a></span> TeamBeaconTexture, NoEntryTexture;
<a name="39"></a>var <span class="source_type"><a href="../engine/material.html" class="source">Material</a></span> TeamBeaconBorderMaterial;
<a name="40"></a>
<a name="41"></a>var <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; LastHitDamType; <span class="source_comment">// records the last kind of damge you took (for siren hack)
</span><a name="42"></a>
<a name="43"></a>var (Global) <span class="source_type">Mesh</span> SafeMesh;
<a name="44"></a>
<a name="45"></a><span class="source_comment">// Fire Related
</span><a name="46"></a>
<a name="47"></a>var <span class="source_type">int</span> BurnDown ; <span class="source_comment">// Number of times our zombie must suffer Fire Damage.
</span><a name="48"></a>var <span class="source_type">bool</span> bAshen; <span class="source_comment">// is our Zed crispy yet?
</span><a name="49"></a>var <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/emitter.html" class="source">Emitter</a></span>&gt; BurnEffect;  <span class="source_comment">// The appearance of the flames we are attaching to our Zed.
</span><a name="50"></a>var <span class="source_type">int</span> LastBurnDamage; <span class="source_comment">// Record the last amount of Fire damage the pawn suffered.
</span><a name="51"></a>var <span class="source_type"><a href="../engine/emitter.html" class="source">Emitter</a></span> ItBUURRNNNS;
<a name="52"></a>
<a name="53"></a>var <span class="source_type">bool</span> bBurnified;
<a name="54"></a>var <span class="source_type">bool</span> bBurnApplied;
<a name="55"></a>
<a name="56"></a>var <span class="source_type"><a href="../engine/pawn.html" class="source">pawn</a></span> LastDamagedBy,BurnInstigator;
<a name="57"></a>
<a name="58"></a>var() globalconfig <span class="source_type">bool</span> bDetailedShadows,bRealDeathType,bRealtimeShadows;
<a name="59"></a>
<a name="60"></a>var <span class="source_type"><a href="../kfmod/kflevelrules.html" class="source">KFLevelRules</a></span> LevRls;
<a name="61"></a>var <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> OwnerPRI;
<a name="62"></a>
<a name="63"></a>var <span class="source_type">byte</span> bIsQuickHealing;
<a name="64"></a>
<a name="65"></a><span class="source_comment">/* Feet adjusters ================*/</span>
<a name="66"></a>var <span class="source_type">bool</span> bHasFootAdjust;
<a name="67"></a>var globalconfig <span class="source_type">bool</span> bDoAdjustFeet;
<a name="68"></a>var <span class="source_type">float</span> MaxZHeight,MinZHeight,OldAdjust[<span class="source_int">2</span>];
<a name="69"></a>var <span class="source_type"><a href="../kfmod/kfpawnfootadjuster.html" class="source">KFPawnFootAdjuster</a></span> Adjuster;
<a name="70"></a>var <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/species_kfmalehuman.html" class="source">SPECIES_KFMaleHuman</a></span>&gt; FeetAdjSpec;
<a name="71"></a>
<a name="72"></a><span class="source_comment">// Animations
</span><a name="73"></a>const NUM_FIRE_ANIMS = <span class="source_int">4</span>;
<a name="74"></a>var <span class="source_type">name</span> FireAnims[NUM_FIRE_ANIMS];
<a name="75"></a>var <span class="source_type">name</span> FireAltAnims[NUM_FIRE_ANIMS];
<a name="76"></a>var <span class="source_type">name</span> FireCrouchAnims[NUM_FIRE_ANIMS];
<a name="77"></a>var <span class="source_type">name</span> FireCrouchAltAnims[NUM_FIRE_ANIMS];
<a name="78"></a>var <span class="source_type">name</span> HitAnims[<span class="source_int">4</span>];
<a name="79"></a>var <span class="source_type">name</span> PostFireBlendStandAnim;
<a name="80"></a>var <span class="source_type">name</span> PostFireBlendCrouchAnim;
<a name="81"></a>
<a name="82"></a>
<a name="83"></a><span class="source_comment">// Footstepping
</span><a name="84"></a>var(Sounds)     <span class="source_type">float</span>           FootStepSoundRadius;    <span class="source_comment">// The radius that footstep sounds can be heard
</span><a name="85"></a>var(Sounds)     <span class="source_type">float</span>           QuietFootStepVolume;    <span class="source_comment">// The amount to scale footstepsounds when the player is walking slowly
</span><a name="86"></a>var(Sounds)     <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>           SoundFootsteps[<span class="source_int">20</span>];     <span class="source_comment">// Indexed by ESurfaceTypes (sorry about the literal).
</span><a name="87"></a>var(Bob)        <span class="source_type">float</span>           BobSpeedModifier;       <span class="source_comment">// A general scalar for walkbob/footstep sound speed
</span><a name="88"></a>var(Bob)        <span class="source_type">float</span>           BobScaleModifier;       <span class="source_comment">// A general scalar for walkbob intensity
</span><a name="89"></a>
<a name="90"></a>var             <span class="source_type">bool</span>            bMovementDisabled;      <span class="source_comment">// The player can't move right now
</span><a name="91"></a>var             <span class="source_type">float</span>           StopDisabledTime;       <span class="source_comment">// When the player can move again;
</span><a name="92"></a>
<a name="93"></a><span class="source_comment">// Gore
</span><a name="94"></a>var         <span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span>  SeveredLeftArm;         <span class="source_comment">// The meaty attachments that get attached when body parts are blown off
</span><a name="95"></a>var         <span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span>  SeveredRightArm;        <span class="source_comment">// The meaty attachments that get attached when body parts are blown off
</span><a name="96"></a>var         <span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span>  SeveredLeftLeg;         <span class="source_comment">// The meaty attachments that get attached when body parts are blown off
</span><a name="97"></a>var         <span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span>  SeveredRightLeg;        <span class="source_comment">// The meaty attachments that get attached when body parts are blown off
</span><a name="98"></a>var         <span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span>  <span class="source_type"><a href="../kfmod/severedhead.html" class="source">SeveredHead</a></span>;            <span class="source_comment">// The meaty attachments that get attached when body parts are blown off
</span><a name="99"></a>var(Gore)   <span class="source_type">float</span>                       SeveredArmAttachScale;  <span class="source_comment">// The drawscale of the arm gore attachement
</span><a name="100"></a>var(Gore)   <span class="source_type">float</span>                       SeveredLegAttachScale;  <span class="source_comment">// The drawscale of the leg gore attachement
</span><a name="101"></a>var(Gore)   <span class="source_type">float</span>                       SeveredHeadAttachScale; <span class="source_comment">// The drawscale of the head gore attachement
</span><a name="102"></a>
<a name="103"></a>var <span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/dismembermentjethead.html" class="source">DismembermentJetHead</a></span>&gt;         NeckSpurtEmitterClass;  <span class="source_comment">// class of the chopped off head neck emitter
</span><a name="104"></a>var <span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/dismembermentjetlimb.html" class="source">DismembermentJetLimb</a></span>&gt;         LimbSpurtEmitterClass;  <span class="source_comment">// class of the chopped off head neck emitter
</span><a name="105"></a>
<a name="106"></a>var <span class="source_type">class</span>&lt;<span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span>&gt; SeveredArmAttachClass; <span class="source_comment">// class of the severed arm for this role
</span><a name="107"></a>var <span class="source_type">class</span>&lt;<span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span>&gt; SeveredLegAttachClass; <span class="source_comment">// class of the severed arm for this role
</span><a name="108"></a>var <span class="source_type">class</span>&lt;<span class="source_type"><a href="../roeffects/severedappendageattachment.html" class="source">SeveredAppendageAttachment</a></span>&gt; SeveredHeadAttachClass; <span class="source_comment">// class of the severed arm for this role
</span><a name="109"></a>
<a name="110"></a>var <span class="source_type">class</span> &lt;<span class="source_type"><a href="../roeffects/robloodspurt.html" class="source">ROBloodSpurt</a></span>&gt;         BleedingEmitterClass;      <span class="source_comment">// class of the bleeding emitter
</span><a name="111"></a>var <span class="source_type">class</span> &lt;<span class="source_type"><a href="../roeffects/projectilebloodsplat.html" class="source">ProjectileBloodSplat</a></span>&gt; ProjectileBloodSplatClass; <span class="source_comment">// class of the wall bloodsplat from a projectile's impact
</span><a name="112"></a>var <span class="source_type">class</span> &lt;<span class="source_type"><a href="../roeffects/severedappendage.html" class="source">SeveredAppendage</a></span>&gt;    DetachedArmClass;       <span class="source_comment">// class of detached arm to spawn for this pawn. Modified by the RoleInfo to match the player model
</span><a name="113"></a>var <span class="source_type">class</span> &lt;<span class="source_type"><a href="../roeffects/severedappendage.html" class="source">SeveredAppendage</a></span>&gt;    DetachedLegClass;       <span class="source_comment">// class of detached arm to spawn for this pawn. Modified by the RoleInfo to match the player model
</span><a name="114"></a>var         <span class="source_type">bool</span>                bLeftArmGibbed;         <span class="source_comment">// LeftArm is already blown off
</span><a name="115"></a>var         <span class="source_type">bool</span>                bRightArmGibbed;        <span class="source_comment">// RightArm is already blown off
</span><a name="116"></a>var         <span class="source_type">bool</span>                bLeftLegGibbed;         <span class="source_comment">// LeftLeg is already blown off
</span><a name="117"></a>var         <span class="source_type">bool</span>                bRightLegGibbed;        <span class="source_comment">// RightLeg is already blown off
</span><a name="118"></a>var <span class="source_type">class</span> &lt;<span class="source_type"><a href="../engine/emitter.html" class="source">Emitter</a></span>&gt;             ObliteratedEffectClass; <span class="source_comment">// class of detached arm to spawn for this pawn. Modified by the RoleInfo to match the player model
</span><a name="119"></a>var(Sounds) <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span>               DecapitationSound;      <span class="source_comment">//The sound of this players head exploding
</span><a name="120"></a>
<a name="121"></a>var <span class="source_type">bool</span> bDestroyNextTick; <span class="source_comment">// Destroy this pawn next tick because destroying it now will cause problems
</span><a name="122"></a>var <span class="source_type">float</span> TimeSetDestroyNextTickTime; <span class="source_comment">// The time we set the bDestroyNextTick flag
</span><a name="123"></a>
<a name="124"></a>var <span class="source_type">float</span>   LastDropCashMessageTime;
<a name="125"></a>var <span class="source_type">float</span>   DropCashMessageDelay;
<a name="126"></a>
<a name="127"></a>var <span class="source_type">bool</span>    bDestroyAfterRagDollTick;   <span class="source_comment">// Wait until the ragdoll tick has happened and then destroy. Prevents crashes where we try and destroy the actor right after initializing ragdoll
</span><a name="128"></a>var <span class="source_type">bool</span>    bProcessedRagTickDestroy;   <span class="source_comment">// Already called destroy for a bDestroyAfterRagDollTick setting
</span><a name="129"></a>
<a name="130"></a><span class="source_comment">// Collision
</span><a name="131"></a>var     <span class="source_type"><a href="../kfmod/kfbulletwhipattachment.html" class="source">KFBulletWhipAttachment</a></span>  AuxCollisionCylinder;   <span class="source_comment">// Additional collision cylinder for detecting bullets passing by
</span><a name="132"></a>var                 <span class="source_type">bool</span>        SavedAuxCollision;      <span class="source_comment">// Saved aux collision cylinder status
</span><a name="133"></a>
<a name="134"></a>var         <span class="source_type">float</span>               NadeThrowTimeout;       <span class="source_comment">// Little hack to timeout the grenade throwing flag on the client in case it gets stuck. At some point we should try and track down what is actually causing it to get stuck, this is just a quick fix - Ramm
</span><a name="135"></a>
<a name="136"></a>var     <span class="source_type"><a href="../engine/emitter.html" class="source">Emitter</a></span>    AttachedEmitter;
<a name="137"></a>
<a name="138"></a><span class="source_comment">/* === Replicated Custom Animation Struct.
<a name="139"></a>
<a name="140"></a>Used with ACTION_PlayKFReplicatedAnim Objects to
<a name="141"></a>allow level designers to play replicated scripted
<a name="142"></a>animations on pawns */</span>
<a name="143"></a>
<a name="144"></a>struct <span class="source_type"><a href="../kfmod/kfpawn.html#SScriptedAnimRepInfo" class="source">SScriptedAnimRepInfo</a></span>
<a name="145"></a>{
<a name="146"></a>    var         <span class="source_type">name</span>                BaseAnim;
<a name="147"></a>    var         <span class="source_type">float</span>               BlendInTime;
<a name="148"></a>    var         <span class="source_type">float</span>               BlendOutTime;
<a name="149"></a>    var         <span class="source_type">float</span>               AnimRate;
<a name="150"></a>    var         <span class="source_type">byte</span>                AnimIterations;
<a name="151"></a>    var         <span class="source_type">bool</span>                bLoopAnim;
<a name="152"></a>    var         <span class="source_type">float</span>               StartFrame;
<a name="153"></a>};
<a name="154"></a>
<a name="155"></a>var <span class="source_type"><a href="../kfmod/kfpawn.html#SScriptedAnimRepInfo" class="source">SScriptedAnimRepInfo</a></span>            ScriptedAnimData;
<a name="156"></a>
<a name="157"></a>
<a name="158"></a>
<a name="159"></a><span class="source_comment">// Hit detection debugging - Only use when debugging
</span><a name="160"></a><span class="source_comment">/*var vector DrawLocation;
<a name="161"></a>var rotator DrawRotation;
<a name="162"></a>var int DrawIndex;
<a name="163"></a>var vector HitStart;
<a name="164"></a>var vector HitEnd;
<a name="165"></a>var byte HitPointDebugByte;
<a name="166"></a>var byte OldHitPointDebugByte;*/</span>
<a name="167"></a>
<a name="168"></a>replication
<a name="169"></a>{
<a name="170"></a>    reliable if(Role == ROLE_Authority)
<a name="171"></a>        bBurnified,QuickHeal,ClientCurrentWeaponSold,ClientForceChangeWeapon;
<a name="172"></a>
<a name="173"></a>    reliable if(Role &lt; ROLE_Authority)
<a name="174"></a>        ServerBuyPotato,ServerBuyWeapon,ServerSellWeapon,ServerBuyKevlar,ServerBuyFirstAid,ServerBuyAmmo,ServerSellAmmo;
<a name="175"></a>
<a name="176"></a>    reliable if(Role &lt; ROLE_Authority)
<a name="177"></a>        SecondaryItem,TossCash;
<a name="178"></a>
<a name="179"></a>    reliable if ( bNetDirty && (Role == Role_Authority) && bNetOwner )
<a name="180"></a>        bMovementDisabled;
<a name="181"></a>
<a name="182"></a>    reliable if(Role == ROLE_Authority && bNetDirty && !bNetOwner)
<a name="183"></a>       ScriptedAnimData;
<a name="184"></a>
<a name="185"></a>    <span class="source_comment">// Hit detection debugging - Only use when debugging
</span><a name="186"></a>    <span class="source_comment">/*reliable if (Role == ROLE_Authority)
<a name="187"></a>        DrawLocation,DrawRotation,DrawIndex,HitPointDebugByte,HitStart,HitEnd;*/</span>
<a name="188"></a>}
<a name="189"></a>
<a name="190"></a>simulated function PostBeginPlay()
<a name="191"></a>{
<a name="192"></a>    Super(<span class="source_type"><a href="../unrealgame/unrealpawn.html" class="source">UnrealPawn</a></span>).PostBeginPlay();
<a name="193"></a>    AssignInitialPose();
<a name="194"></a>
<a name="195"></a>    if( bActorShadows && bPlayerShadows && (<span class="source_type">Level</span>.NetMode!=NM_DedicatedServer) )
<a name="196"></a>    {
<a name="197"></a>        if( bDetailedShadows )
<a name="198"></a>            PlayerShadow = Spawn(<span class="source_type">class</span><span class="source_name">'KFShadowProject'</span>,Self,<span class="source_name">''</span>,Location);
<a name="199"></a>        else PlayerShadow = Spawn(<span class="source_type">class</span><span class="source_name">'ShadowProjector'</span>,Self,<span class="source_name">''</span>,Location);
<a name="200"></a>        PlayerShadow.ShadowActor = self;
<a name="201"></a>        PlayerShadow.bBlobShadow = bBlobShadow;
<a name="202"></a>        PlayerShadow.LightDirection = Normal(vect(<span class="source_int">1</span>,<span class="source_int">1</span>,<span class="source_int">3</span>));
<a name="203"></a>        PlayerShadow.InitShadow();
<a name="204"></a>    }
<a name="205"></a>
<a name="206"></a>    <span class="source_comment">// Only need this on the server
</span><a name="207"></a>    if( Role == Role_Authority<span class="source_comment">/*IsLocallyControlled() || Level.NetMode == NM_DedicatedServer || Level.NetMode == NM_ListenServer*/</span> )
<a name="208"></a>    {
<a name="209"></a>        if (  AuxCollisionCylinder == none )
<a name="210"></a>        {
<a name="211"></a>            AuxCollisionCylinder = Spawn(<span class="source_type">class</span> <span class="source_name">'KFBulletWhipAttachment'</span>,self);
<a name="212"></a>            <span class="source_comment">//AttachToBone(AuxCollisionCylinder, 'CHR_Pelvis');
</span><a name="213"></a>
<a name="214"></a>            <span class="source_comment">///AuxCollisionCylinder = Spawn(class 'ExtendedZCollision',self);
</span><a name="215"></a>            <span class="source_comment">//MyExtCollision.SetCollisionSize(ColRadius,ColHeight);
</span><a name="216"></a>
<a name="217"></a>            AuxCollisionCylinder.bHardAttach = true;
<a name="218"></a>            <span class="source_comment">//AttachPos = Location + (ColOffset &gt;&gt; Rotation);
</span><a name="219"></a>            AuxCollisionCylinder.SetLocation( Location );
<a name="220"></a>            AuxCollisionCylinder.SetPhysics( PHYS_None );
<a name="221"></a>            AuxCollisionCylinder.SetBase( self );
<a name="222"></a>
<a name="223"></a>        }
<a name="224"></a>        SavedAuxCollision = AuxCollisionCylinder.bCollideActors;
<a name="225"></a>    }
<a name="226"></a>}
<a name="227"></a>
<a name="228"></a><span class="source_comment">// Setters for extra collision cylinders
</span><a name="229"></a>simulated function ToggleAuxCollision(<span class="source_type">bool</span> newbCollision)
<a name="230"></a>{
<a name="231"></a>    if ( !newbCollision )
<a name="232"></a>    {
<a name="233"></a>        SavedAuxCollision = AuxCollisionCylinder.bCollideActors;
<a name="234"></a>
<a name="235"></a>        AuxCollisionCylinder.SetCollision(false);
<a name="236"></a>    }
<a name="237"></a>    else
<a name="238"></a>    {
<a name="239"></a>        AuxCollisionCylinder.SetCollision(SavedAuxCollision);
<a name="240"></a>    }
<a name="241"></a>}
<a name="242"></a>
<a name="243"></a>function PossessedBy(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> <span class="source_type">C</span>)
<a name="244"></a>{
<a name="245"></a>    Super.PossessedBy(<span class="source_type">C</span>);
<a name="246"></a>    if ( <span class="source_type">C</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != None )
<a name="247"></a>        OwnerPRI = <span class="source_type">C</span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>;
<a name="248"></a>}
<a name="249"></a>
<a name="250"></a>simulated Function PostNetBeginPlay()
<a name="251"></a>{
<a name="252"></a>    EnableChannelNotify(<span class="source_int">1</span>,<span class="source_int">1</span>);
<a name="253"></a>    EnableChannelNotify(<span class="source_int">2</span>,<span class="source_int">1</span>);
<a name="254"></a>    super.PostNetBeginPlay();
<a name="255"></a>}
<a name="256"></a>
<a name="257"></a>simulated function <span class="source_type">string</span> GetDefaultCharacter()
<a name="258"></a>{
<a name="259"></a>    return <span class="source_string">"Corporal_Lewis"</span>;
<a name="260"></a>}
<a name="261"></a>
<a name="262"></a>simulated function Setup(<span class="source_type"><a href="../xgame/xutil.html" class="source">xUtil</a></span>.<span class="source_type"><a href="../xgame/xutil.html#PlayerRecord" class="source">PlayerRecord</a></span> rec, optional <span class="source_type">bool</span> bLoadNow)
<a name="263"></a>{
<a name="264"></a>    local <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/emitter.html" class="source">Emitter</a></span>&gt; AttachedEmitterClass;
<a name="265"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> AttachOffset;
<a name="266"></a>
<a name="267"></a>    if( rec.Species==None || <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/species_kfmalehuman.html" class="source">SPECIES_KFMaleHuman</a></span>&gt;(rec.Species)==None )
<a name="268"></a>        rec = <span class="source_type">class</span><span class="source_name">'xUtil'</span>.static.FindPlayerRecord(GetDefaultCharacter());
<a name="269"></a>    Species = rec.Species;
<a name="270"></a>    RagdollOverride = rec.Ragdoll;
<a name="271"></a>    if ( Species!=None && !Species.static.Setup(self,rec) )
<a name="272"></a>    {
<a name="273"></a>        rec = <span class="source_type">class</span><span class="source_name">'xUtil'</span>.static.FindPlayerRecord(GetDefaultCharacter());
<a name="274"></a>        Species = rec.Species;
<a name="275"></a>        RagdollOverride = rec.Ragdoll;
<a name="276"></a>        if ( !Species.static.Setup(self,rec) )
<a name="277"></a>            return;
<a name="278"></a>    }
<a name="279"></a>
<a name="280"></a>    if( rec.AttachedEmitter != <span class="source_string">""</span> && AttachedEmitter == none && <span class="source_type">Level</span>.NetMode != NM_DedicatedServer)
<a name="281"></a>    {
<a name="282"></a>        AttachedEmitterClass = <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/emitter.html" class="source">Emitter</a></span>&gt;(DynamicLoadObject(rec.AttachedEmitter,<span class="source_type">class</span><span class="source_name">'Class'</span>));
<a name="283"></a>        AttachedEmitter = Spawn(AttachedEmitterClass, self);
<a name="284"></a>        if( AttachToBone(AttachedEmitter, rec.BoneName ) )
<a name="285"></a>        {
<a name="286"></a>            AttachOffset.<span class="source_type">X</span> = rec.XOffset;
<a name="287"></a>            AttachOffset.<span class="source_type">Y</span> = rec.YOffset;
<a name="288"></a>            AttachOffset.<span class="source_type">Z</span> = rec.ZOffset;
<a name="289"></a>            AttachedEmitter.SetRelativeLocation( AttachOffset );<span class="source_comment">//vect(rec.XOffset, rec.YOffset, rec.ZOffset) );
</span><a name="290"></a>        }
<a name="291"></a>    }
<a name="292"></a>
<a name="293"></a>    if( <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/species_kfmalehuman.html" class="source">SPECIES_KFMaleHuman</a></span>&gt;(Species) != none )
<a name="294"></a>    {
<a name="295"></a>        DetachedArmClass = <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/species_kfmalehuman.html" class="source">SPECIES_KFMaleHuman</a></span>&gt;(Species).default.DetachedArmClass;
<a name="296"></a>        DetachedLegClass = <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/species_kfmalehuman.html" class="source">SPECIES_KFMaleHuman</a></span>&gt;(Species).default.DetachedLegClass;
<a name="297"></a>    }
<a name="298"></a>
<a name="299"></a>    ResetPhysicsBasedAnim();
<a name="300"></a><span class="source_comment">//  bHasFootAdjust = False;
</span><a name="301"></a><span class="source_comment">//  FeetAdjSpec = Class&lt;SPECIES_KFMaleHuman&gt;(rec.Species);
</span><a name="302"></a><span class="source_comment">//  if( !bDoAdjustFeet || FeetAdjSpec==None || Level.NetMode==NM_DedicatedServer )
</span><a name="303"></a><span class="source_comment">//      return;
</span><a name="304"></a><span class="source_comment">//  if( Adjuster!=None )
</span><a name="305"></a><span class="source_comment">//      Adjuster.Destroy();
</span><a name="306"></a><span class="source_comment">//  Adjuster = Spawn(Class'KFPawnFootAdjuster',,,vect(0,0,0),rot(0,0,0));
</span><a name="307"></a><span class="source_comment">//  Adjuster.AdjustingPawn = Self;
</span><a name="308"></a><span class="source_comment">//  Adjuster.SpecType = FeetAdjSpec;
</span><a name="309"></a><span class="source_comment">//  Adjuster.LinkMesh(Mesh);
</span><a name="310"></a>}
<a name="311"></a>
<a name="312"></a><span class="source_comment">// Clean up weapon inventory before level change since certain weapons
</span><a name="313"></a><span class="source_comment">// (sniper scopes with 3d scopes) won't get properly garbage collected
</span><a name="314"></a><span class="source_comment">// otherwise. This lead to the webadmin and memory leak issues - Ramm
</span><a name="315"></a>simulated function PreTravelCleanUp()
<a name="316"></a>{
<a name="317"></a>    local <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> Inv;
<a name="318"></a>    local <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span> invWeapon;
<a name="319"></a>    local <span class="source_type">int</span> count;
<a name="320"></a>
<a name="321"></a>    count=<span class="source_int">0</span>;
<a name="322"></a>
<a name="323"></a>    <span class="source_comment">// consider doing a check on count to make sure it doesn't get too high
</span><a name="324"></a>    <span class="source_comment">// and force Unreal to crash with a run away loop
</span><a name="325"></a>    for ( Inv=<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; Inv!=None; Inv=Inv.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="326"></a>    {
<a name="327"></a>        invWeapon = <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(Inv);
<a name="328"></a>        if ( invWeapon != None )
<a name="329"></a>        {
<a name="330"></a>            invWeapon.PreTravelCleanUp();
<a name="331"></a>        }
<a name="332"></a>
<a name="333"></a>        count++;
<a name="334"></a>
<a name="335"></a>        if( count &gt; <span class="source_int">500</span> )
<a name="336"></a>            break;
<a name="337"></a>    }
<a name="338"></a>}
<a name="339"></a>
<a name="340"></a><span class="source_comment">//returns how exposed this player is to another actor
</span><a name="341"></a>function <span class="source_type">float</span> GetExposureTo(<span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> TestLocation)
<a name="342"></a>{
<a name="343"></a>    local <span class="source_type">float</span> PercentExposed;
<a name="344"></a>
<a name="345"></a>    if( FastTrace(GetBoneCoords(HeadBone).Origin,TestLocation))
<a name="346"></a>    {
<a name="347"></a>        PercentExposed += <span class="source_int">0.5</span>;
<a name="348"></a>    }
<a name="349"></a>
<a name="350"></a>    if( FastTrace(GetBoneCoords(RootBone).Origin,TestLocation))
<a name="351"></a>    {
<a name="352"></a>        PercentExposed += <span class="source_int">0.5</span>;
<a name="353"></a>    }
<a name="354"></a>
<a name="355"></a>    return PercentExposed;
<a name="356"></a>}
<a name="357"></a>
<a name="358"></a>
<a name="359"></a><span class="source_comment">// Update the shadow if the detail settings have changed in the detail menu
</span><a name="360"></a>simulated function UpdateShadow()
<a name="361"></a>{
<a name="362"></a>    if (bActorShadows && bPlayerShadows && (<span class="source_type">Level</span>.NetMode != NM_DedicatedServer))
<a name="363"></a>    {
<a name="364"></a>        if (PlayerShadow != none)
<a name="365"></a>            PlayerShadow.Destroy();
<a name="366"></a>
<a name="367"></a>        if( bDetailedShadows )
<a name="368"></a>            PlayerShadow = Spawn(<span class="source_type">class</span><span class="source_name">'KFShadowProject'</span>,Self,<span class="source_name">''</span>,Location);
<a name="369"></a>        else PlayerShadow = Spawn(<span class="source_type">class</span><span class="source_name">'ShadowProjector'</span>,Self,<span class="source_name">''</span>,Location);
<a name="370"></a>        PlayerShadow.ShadowActor = self;
<a name="371"></a>        PlayerShadow.bBlobShadow = bBlobShadow;
<a name="372"></a>        PlayerShadow.LightDirection = Normal(vect(<span class="source_int">1</span>,<span class="source_int">1</span>,<span class="source_int">3</span>));
<a name="373"></a>        PlayerShadow.InitShadow();
<a name="374"></a>    }
<a name="375"></a>    else if (PlayerShadow != none && <span class="source_type">Level</span>.NetMode != NM_DedicatedServer)
<a name="376"></a>    {
<a name="377"></a>        PlayerShadow.Destroy();
<a name="378"></a>        PlayerShadow = none;
<a name="379"></a>    }
<a name="380"></a>}
<a name="381"></a>
<a name="382"></a>simulated function DoDerezEffect();
<a name="383"></a>
<a name="384"></a>function SetScriptedAnimData(
<a name="385"></a><span class="source_type">name</span> BaseAnim,
<a name="386"></a><span class="source_type">float</span> BlendInTime,
<a name="387"></a><span class="source_type">float</span> BlendOutTime,
<a name="388"></a><span class="source_type">float</span> AnimRate,
<a name="389"></a><span class="source_type">byte</span> AnimIterations,
<a name="390"></a><span class="source_type">bool</span> bLoopAnim,
<a name="391"></a><span class="source_type">float</span> StartFrame)
<a name="392"></a>{
<a name="393"></a>    ScriptedAnimData.BaseAnim       = BaseAnim;
<a name="394"></a>    ScriptedAnimData.BlendInTime    = BlendInTime;
<a name="395"></a>    ScriptedAnimData.BlendOutTime   = BlendOutTime;
<a name="396"></a>    ScriptedAnimdata.AnimRate       = AnimRate;
<a name="397"></a>    ScriptedAnimData.AnimIterations = AnimIterations;
<a name="398"></a>    ScriptedAnimData.bLoopAnim      = bLoopAnim;
<a name="399"></a>    ScriptedAnimData.StartFrame     = StartFrame;
<a name="400"></a>
<a name="401"></a>    <span class="source_comment">/* Play the anim on the server too*/</span>
<a name="402"></a>    if(Role == Role_Authority)
<a name="403"></a>    {
<a name="404"></a>        PlayScriptedAnim(ScriptedAnimData);
<a name="405"></a>    }
<a name="406"></a>
<a name="407"></a>}
<a name="408"></a>
<a name="409"></a>simulated function PlayScriptedAnim( <span class="source_type"><a href="../kfmod/kfpawn.html#SScriptedAnimRepInfo" class="source">SScriptedAnimRepInfo</a></span>  AnimData)
<a name="410"></a>{
<a name="411"></a>    if(AnimData.bLoopAnim)
<a name="412"></a>    {
<a name="413"></a>        LoopAnim(AnimData.BaseAnim, AnimData.AnimRate, AnimData.BlendInTime);
<a name="414"></a>    }
<a name="415"></a>    else
<a name="416"></a>    {
<a name="417"></a>        PlayAnim(AnimData.baseAnim,AnimData.AnimRate,AnimData.BlendInTime);
<a name="418"></a>    }
<a name="419"></a>
<a name="420"></a>    if( AnimData.StartFrame &gt; <span class="source_int">0.0</span> )
<a name="421"></a>       SetAnimFrame(AnimData.StartFrame, <span class="source_int">0</span>, <span class="source_int">1</span>);
<a name="422"></a>}
<a name="423"></a>
<a name="424"></a>simulated event PostNetReceive()
<a name="425"></a>{
<a name="426"></a>    if( ScriptedAnimData.BaseAnim != <span class="source_name">''</span>)
<a name="427"></a>    {
<a name="428"></a>        PlayScriptedAnim(ScriptedAnimData);
<a name="429"></a>        ScriptedAnimData.BaseAnim = <span class="source_name">''</span>;
<a name="430"></a>    }
<a name="431"></a>
<a name="432"></a>    if ( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != None )
<a name="433"></a>    {
<a name="434"></a>        Setup(<span class="source_type">class</span><span class="source_name">'xUtil'</span>.static.FindPlayerRecord(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.CharacterName));
<a name="435"></a>        bNetNotify = false;
<a name="436"></a>    }
<a name="437"></a>    else if ( (DrivenVehicle != None) && (DrivenVehicle.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != None) )
<a name="438"></a>    {
<a name="439"></a>        Setup(<span class="source_type">class</span><span class="source_name">'xUtil'</span>.static.FindPlayerRecord(DrivenVehicle.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.CharacterName));
<a name="440"></a>        bNetNotify = false;
<a name="441"></a>    }
<a name="442"></a>}
<a name="443"></a>
<a name="444"></a><span class="source_comment">// Don't let this pawn move for a certain amount of time
</span><a name="445"></a>function DisableMovement(<span class="source_type">float</span> DisableDuration)
<a name="446"></a>{
<a name="447"></a>    StopDisabledTime = <span class="source_type">Level</span>.TimeSeconds + DisableDuration;
<a name="448"></a>    bMovementDisabled = true;
<a name="449"></a>}
<a name="450"></a>
<a name="451"></a><span class="source_comment">// Modify the velocity of the pawn
</span><a name="452"></a>simulated event ModifyVelocity(<span class="source_type">float</span> <span class="source_type">DeltaTime</span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> OldVelocity)
<a name="453"></a>{
<a name="454"></a>    if( Role == ROLE_Authority )
<a name="455"></a>    {
<a name="456"></a>        if( bMovementDisabled )
<a name="457"></a>        {
<a name="458"></a>            if( <span class="source_type">Level</span>.TimeSeconds &gt; StopDisabledTime )
<a name="459"></a>            {
<a name="460"></a>                bMovementDisabled = false;
<a name="461"></a>            }
<a name="462"></a>        }
<a name="463"></a>    }
<a name="464"></a>
<a name="465"></a>    if( bMovementDisabled && Physics == PHYS_Walking )
<a name="466"></a>    {
<a name="467"></a>        Velocity.<span class="source_type">X</span> = <span class="source_int">0</span>;
<a name="468"></a>        Velocity.<span class="source_type">Y</span> = <span class="source_int">0</span>;
<a name="469"></a>        Velocity.<span class="source_type">Z</span> = <span class="source_int">0</span>;
<a name="470"></a>    }
<a name="471"></a>
<a name="472"></a>    if ( <span class="source_type"><a href="../kfmod/kfgamereplicationinfo.html" class="source">KFGameReplicationInfo</a></span>(<span class="source_type">Level</span>.GRI).BaseDifficulty &gt;= <span class="source_int">5</span> && bMovementDisabled && Velocity.<span class="source_type">Z</span> &gt; <span class="source_int">0</span> )
<a name="473"></a>    {
<a name="474"></a>        Velocity.<span class="source_type">Z</span> = <span class="source_int">0</span>;
<a name="475"></a>    }
<a name="476"></a>}
<a name="477"></a>
<a name="478"></a>function TakeFallingDamage()
<a name="479"></a>{
<a name="480"></a>    local <span class="source_type">float</span> Shake, EffectiveSpeed;
<a name="481"></a>    local <span class="source_type">float</span> UsedMaxFallSpeed;
<a name="482"></a>
<a name="483"></a>    UsedMaxFallSpeed = MaxFallSpeed;
<a name="484"></a>
<a name="485"></a>    <span class="source_comment">// Higher max fall speed in low grav so that weapons that push you around
</span><a name="486"></a>    <span class="source_comment">// don't cause you to die
</span><a name="487"></a>    if( <span class="source_type">Instigator</span> != none && <span class="source_type">Instigator</span>.<span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>.Gravity.<span class="source_type">Z</span> &gt; <span class="source_type">class</span><span class="source_name">'PhysicsVolume'</span>.default.Gravity.<span class="source_type">Z</span> )
<a name="488"></a>    {
<a name="489"></a>        UsedMaxFallSpeed *= <span class="source_int">2.0</span>;
<a name="490"></a>    }
<a name="491"></a>
<a name="492"></a>    if (Velocity.<span class="source_type">Z</span> &lt; -<span class="source_int">0.5</span> * UsedMaxFallSpeed)
<a name="493"></a>    {
<a name="494"></a>        if ( Role == ROLE_Authority )
<a name="495"></a>        {
<a name="496"></a>            MakeNoise(<span class="source_int">1.0</span>);
<a name="497"></a>            if (Velocity.<span class="source_type">Z</span> &lt; -<span class="source_int">1</span> * UsedMaxFallSpeed)
<a name="498"></a>            {
<a name="499"></a>                EffectiveSpeed = Velocity.<span class="source_type">Z</span>;
<a name="500"></a>                if ( TouchingWaterVolume() )
<a name="501"></a>                    EffectiveSpeed = FMin(<span class="source_int">0</span>, EffectiveSpeed + <span class="source_int">100</span>);
<a name="502"></a>                if ( EffectiveSpeed &lt; -<span class="source_int">1</span> * UsedMaxFallSpeed )
<a name="503"></a>                    TakeDamage(-<span class="source_int">100</span> * (EffectiveSpeed + UsedMaxFallSpeed)/UsedMaxFallSpeed, None, Location, vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>), <span class="source_type">class</span><span class="source_name">'Fell'</span>);
<a name="504"></a>            }
<a name="505"></a>        }
<a name="506"></a>        if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="507"></a>        {
<a name="508"></a>            Shake = FMin(<span class="source_int">1</span>, -<span class="source_int">1</span> * Velocity.<span class="source_type">Z</span>/MaxFallSpeed);
<a name="509"></a>            <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.DamageShake(Shake);
<a name="510"></a>        }
<a name="511"></a>    }
<a name="512"></a>    else if (Velocity.<span class="source_type">Z</span> &lt; -<span class="source_int">1.4</span> * JumpZ)
<a name="513"></a>        MakeNoise(<span class="source_int">0.5</span>);
<a name="514"></a>}
<a name="515"></a>
<a name="516"></a>exec function TestEye()
<a name="517"></a>{
<a name="518"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>;
<a name="519"></a>
<a name="520"></a>    if( !<span class="source_type">class</span><span class="source_name">'ROEngine.ROLevelInfo'</span>.static.RODebugMode() )
<a name="521"></a>        return;
<a name="522"></a>
<a name="523"></a>
<a name="524"></a>    ClearStayingDebugLines();
<a name="525"></a>    DrawDebugSphere( EyePosition() + Location, <span class="source_int">12</span>, <span class="source_int">12</span>, <span class="source_int">0</span>, <span class="source_int">255</span>, <span class="source_int">0</span>);
<a name="526"></a>
<a name="527"></a>    GetAxes( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.<span class="source_type">rotation</span>, <span class="source_type">X</span>, <span class="source_type">Y</span>, <span class="source_type">Z</span> );
<a name="528"></a>
<a name="529"></a>    DrawStayingDebugLine((EyePosition() + Location), (EyePosition() + Location)+<span class="source_int">500</span>* <span class="source_type">X</span>, <span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">255</span>);
<a name="530"></a>    DrawStayingDebugLine((EyePosition() + Location), (EyePosition() + Location)+<span class="source_int">200</span>* <span class="source_type">Y</span>, <span class="source_int">0</span>,<span class="source_int">255</span>,<span class="source_int">0</span>);
<a name="531"></a>    Spawn(<span class="source_type">class</span> <span class="source_name">'ROEngine.RODebugTracer'</span>,self,,(EyePosition() + Location),<span class="source_type">Rotation</span>);
<a name="532"></a>}
<a name="533"></a>
<a name="534"></a><span class="source_comment">/* DisplayDebug()
<a name="535"></a>list important actor variable on canvas.  Also show the pawn's controller and weapon info
<a name="536"></a>*/</span>
<a name="537"></a>simulated function DisplayDebug(<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span> <span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>, out <span class="source_type">float</span> <span class="source_type">YL</span>, out <span class="source_type">float</span> YPos)
<a name="538"></a>{
<a name="539"></a>    local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="540"></a>    local <span class="source_type">name</span>  <span class="source_type">Sequence</span>;
<a name="541"></a>    local <span class="source_type">float</span> Frame, Rate;
<a name="542"></a>
<a name="543"></a>    Super.DisplayDebug(<span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>, <span class="source_type">YL</span>, YPos);
<a name="544"></a>
<a name="545"></a>    for( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; <span class="source_int">16</span>; <span class="source_type">i</span>++ )
<a name="546"></a>    {
<a name="547"></a>        if( IsAnimating( <span class="source_type">i</span> ) )
<a name="548"></a>        {
<a name="549"></a>            GetAnimParams( <span class="source_type">i</span>, <span class="source_type">Sequence</span>, Frame, Rate );
<a name="550"></a>            <span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.DrawText(<span class="source_string">"Anim:: Channel("</span>@<span class="source_type">i</span>@<span class="source_string">") Frame("</span>@Frame@<span class="source_string">") Rate("</span>@Rate@<span class="source_string">") Name("</span>@<span class="source_type">Sequence</span>@<span class="source_string">")"</span>);
<a name="551"></a>            YPos += <span class="source_type">YL</span>;
<a name="552"></a>            <span class="source_type"><a href="../engine/canvas.html" class="source">Canvas</a></span>.SetPos(<span class="source_int">4</span>,YPos);
<a name="553"></a>        }
<a name="554"></a>    }
<a name="555"></a>}
<a name="556"></a>
<a name="557"></a>
<a name="558"></a>
<a name="559"></a>simulated function DoDamageFX( <span class="source_type">Name</span> boneName, <span class="source_type">int</span> <span class="source_type">Damage</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span> <span class="source_type">r</span> )
<a name="560"></a>{
<a name="561"></a>    local <span class="source_type">float</span> DismemberProbability;
<a name="562"></a>    local <span class="source_type">int</span> RandBone;
<a name="563"></a>    local <span class="source_type">bool</span> bDidSever;
<a name="564"></a>
<a name="565"></a>    <span class="source_comment">//log("DamageFX bonename = "$boneName$" "$Level.TimeSeconds$" Damage "$Damage);
</span><a name="566"></a>
<a name="567"></a>    if ( FRand() &gt; <span class="source_int">0.3f</span> || <span class="source_type">Damage</span> &gt; <span class="source_int">30</span> || Health &lt;= <span class="source_int">0</span> )
<a name="568"></a>    {
<a name="569"></a>        HitFX[HitFxTicker].damtype = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>;
<a name="570"></a>
<a name="571"></a>        if( Health &lt;= <span class="source_int">0</span> )
<a name="572"></a>        {
<a name="573"></a>            <span class="source_type">switch</span>( boneName )
<a name="574"></a>            {
<a name="575"></a>                case <span class="source_name">'neck'</span>:
<a name="576"></a>                    boneName = HeadBone;
<a name="577"></a>                    break;
<a name="578"></a>
<a name="579"></a>                case <span class="source_name">'lfoot'</span>:
<a name="580"></a>                case <span class="source_name">'lleg'</span>:
<a name="581"></a>                    boneName = <span class="source_name">'lthigh'</span>;
<a name="582"></a>                    break;
<a name="583"></a>
<a name="584"></a>                case <span class="source_name">'rfoot'</span>:
<a name="585"></a>                case <span class="source_name">'rleg'</span>:
<a name="586"></a>                    boneName = <span class="source_name">'rthigh'</span>;
<a name="587"></a>                    break;
<a name="588"></a>
<a name="589"></a>                case <span class="source_name">'righthand'</span>:
<a name="590"></a>                case <span class="source_name">'rshoulder'</span>:
<a name="591"></a>                case <span class="source_name">'rarm'</span>:
<a name="592"></a>                    boneName = <span class="source_name">'rfarm'</span>;
<a name="593"></a>                    break;
<a name="594"></a>
<a name="595"></a>                case <span class="source_name">'lefthand'</span>:
<a name="596"></a>                case <span class="source_name">'lshoulder'</span>:
<a name="597"></a>                case <span class="source_name">'larm'</span>:
<a name="598"></a>                    boneName = <span class="source_name">'lfarm'</span>;
<a name="599"></a>                    break;
<a name="600"></a>
<a name="601"></a>                case <span class="source_name">'None'</span>:
<a name="602"></a>                case <span class="source_name">'spine'</span>:
<a name="603"></a>                    boneName = FireRootBone;
<a name="604"></a>                    break;
<a name="605"></a>            }
<a name="606"></a>
<a name="607"></a>            if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bAlwaysSevers || (<span class="source_type">Damage</span> == <span class="source_int">1000</span>) )
<a name="608"></a>            {
<a name="609"></a>                HitFX[HitFxTicker].bSever = true;
<a name="610"></a>                bDidSever = true;
<a name="611"></a>                if ( boneName == <span class="source_name">'None'</span> )
<a name="612"></a>                {
<a name="613"></a>                    boneName = FireRootBone;
<a name="614"></a>                }
<a name="615"></a>            }
<a name="616"></a>            else if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.GibModifier &gt; <span class="source_int">0.0</span> )
<a name="617"></a>            {
<a name="618"></a>                DismemberProbability = Abs( (Health - <span class="source_type">Damage</span>*<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.GibModifier) / <span class="source_int">130.0f</span> );
<a name="619"></a>
<a name="620"></a>                if( FRand() &lt; DismemberProbability )
<a name="621"></a>                {
<a name="622"></a>                    HitFX[HitFxTicker].bSever = true;
<a name="623"></a>                    bDidSever = true;
<a name="624"></a>                }
<a name="625"></a>            }
<a name="626"></a>        }
<a name="627"></a>
<a name="628"></a>        if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bNeverSevers || <span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore()
<a name="629"></a>            || (<span class="source_type">Level</span>.Game != none && <span class="source_type">Level</span>.Game.PreventSever(self, boneName, <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>)) )
<a name="630"></a>        {
<a name="631"></a>            HitFX[HitFxTicker].bSever = false;
<a name="632"></a>            bDidSever = false;
<a name="633"></a>        }
<a name="634"></a>
<a name="635"></a>        if ( HitFX[HitFxTicker].bSever )
<a name="636"></a>        {
<a name="637"></a>            if( !<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bLocationalHit && (boneName == <span class="source_name">'None'</span> || boneName == FireRootBone ||
<a name="638"></a>                boneName == <span class="source_name">'Spine'</span> ))
<a name="639"></a>            {
<a name="640"></a>                RandBone = Rand(<span class="source_int">4</span>);
<a name="641"></a>
<a name="642"></a>                <span class="source_type">switch</span>( RandBone )
<a name="643"></a>                {
<a name="644"></a>                    case <span class="source_int">0</span>:
<a name="645"></a>                        boneName = <span class="source_name">'lthigh'</span>;
<a name="646"></a>                        break;
<a name="647"></a>                    case <span class="source_int">1</span>:
<a name="648"></a>                        boneName = <span class="source_name">'rthigh'</span>;
<a name="649"></a>                        break;
<a name="650"></a>                    case <span class="source_int">2</span>:
<a name="651"></a>                        boneName = <span class="source_name">'lfarm'</span>;
<a name="652"></a>                        break;
<a name="653"></a>                    case <span class="source_int">3</span>:
<a name="654"></a>                        boneName = <span class="source_name">'rfarm'</span>;
<a name="655"></a>                        break;
<a name="656"></a>                    case <span class="source_int">4</span>:
<a name="657"></a>                        boneName = HeadBone;
<a name="658"></a>                        break;
<a name="659"></a>                    default:
<a name="660"></a>                        boneName = <span class="source_name">'lthigh'</span>;
<a name="661"></a>                }
<a name="662"></a>            }
<a name="663"></a>        }
<a name="664"></a>
<a name="665"></a>        if( Health &lt; <span class="source_int">0</span> && <span class="source_type">Damage</span> &gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.HumanObliterationThreshhold && <span class="source_type">Damage</span> != <span class="source_int">1000</span> )
<a name="666"></a>        {
<a name="667"></a>            boneName = <span class="source_name">'obliterate'</span>;
<a name="668"></a>        }
<a name="669"></a>
<a name="670"></a>        HitFX[HitFxTicker].bone = boneName;
<a name="671"></a>        HitFX[HitFxTicker].rotDir = <span class="source_type">r</span>;
<a name="672"></a>        HitFxTicker = HitFxTicker + <span class="source_int">1</span>;
<a name="673"></a>        if( HitFxTicker &gt; ArrayCount(HitFX)-<span class="source_int">1</span> )
<a name="674"></a>            HitFxTicker = <span class="source_int">0</span>;
<a name="675"></a>
<a name="676"></a>        <span class="source_comment">// If this was a really hardcore damage from an explosion, randomly spawn some arms and legs
</span><a name="677"></a>        if ( bDidSever && !<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bLocationalHit && <span class="source_type">Damage</span> &gt; <span class="source_int">200</span> && <span class="source_type">Damage</span> != <span class="source_int">1000</span> )
<a name="678"></a>        {
<a name="679"></a>            if ((<span class="source_type">Damage</span> &gt; <span class="source_int">400</span> && FRand() &lt; <span class="source_int">0.3</span>) || FRand() &lt; <span class="source_int">0.1</span> )
<a name="680"></a>            {
<a name="681"></a>                DoDamageFX(HeadBone,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="682"></a>                DoDamageFX(<span class="source_name">'lthigh'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="683"></a>                DoDamageFX(<span class="source_name">'rthigh'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="684"></a>                DoDamageFX(<span class="source_name">'lfarm'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="685"></a>                DoDamageFX(<span class="source_name">'rfarm'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="686"></a>            }
<a name="687"></a>            if ( FRand() &lt; <span class="source_int">0.25</span> )
<a name="688"></a>            {
<a name="689"></a>                DoDamageFX(<span class="source_name">'lthigh'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="690"></a>                DoDamageFX(<span class="source_name">'rthigh'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="691"></a>                if ( FRand() &lt; <span class="source_int">0.5</span> )
<a name="692"></a>                {
<a name="693"></a>                    DoDamageFX(<span class="source_name">'lfarm'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="694"></a>                }
<a name="695"></a>                else
<a name="696"></a>                {
<a name="697"></a>                    DoDamageFX(<span class="source_name">'rfarm'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="698"></a>                }
<a name="699"></a>            }
<a name="700"></a>            else if ( FRand() &lt; <span class="source_int">0.35</span> )
<a name="701"></a>                DoDamageFX(<span class="source_name">'lthigh'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="702"></a>            else if ( FRand() &lt; <span class="source_int">0.5</span> )
<a name="703"></a>                DoDamageFX(<span class="source_name">'rthigh'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="704"></a>            else if ( FRand() &lt; <span class="source_int">0.75</span> )
<a name="705"></a>            {
<a name="706"></a>                if ( FRand() &lt; <span class="source_int">0.5</span> )
<a name="707"></a>                {
<a name="708"></a>                    DoDamageFX(<span class="source_name">'lfarm'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="709"></a>                }
<a name="710"></a>                else
<a name="711"></a>                {
<a name="712"></a>                    DoDamageFX(<span class="source_name">'rfarm'</span>,<span class="source_int">1000</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">r</span>);
<a name="713"></a>                }
<a name="714"></a>            }
<a name="715"></a>        }
<a name="716"></a>    }
<a name="717"></a>}
<a name="718"></a>
<a name="719"></a>
<a name="720"></a><span class="source_comment">//Stops the green shit when a player dies.
</span><a name="721"></a>simulated function PlayDying(<span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> HitLoc)
<a name="722"></a>{
<a name="723"></a>    local <span class="source_type">float</span> frame, rate;
<a name="724"></a>    local <span class="source_type">name</span> seq;
<a name="725"></a>    local <span class="source_type"><a href="../old2k4/lavadeath.html" class="source">LavaDeath</a></span> LD;
<a name="726"></a>    local <span class="source_type"><a href="../kfmod/miscemmiter.html" class="source">MiscEmmiter</a></span> BE;
<a name="727"></a>
<a name="728"></a>    if( Adjuster!=None )
<a name="729"></a>        Adjuster.Destroy();
<a name="730"></a>    bHasFootAdjust = False;
<a name="731"></a>    <span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> = None;
<a name="732"></a>    bCanTeleport = false; <span class="source_comment">// sjs - fix karma going crazy when corpses land on teleporters
</span><a name="733"></a>    bReplicateMovement = false;
<a name="734"></a>    bTearOff = true;
<a name="735"></a>    bPlayedDeath = true;
<a name="736"></a>    <span class="source_comment">//bFrozenBody = true;
</span><a name="737"></a>
<a name="738"></a>    SafeMesh = <span class="source_type">Mesh</span>;
<a name="739"></a>
<a name="740"></a>    if (CurrentCombo != None)
<a name="741"></a>        CurrentCombo.Destroy();
<a name="742"></a>
<a name="743"></a>    HitDamageType = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>; <span class="source_comment">// these are replicated to other clients
</span><a name="744"></a>    TakeHitLocation = HitLoc;
<a name="745"></a>
<a name="746"></a>    if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> != None )
<a name="747"></a>    {
<a name="748"></a>        if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bSkeletize )
<a name="749"></a>        {
<a name="750"></a>            SetOverlayMaterial(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DamageOverlayMaterial, <span class="source_int">4.0</span>, true);
<a name="751"></a>            if (!bSkeletized)
<a name="752"></a>            {
<a name="753"></a>                if ( (<span class="source_type">Level</span>.NetMode != NM_DedicatedServer) && (SkeletonMesh != None) )
<a name="754"></a>                {
<a name="755"></a>                    if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bLeaveBodyEffect )
<a name="756"></a>                    {
<a name="757"></a>                        BE = spawn(<span class="source_type">class</span><span class="source_name">'MiscEmmiter'</span>,self);
<a name="758"></a>                        if ( BE != None )
<a name="759"></a>                        {
<a name="760"></a>                            BE.<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>;
<a name="761"></a>                            BE.HitLoc = HitLoc;
<a name="762"></a>                            bFrozenBody = true;
<a name="763"></a>                        }
<a name="764"></a>                    }
<a name="765"></a>                    GetAnimParams( <span class="source_int">0</span>, seq, frame, rate );
<a name="766"></a>                    LinkMesh(SkeletonMesh, true);
<a name="767"></a>                    Skins.Length = <span class="source_int">0</span>;
<a name="768"></a>                    PlayAnim(seq, <span class="source_int">0</span>, <span class="source_int">0</span>);
<a name="769"></a>                    SetAnimFrame(frame);
<a name="770"></a>                }
<a name="771"></a>                if (Physics == PHYS_Walking)
<a name="772"></a>                    Velocity = Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="773"></a>                SetTearOffMomemtum(GetTearOffMomemtum() * <span class="source_int">0.25</span>);
<a name="774"></a>                bSkeletized = true;
<a name="775"></a>                if ( (<span class="source_type">Level</span>.NetMode != NM_DedicatedServer) && (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> == <span class="source_type">class</span><span class="source_name">'FellLava'</span>) )
<a name="776"></a>                {
<a name="777"></a>                    LD = spawn(<span class="source_type">class</span><span class="source_name">'LavaDeath'</span>, , , Location + vect(<span class="source_int">0</span>, <span class="source_int">0</span>, <span class="source_int">10</span>), <span class="source_type">Rotation</span> );
<a name="778"></a>                    if ( LD != None )
<a name="779"></a>                        LD.SetBase(self);
<a name="780"></a>                    PlaySound( <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span><span class="source_name">'Inf_Weapons.F1.f1_explode01'</span>, SLOT_None, <span class="source_int">1.5</span>*TransientSoundVolume ); <span class="source_comment">// KFTODO: Replace this sound
</span><a name="781"></a>                }
<a name="782"></a>            }
<a name="783"></a>        }
<a name="784"></a>        else if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DeathOverlayMaterial != None )
<a name="785"></a>            SetOverlayMaterial(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DeathOverlayMaterial, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DeathOverlayTime, true);
<a name="786"></a>        else if ( (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DamageOverlayMaterial != None) && (<span class="source_type">Level</span>.DetailMode != DM_Low) && !<span class="source_type">Level</span>.bDropDetail )
<a name="787"></a>            SetOverlayMaterial(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DamageOverlayMaterial, <span class="source_int">2</span>*<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DamageOverlayTime, true);
<a name="788"></a>    }
<a name="789"></a>
<a name="790"></a>    <span class="source_comment">// stop shooting
</span><a name="791"></a>    AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">0.0</span>);
<a name="792"></a>    FireState = FS_None;
<a name="793"></a>    <span class="source_comment">//LifeSpan = RagdollLifeSpan;
</span><a name="794"></a>
<a name="795"></a>    GotoState(<span class="source_name">'Dying'</span>);
<a name="796"></a>    if ( BE != None )
<a name="797"></a>        return;
<a name="798"></a>
<a name="799"></a>    PlayDyingAnimation(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, HitLoc);
<a name="800"></a>}
<a name="801"></a>
<a name="802"></a>function PlayDyingAnimation(<span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> HitLoc)
<a name="803"></a>{
<a name="804"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> shotDir, hitLocRel, deathAngVel, shotStrength;
<a name="805"></a>    local <span class="source_type">float</span> maxDim;
<a name="806"></a>    local <span class="source_type">string</span> RagSkelName;
<a name="807"></a>    local <span class="source_type"><a href="../engine/karmaparamsskel.html" class="source">KarmaParamsSkel</a></span> skelParams;
<a name="808"></a>    local <span class="source_type">bool</span> PlayersRagdoll;
<a name="809"></a>    local <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span> <span class="source_type">pc</span>;
<a name="810"></a>
<a name="811"></a>    if ( <span class="source_type">Level</span>.NetMode != NM_DedicatedServer )
<a name="812"></a>    {
<a name="813"></a>        <span class="source_comment">// Is this the local player's ragdoll?
</span><a name="814"></a>        if(OldController != None)
<a name="815"></a>            <span class="source_type">pc</span> = <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(OldController);
<a name="816"></a>        if( <span class="source_type">pc</span> != none && <span class="source_type">pc</span>.<span class="source_type">ViewTarget</span> == self )
<a name="817"></a>            PlayersRagdoll = true;
<a name="818"></a>
<a name="819"></a>        <span class="source_comment">// In low physics detail, if we were not just controlling this pawn,
</span><a name="820"></a>        <span class="source_comment">// and it has not been rendered in 3 seconds, just destroy it.
</span><a name="821"></a>        if( <span class="source_type">Level</span>.PhysicsDetailLevel!=PDL_High && !PlayersRagdoll && (<span class="source_type">Level</span>.TimeSeconds-LastRenderTime)&gt;<span class="source_int">3</span> )
<a name="822"></a>        {
<a name="823"></a>            GoTo<span class="source_name">'NonRagdoll'</span>;
<a name="824"></a>            return;
<a name="825"></a>        }
<a name="826"></a>
<a name="827"></a>        <span class="source_comment">// Try and obtain a rag-doll setup. Use optional 'override' one out of player record first, then use the species one.
</span><a name="828"></a>        if( RagdollOverride != <span class="source_string">""</span>)
<a name="829"></a>            RagSkelName = RagdollOverride;
<a name="830"></a>        else if(Species != None)
<a name="831"></a>            RagSkelName = Species.static.GetRagSkelName( GetMeshName() );
<a name="832"></a>        else RagSkelName = <span class="source_string">"Male1"</span>; <span class="source_comment">// Otherwise assume it is Male1 ragdoll were after here.
</span><a name="833"></a>
<a name="834"></a>        KMakeRagdollAvailable();
<a name="835"></a>
<a name="836"></a>        if( KIsRagdollAvailable() && RagSkelName != <span class="source_string">""</span> )
<a name="837"></a>        {
<a name="838"></a>            skelParams = <span class="source_type"><a href="../engine/karmaparamsskel.html" class="source">KarmaParamsSkel</a></span>(KParams);
<a name="839"></a>            skelParams.KSkeleton = RagSkelName;
<a name="840"></a>
<a name="841"></a>            <span class="source_comment">// Stop animation playing.
</span><a name="842"></a>            StopAnimating(true);
<a name="843"></a>
<a name="844"></a>            if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> != None )
<a name="845"></a>            {
<a name="846"></a>                if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bLeaveBodyEffect )
<a name="847"></a>                    TearOffMomentum = vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="848"></a>
<a name="849"></a>                if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bKUseOwnDeathVel )
<a name="850"></a>                {
<a name="851"></a>                    RagDeathVel = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.KDeathVel;
<a name="852"></a>                    RagDeathUpKick = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.KDeathUpKick;
<a name="853"></a>                }
<a name="854"></a>            }
<a name="855"></a>
<a name="856"></a>            <span class="source_comment">// Set the dude moving in direction he was shot in general
</span><a name="857"></a>            shotDir = Normal(GetTearOffMomemtum());
<a name="858"></a>            shotStrength = RagDeathVel * shotDir;
<a name="859"></a>
<a name="860"></a>            <span class="source_comment">// Calculate angular velocity to impart, based on shot location.
</span><a name="861"></a>            hitLocRel = TakeHitLocation - Location;
<a name="862"></a>
<a name="863"></a>            <span class="source_comment">// We scale the hit location out sideways a bit, to get more spin around Z.
</span><a name="864"></a>            hitLocRel.<span class="source_type">X</span> *= RagSpinScale;
<a name="865"></a>            hitLocRel.<span class="source_type">Y</span> *= RagSpinScale;
<a name="866"></a>
<a name="867"></a>            <span class="source_comment">// If the tear off momentum was very small for some reason, make up some angular velocity for the pawn
</span><a name="868"></a>            if( VSize(GetTearOffMomemtum()) &lt; <span class="source_int">0.01</span> )
<a name="869"></a>            {
<a name="870"></a>                <span class="source_comment">//Log("TearOffMomentum magnitude of Zero");
</span><a name="871"></a>                deathAngVel = VRand() * <span class="source_int">18000.0</span>;
<a name="872"></a>            }
<a name="873"></a>            else deathAngVel = RagInvInertia * (hitLocRel Cross shotStrength);
<a name="874"></a>
<a name="875"></a>            <span class="source_comment">// Set initial angular and linear velocity for ragdoll.
</span><a name="876"></a>            <span class="source_comment">// Scale horizontal velocity for characters - they run really fast!
</span><a name="877"></a>            if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.bRubbery )
<a name="878"></a>                skelParams.KStartLinVel = vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="879"></a>            if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">Damagetype</a></span>.default.bKUseTearOffMomentum )
<a name="880"></a>                skelParams.KStartLinVel = GetTearOffMomemtum() + Velocity;
<a name="881"></a>            else
<a name="882"></a>            {
<a name="883"></a>                skelParams.KStartLinVel.<span class="source_type">X</span> = <span class="source_int">0.6</span> * Velocity.<span class="source_type">X</span>;
<a name="884"></a>                skelParams.KStartLinVel.<span class="source_type">Y</span> = <span class="source_int">0.6</span> * Velocity.<span class="source_type">Y</span>;
<a name="885"></a>                skelParams.KStartLinVel.<span class="source_type">Z</span> = <span class="source_int">1.0</span> * Velocity.<span class="source_type">Z</span>;
<a name="886"></a>                skelParams.KStartLinVel += shotStrength;
<a name="887"></a>            }
<a name="888"></a>            <span class="source_comment">// If not moving downwards - give extra upward kick
</span><a name="889"></a>            if( !<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bLeaveBodyEffect && !<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.bRubbery && (Velocity.<span class="source_type">Z</span> &gt; -<span class="source_int">10</span>) )
<a name="890"></a>                skelParams.KStartLinVel.<span class="source_type">Z</span> += RagDeathUpKick;
<a name="891"></a>
<a name="892"></a>            if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.bRubbery )
<a name="893"></a>            {
<a name="894"></a>                Velocity = vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="895"></a>                skelParams.KStartAngVel = vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="896"></a>            }
<a name="897"></a>            else
<a name="898"></a>            {
<a name="899"></a>                skelParams.KStartAngVel = deathAngVel;
<a name="900"></a>
<a name="901"></a>                <span class="source_comment">// Set up deferred shot-bone impulse
</span><a name="902"></a>                maxDim = <span class="source_type">Max</span>(CollisionRadius, CollisionHeight);
<a name="903"></a>
<a name="904"></a>                skelParams.KShotStart = TakeHitLocation - (<span class="source_int">1</span> * shotDir);
<a name="905"></a>                skelParams.KShotEnd = TakeHitLocation + (<span class="source_int">2</span>*maxDim*shotDir);
<a name="906"></a>                skelParams.KShotStrength = RagShootStrength;
<a name="907"></a>            }
<a name="908"></a>
<a name="909"></a>            <span class="source_comment">// If this damage type causes convulsions, turn them on here.
</span><a name="910"></a>            if(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> != None && <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bCauseConvulsions)
<a name="911"></a>            {
<a name="912"></a>                RagConvulseMaterial=<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DamageOverlayMaterial;
<a name="913"></a>                skelParams.bKDoConvulsions = true;
<a name="914"></a>            }
<a name="915"></a>
<a name="916"></a>            <span class="source_comment">// Turn on Karma collision for ragdoll.
</span><a name="917"></a>            KSetBlockKarma(true);
<a name="918"></a>
<a name="919"></a>            <span class="source_comment">// Set physics mode to ragdoll.
</span><a name="920"></a>            <span class="source_comment">// This doesn't actaully start it straight away, it's deferred to the first tick.
</span><a name="921"></a>            SetPhysics(PHYS_KarmaRagdoll);
<a name="922"></a>
<a name="923"></a>            <span class="source_comment">// If viewing this ragdoll, set the flag to indicate that it is 'important'
</span><a name="924"></a>            if( PlayersRagdoll )
<a name="925"></a>                skelParams.bKImportantRagdoll = true;
<a name="926"></a>
<a name="927"></a>            skelParams.bRubbery = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.bRubbery;
<a name="928"></a>            bRubbery = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.bRubbery;
<a name="929"></a>
<a name="930"></a>            skelParams.KActorGravScale = RagGravScale;
<a name="931"></a>
<a name="932"></a>            return;
<a name="933"></a>        }
<a name="934"></a>        <span class="source_comment">// jag
</span><a name="935"></a>    }
<a name="936"></a>
<a name="937"></a>NonRagdoll:
<a name="938"></a>    <span class="source_comment">// non-ragdoll death fallback
</span><a name="939"></a>    Velocity += GetTearOffMomemtum();
<a name="940"></a>    BaseEyeHeight = Default.BaseEyeHeight;
<a name="941"></a>    SetTwistLook(<span class="source_int">0</span>, <span class="source_int">0</span>);
<a name="942"></a>    SetInvisibility(<span class="source_int">0.0</span>);
<a name="943"></a>    PlayDirectionalDeath(HitLoc);
<a name="944"></a>    SetPhysics(PHYS_Falling);
<a name="945"></a>}
<a name="946"></a>
<a name="947"></a><span class="source_comment">// jag
</span><a name="948"></a><span class="source_comment">// Called when in Ragdoll when we hit something over a certain threshold velocity
</span><a name="949"></a><span class="source_comment">// Used to play impact sounds.
</span><a name="950"></a>event KImpact(<span class="source_type"><a href="../engine/actor.html" class="source">actor</a></span> <span class="source_type">other</span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">pos</span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> impactVel, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> impactNorm)
<a name="951"></a>{
<a name="952"></a>    local <span class="source_type">float</span> VelocitySquared;
<a name="953"></a>    local <span class="source_type">float</span> RagHitVolume;
<a name="954"></a>
<a name="955"></a>    if(<span class="source_type">Level</span>.TimeSeconds &gt; RagLastSoundTime + RagImpactSoundInterval)
<a name="956"></a>    {
<a name="957"></a>        VelocitySquared = VSizeSquared(impactVel);
<a name="958"></a>
<a name="959"></a>        <span class="source_comment">//log("Ragimpact velocity: "$VSize(impactVel)$" VelocitySquared: "$VelocitySquared);
</span><a name="960"></a>
<a name="961"></a>        RagHitVolume = FMin(<span class="source_int">2.0</span>,(VelocitySquared/<span class="source_int">40000</span>));
<a name="962"></a>
<a name="963"></a>        <span class="source_comment">//log("RagHitVolume = "$RagHitVolume);
</span><a name="964"></a>
<a name="965"></a>        PlaySound(RagImpactSounds[<span class="source_int">0</span>], SLOT_None, RagHitVolume);
<a name="966"></a>        RagLastSoundTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="967"></a>    }
<a name="968"></a>}
<a name="969"></a><span class="source_comment">//jag
</span><a name="970"></a>
<a name="971"></a>simulated function <span class="source_type">bool</span> ForceDefaultCharacter()
<a name="972"></a>{
<a name="973"></a>    return false;
<a name="974"></a>}
<a name="975"></a>
<a name="976"></a>simulated function ProcessHitFX()
<a name="977"></a>{
<a name="978"></a>    local <span class="source_type"><a href="../core/object.html#Coords" class="source">Coords</a></span> boneCoords;
<a name="979"></a>    local <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/xemitter.html" class="source">xEmitter</a></span>&gt; HitEffects[<span class="source_int">4</span>];
<a name="980"></a>    local <span class="source_type">int</span> <span class="source_type">i</span>,j;
<a name="981"></a>    local <span class="source_type">float</span> <span class="source_type">GibPerterbation</span>;
<a name="982"></a>
<a name="983"></a>    if( (<span class="source_type">Level</span>.NetMode == NM_DedicatedServer) || bSkeletized || (<span class="source_type">Mesh</span> == SkeletonMesh) )
<a name="984"></a>    {
<a name="985"></a>        SimHitFxTicker = HitFxTicker;
<a name="986"></a>        return;
<a name="987"></a>    }
<a name="988"></a>
<a name="989"></a>    for ( SimHitFxTicker = SimHitFxTicker; SimHitFxTicker != HitFxTicker; SimHitFxTicker = (SimHitFxTicker + <span class="source_int">1</span>) % ArrayCount(HitFX) )
<a name="990"></a>    {
<a name="991"></a>        j++;
<a name="992"></a>        if ( j &gt; <span class="source_int">30</span> )
<a name="993"></a>        {
<a name="994"></a>            SimHitFxTicker = HitFxTicker;
<a name="995"></a>            return;
<a name="996"></a>        }
<a name="997"></a>
<a name="998"></a>        if( (HitFX[SimHitFxTicker].damtype == None) || (<span class="source_type">Level</span>.bDropDetail && (<span class="source_type">Level</span>.TimeSeconds - LastRenderTime &gt; <span class="source_int">3</span>) && !IsHumanControlled()) )
<a name="999"></a>            continue;
<a name="1000"></a>
<a name="1001"></a>        <span class="source_comment">//log("Processing effects for damtype "$HitFX[SimHitFxTicker].damtype);
</span><a name="1002"></a>
<a name="1003"></a>        if( HitFX[SimHitFxTicker].bone == <span class="source_name">'obliterate'</span> && !<span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore())
<a name="1004"></a>        {
<a name="1005"></a>            SpawnGibs( HitFX[SimHitFxTicker].rotDir, <span class="source_int">0</span>);
<a name="1006"></a>            bGibbed = true;
<a name="1007"></a>            <span class="source_comment">// Wait a tick on a listen server so the obliteration can replicate before the pawn is destroyed
</span><a name="1008"></a>			if( <span class="source_type">Level</span>.NetMode == NM_ListenServer )
<a name="1009"></a>			{
<a name="1010"></a>                bDestroyNextTick = true;
<a name="1011"></a>                TimeSetDestroyNextTickTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="1012"></a>            }
<a name="1013"></a>            else
<a name="1014"></a>            {
<a name="1015"></a>                Destroy();
<a name="1016"></a>			}
<a name="1017"></a>            return;
<a name="1018"></a>        }
<a name="1019"></a>
<a name="1020"></a>        boneCoords = GetBoneCoords( HitFX[SimHitFxTicker].bone );
<a name="1021"></a>
<a name="1022"></a>        if ( !<span class="source_type">Level</span>.bDropDetail && !<span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.NoBlood() && !bSkeletized )
<a name="1023"></a>            {
<a name="1024"></a>            <span class="source_comment">//AttachEmitterEffect( BleedingEmitterClass, HitFX[SimHitFxTicker].bone, boneCoords.Origin, HitFX[SimHitFxTicker].rotDir );
</span><a name="1025"></a>
<a name="1026"></a>            HitFX[SimHitFxTicker].damtype.static.GetHitEffects( HitEffects, Health );
<a name="1027"></a>
<a name="1028"></a>            if( !<span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>.bWaterVolume ) <span class="source_comment">// don't attach effects under water
</span><a name="1029"></a>            {
<a name="1030"></a>                for( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; ArrayCount(HitEffects); <span class="source_type">i</span>++ )
<a name="1031"></a>                {
<a name="1032"></a>                    if( HitEffects[<span class="source_type">i</span>] == None )
<a name="1033"></a>                        continue;
<a name="1034"></a>
<a name="1035"></a>                    AttachEffect( HitEffects[<span class="source_type">i</span>], HitFX[SimHitFxTicker].bone, boneCoords.Origin, HitFX[SimHitFxTicker].rotDir );
<a name="1036"></a>                }
<a name="1037"></a>            }
<a name="1038"></a>        }
<a name="1039"></a>        if ( <span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore() )
<a name="1040"></a>            HitFX[SimHitFxTicker].bSever = false;
<a name="1041"></a>
<a name="1042"></a>        if( HitFX[SimHitFxTicker].bSever )
<a name="1043"></a>        {
<a name="1044"></a>            <span class="source_type">GibPerterbation</span> = HitFX[SimHitFxTicker].damtype.default.<span class="source_type">GibPerterbation</span>;
<a name="1045"></a>            bFlaming = HitFX[SimHitFxTicker].DamType.Default.bFlaming;
<a name="1046"></a>
<a name="1047"></a>            <span class="source_type">switch</span>( HitFX[SimHitFxTicker].bone )
<a name="1048"></a>            {
<a name="1049"></a>                case <span class="source_name">'obliterate'</span>:
<a name="1050"></a>                    break;
<a name="1051"></a>
<a name="1052"></a>                case <span class="source_name">'lthigh'</span>:
<a name="1053"></a>                    if( !bLeftLegGibbed )
<a name="1054"></a>                    {
<a name="1055"></a>                        SpawnSeveredGiblet( DetachedLegClass, boneCoords.Origin, HitFX[SimHitFxTicker].rotDir, <span class="source_type">GibPerterbation</span> );
<a name="1056"></a>                        bLeftLegGibbed=true;
<a name="1057"></a>                    }
<a name="1058"></a>                    break;
<a name="1059"></a>
<a name="1060"></a>                case <span class="source_name">'rthigh'</span>:
<a name="1061"></a>                    if( !bRightLegGibbed )
<a name="1062"></a>                    {
<a name="1063"></a>                        SpawnSeveredGiblet( DetachedLegClass, boneCoords.Origin, HitFX[SimHitFxTicker].rotDir, <span class="source_type">GibPerterbation</span> );
<a name="1064"></a>                        bRightLegGibbed=true;
<a name="1065"></a>                    }
<a name="1066"></a>                    break;
<a name="1067"></a>
<a name="1068"></a>                case <span class="source_name">'lfarm'</span>:
<a name="1069"></a>                    if( !bLeftArmGibbed )
<a name="1070"></a>                    {
<a name="1071"></a>                        SpawnSeveredGiblet( DetachedArmClass, boneCoords.Origin, HitFX[SimHitFxTicker].rotDir, <span class="source_type">GibPerterbation</span> );
<a name="1072"></a>                        bLeftArmGibbed=true;
<a name="1073"></a>                    }
<a name="1074"></a>                    break;
<a name="1075"></a>
<a name="1076"></a>                case <span class="source_name">'rfarm'</span>:
<a name="1077"></a>                    if( !bRightArmGibbed )
<a name="1078"></a>                    {
<a name="1079"></a>                        SpawnSeveredGiblet( DetachedArmClass, boneCoords.Origin, HitFX[SimHitFxTicker].rotDir, <span class="source_type">GibPerterbation</span> );
<a name="1080"></a>                        bRightArmGibbed=true;
<a name="1081"></a>                    }
<a name="1082"></a>                    break;
<a name="1083"></a>
<a name="1084"></a>                case <span class="source_name">'head'</span>:
<a name="1085"></a>                    SpawnGiblet( GetGibClass(EGT_Head), boneCoords.Origin, HitFX[SimHitFxTicker].rotDir, <span class="source_type">GibPerterbation</span> );
<a name="1086"></a>                    break;
<a name="1087"></a>            }
<a name="1088"></a>
<a name="1089"></a>            if (LastHitDamType == <span class="source_type">class</span> <span class="source_name">'SirenScreamDamage'</span>)
<a name="1090"></a>                HideBone(HeadBone);
<a name="1091"></a>            else if( HitFX[SimHitFXTicker].bone != <span class="source_name">'Spine'</span> && HitFX[SimHitFXTicker].bone != FireRootBone )
<a name="1092"></a>                HideBone(HitFX[SimHitFxTicker].bone);
<a name="1093"></a>        }
<a name="1094"></a>    }
<a name="1095"></a>}
<a name="1096"></a>
<a name="1097"></a>simulated function SpawnSeveredGiblet( <span class="source_type">class</span>&lt;<span class="source_type"><a href="../roeffects/severedappendage.html" class="source">SeveredAppendage</a></span>&gt; GibClass, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> Location, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span> <span class="source_type">Rotation</span>, <span class="source_type">float</span> <span class="source_type">GibPerterbation</span> )
<a name="1098"></a>{
<a name="1099"></a>    local <span class="source_type"><a href="../roeffects/severedappendage.html" class="source">SeveredAppendage</a></span> Giblet;
<a name="1100"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">Direction</span>, Dummy;
<a name="1101"></a>
<a name="1102"></a>    if( (GibClass == None) || <span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore() )
<a name="1103"></a>        return;
<a name="1104"></a>
<a name="1105"></a>    <span class="source_type">Instigator</span> = self;
<a name="1106"></a>    Giblet = Spawn( GibClass,,, Location, <span class="source_type">Rotation</span> );
<a name="1107"></a>    if( Giblet == None )
<a name="1108"></a>        return;
<a name="1109"></a>    Giblet.SpawnTrail();
<a name="1110"></a>
<a name="1111"></a>    <span class="source_type">GibPerterbation</span> *= <span class="source_int">32768.0</span>;
<a name="1112"></a>    <span class="source_type">Rotation</span>.Pitch += ( FRand() * <span class="source_int">2.0</span> * <span class="source_type">GibPerterbation</span> ) - <span class="source_type">GibPerterbation</span>;
<a name="1113"></a>    <span class="source_type">Rotation</span>.Yaw += ( FRand() * <span class="source_int">2.0</span> * <span class="source_type">GibPerterbation</span> ) - <span class="source_type">GibPerterbation</span>;
<a name="1114"></a>    <span class="source_type">Rotation</span>.Roll += ( FRand() * <span class="source_int">2.0</span> * <span class="source_type">GibPerterbation</span> ) - <span class="source_type">GibPerterbation</span>;
<a name="1115"></a>
<a name="1116"></a>    GetAxes( <span class="source_type">Rotation</span>, Dummy, Dummy, <span class="source_type">Direction</span> );
<a name="1117"></a>
<a name="1118"></a>    Giblet.Velocity = Velocity + Normal(<span class="source_type">Direction</span>) * (Giblet.MaxSpeed + (Giblet.MaxSpeed/<span class="source_int">2</span>) * FRand());
<a name="1119"></a>    <span class="source_comment">//Giblet.LifeSpan = self.RagdollLifeSpan;
</span><a name="1120"></a>}
<a name="1121"></a>
<a name="1122"></a>function <span class="source_type">class</span>&lt;<span class="source_type"><a href="../old2k4/gib.html" class="source">Gib</a></span>&gt; GetGibClass(<span class="source_type"><a href="../old2k4/xpawngibgroup.html" class="source">xPawnGibGroup</a></span>.<span class="source_type"><a href="../old2k4/xpawngibgroup.html#EGibType" class="source">EGibType</a></span> gibType)
<a name="1123"></a>{
<a name="1124"></a>    return GibGroupClass.static.GetGibClass(gibType);
<a name="1125"></a>}
<a name="1126"></a>
<a name="1127"></a>simulated function HideBone(<span class="source_type">name</span> boneName)
<a name="1128"></a>{
<a name="1129"></a>    local <span class="source_type">int</span> BoneScaleSlot;
<a name="1130"></a>    local <span class="source_type"><a href="../core/object.html#Coords" class="source">coords</a></span> boneCoords;
<a name="1131"></a>
<a name="1132"></a>    if( boneName == <span class="source_name">'lthigh'</span> )
<a name="1133"></a>    {
<a name="1134"></a>        boneScaleSlot = <span class="source_int">0</span>;
<a name="1135"></a>        if( SeveredLeftLeg == none )
<a name="1136"></a>        {
<a name="1137"></a>            SeveredLeftLeg = Spawn(SeveredLegAttachClass,self);
<a name="1138"></a>            SeveredLeftLeg.SetDrawScale(SeveredLegAttachScale);
<a name="1139"></a>            boneCoords = GetBoneCoords( <span class="source_name">'lleg'</span> );
<a name="1140"></a>            AttachEmitterEffect( LimbSpurtEmitterClass, <span class="source_name">'lleg'</span>, boneCoords.Origin, rot(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>) );
<a name="1141"></a>            AttachToBone(SeveredLeftLeg, <span class="source_name">'lleg'</span>);
<a name="1142"></a>        }
<a name="1143"></a>    }
<a name="1144"></a>    else if ( boneName == <span class="source_name">'rthigh'</span> )
<a name="1145"></a>    {
<a name="1146"></a>        boneScaleSlot = <span class="source_int">1</span>;
<a name="1147"></a>        if( SeveredRightLeg == none )
<a name="1148"></a>        {
<a name="1149"></a>            SeveredRightLeg = Spawn(SeveredLegAttachClass,self);
<a name="1150"></a>            SeveredRightLeg.SetDrawScale(SeveredLegAttachScale);
<a name="1151"></a>            boneCoords = GetBoneCoords( <span class="source_name">'rleg'</span> );
<a name="1152"></a>            AttachEmitterEffect( LimbSpurtEmitterClass, <span class="source_name">'rleg'</span>, boneCoords.Origin, rot(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>) );
<a name="1153"></a>            AttachToBone(SeveredRightLeg, <span class="source_name">'rleg'</span>);
<a name="1154"></a>        }
<a name="1155"></a>    }
<a name="1156"></a>    else if( boneName == <span class="source_name">'rfarm'</span> )
<a name="1157"></a>    {
<a name="1158"></a>        boneScaleSlot = <span class="source_int">2</span>;
<a name="1159"></a>        if( SeveredRightArm == none )
<a name="1160"></a>        {
<a name="1161"></a>            SeveredRightArm = Spawn(SeveredArmAttachClass,self);
<a name="1162"></a>            SeveredRightArm.SetDrawScale(SeveredArmAttachScale);
<a name="1163"></a>            boneCoords = GetBoneCoords( <span class="source_name">'rarm'</span> );
<a name="1164"></a>            AttachEmitterEffect( LimbSpurtEmitterClass, <span class="source_name">'rarm'</span>, boneCoords.Origin, rot(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>) );
<a name="1165"></a>            AttachToBone(SeveredRightArm, <span class="source_name">'rarm'</span>);
<a name="1166"></a>        }
<a name="1167"></a>    }
<a name="1168"></a>    else if ( boneName == <span class="source_name">'lfarm'</span> )
<a name="1169"></a>    {
<a name="1170"></a>        boneScaleSlot = <span class="source_int">3</span>;
<a name="1171"></a>        if( SeveredLeftArm == none )
<a name="1172"></a>        {
<a name="1173"></a>            SeveredLeftArm = Spawn(SeveredArmAttachClass,self);
<a name="1174"></a>            SeveredLeftArm.SetDrawScale(SeveredArmAttachScale);
<a name="1175"></a>            boneCoords = GetBoneCoords( <span class="source_name">'larm'</span> );
<a name="1176"></a>            AttachEmitterEffect( LimbSpurtEmitterClass, <span class="source_name">'larm'</span>, boneCoords.Origin, rot(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>) );
<a name="1177"></a>            AttachToBone(SeveredLeftArm, <span class="source_name">'larm'</span>);
<a name="1178"></a>        }
<a name="1179"></a>    }
<a name="1180"></a>    else if ( boneName == HeadBone )
<a name="1181"></a>    {
<a name="1182"></a>        boneScaleSlot = <span class="source_int">4</span>;
<a name="1183"></a>        if( <span class="source_type"><a href="../kfmod/severedhead.html" class="source">SeveredHead</a></span> == none )
<a name="1184"></a>        {
<a name="1185"></a>            <span class="source_type"><a href="../kfmod/severedhead.html" class="source">SeveredHead</a></span> = Spawn(SeveredHeadAttachClass,self);
<a name="1186"></a>            <span class="source_type"><a href="../kfmod/severedhead.html" class="source">SeveredHead</a></span>.SetDrawScale(SeveredHeadAttachScale);
<a name="1187"></a>            boneCoords = GetBoneCoords( <span class="source_name">'neck'</span> );
<a name="1188"></a>            AttachEmitterEffect( NeckSpurtEmitterClass, <span class="source_name">'neck'</span>, boneCoords.Origin, rot(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>) );
<a name="1189"></a>            AttachToBone(<span class="source_type"><a href="../kfmod/severedhead.html" class="source">SeveredHead</a></span>, <span class="source_name">'neck'</span>);
<a name="1190"></a>        }
<a name="1191"></a>    }
<a name="1192"></a>    else if ( boneName == <span class="source_name">'spine'</span> )
<a name="1193"></a>        boneScaleSlot = <span class="source_int">5</span>;
<a name="1194"></a>
<a name="1195"></a>    SetBoneScale(BoneScaleSlot, <span class="source_int">0.0</span>, BoneName);
<a name="1196"></a>}
<a name="1197"></a>
<a name="1198"></a>function PlayDyingSound()
<a name="1199"></a>{
<a name="1200"></a>    if( <span class="source_type">Level</span>.NetMode!=NM_Client )
<a name="1201"></a>    {
<a name="1202"></a>        if ( bGibbed )
<a name="1203"></a>        {
<a name="1204"></a>            PlaySound(GibGroupClass.static.GibSound(), SLOT_Pain,<span class="source_int">2.0</span>,true,<span class="source_int">525</span>);
<a name="1205"></a>            return;
<a name="1206"></a>        }
<a name="1207"></a>
<a name="1208"></a>        if ( HeadVolume.bWaterVolume )
<a name="1209"></a>        {
<a name="1210"></a>            PlaySound(GetSound(EST_Drown), SLOT_Pain,<span class="source_int">2.5</span>*TransientSoundVolume,true,<span class="source_int">500</span>);
<a name="1211"></a>            return;
<a name="1212"></a>        }
<a name="1213"></a>
<a name="1214"></a>        PlaySound(SoundGroupClass.static.GetDeathSound(), SLOT_Pain,<span class="source_int">2.5</span>*TransientSoundVolume, true,<span class="source_int">500</span>);
<a name="1215"></a>    }
<a name="1216"></a>}
<a name="1217"></a>
<a name="1218"></a><span class="source_comment">// Maybe spawn some chunks when the player gets obliterated
</span><a name="1219"></a>simulated function SpawnGibs(<span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span> HitRotation, <span class="source_type">float</span> <span class="source_type">ChunkPerterbation</span>)
<a name="1220"></a>{
<a name="1221"></a>    bGibbed = true;
<a name="1222"></a>    PlayDyingSound();
<a name="1223"></a>
<a name="1224"></a>    if ( <span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore() )
<a name="1225"></a>        return;
<a name="1226"></a>
<a name="1227"></a>    if ( ItBUURRNNNS != none )
<a name="1228"></a>    {
<a name="1229"></a>        ItBUURRNNNS.Emitters[<span class="source_int">0</span>].SkeletalMeshActor = none;
<a name="1230"></a>        ItBUURRNNNS.Destroy();
<a name="1231"></a>    }
<a name="1232"></a>
<a name="1233"></a>    if( ObliteratedEffectClass != none )
<a name="1234"></a>        Spawn( ObliteratedEffectClass,,, Location, HitRotation );
<a name="1235"></a>
<a name="1236"></a>    super.SpawnGibs(HitRotation,<span class="source_type">ChunkPerterbation</span>);
<a name="1237"></a>
<a name="1238"></a>    if ( FRand() &lt; <span class="source_int">0.1</span> )
<a name="1239"></a>    {
<a name="1240"></a>        SpawnSeveredGiblet( DetachedLegClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="1241"></a>        SpawnSeveredGiblet( DetachedLegClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="1242"></a>        SpawnSeveredGiblet( DetachedArmClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="1243"></a>        SpawnSeveredGiblet( DetachedArmClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="1244"></a>    }
<a name="1245"></a>    else if ( FRand() &lt; <span class="source_int">0.25</span> )
<a name="1246"></a>    {
<a name="1247"></a>        SpawnSeveredGiblet( DetachedLegClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="1248"></a>        SpawnSeveredGiblet( DetachedLegClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="1249"></a>        if ( FRand() &lt; <span class="source_int">0.5</span> )
<a name="1250"></a>        {
<a name="1251"></a>            SpawnSeveredGiblet( DetachedArmClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="1252"></a>        }
<a name="1253"></a>    }
<a name="1254"></a>    else if ( FRand() &lt; <span class="source_int">0.35</span> )
<a name="1255"></a>        SpawnSeveredGiblet( DetachedLegClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="1256"></a>    else if ( FRand() &lt; <span class="source_int">0.5</span> )
<a name="1257"></a>    {
<a name="1258"></a>        SpawnSeveredGiblet( DetachedArmClass, Location, HitRotation, <span class="source_type">ChunkPerterbation</span> );
<a name="1259"></a>    }
<a name="1260"></a>}
<a name="1261"></a>
<a name="1262"></a>simulated function StartDeRes()
<a name="1263"></a>{
<a name="1264"></a>    if( <span class="source_type">Level</span>.NetMode == NM_DedicatedServer )
<a name="1265"></a>        return;
<a name="1266"></a>
<a name="1267"></a>    AmbientGlow=<span class="source_int">0</span>;
<a name="1268"></a>    MaxLights=<span class="source_int">5</span>;
<a name="1269"></a>
<a name="1270"></a>    <span class="source_comment">// DeResFX = Spawn(class'DeResPart', self, , Location);
</span><a name="1271"></a>    <span class="source_comment">//Skins[0] = DeResMat0;
</span><a name="1272"></a>    <span class="source_comment">//Skins[1] = DeResMat1;
</span><a name="1273"></a>
<a name="1274"></a>    if( Physics == PHYS_KarmaRagdoll )
<a name="1275"></a>    {
<a name="1276"></a>        <span class="source_comment">// Remove flames
</span><a name="1277"></a>        RemoveFlamingEffects();
<a name="1278"></a>        <span class="source_comment">// Turn off any overlays
</span><a name="1279"></a>        SetOverlayMaterial(None, <span class="source_int">0.0f</span>, true);
<a name="1280"></a>    }
<a name="1281"></a>}
<a name="1282"></a>
<a name="1283"></a><span class="source_comment">// Remove Shield Sounds , Randomize for Human Pain sound.
</span><a name="1284"></a>
<a name="1285"></a>function <span class="source_type">int</span> ShieldAbsorb(<span class="source_type">int</span> <span class="source_type">dam</span>)
<a name="1286"></a>{
<a name="1287"></a>    local <span class="source_type">float</span> <span class="source_type">Interval</span>, <span class="source_type">damage</span>, Remaining;
<a name="1288"></a>    <span class="source_comment">//local int PainSound;
</span><a name="1289"></a>
<a name="1290"></a>    <span class="source_type">damage</span> = <span class="source_type">dam</span>;
<a name="1291"></a>
<a name="1292"></a>    if ( ShieldStrength == <span class="source_int">0</span> )
<a name="1293"></a>        return <span class="source_type">damage</span>;
<a name="1294"></a>
<a name="1295"></a>    if ( <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>) != none && <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill != none )
<a name="1296"></a>    {
<a name="1297"></a>        <span class="source_type">damage</span> *= <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill.static.GetBodyArmorDamageModifier(<span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>));
<a name="1298"></a>    }
<a name="1299"></a>
<a name="1300"></a>      <span class="source_comment">// Super.ShieldAbsorb(dam);
</span><a name="1301"></a>    <span class="source_comment">//SetOverlayMaterial( ShieldHitMat, ShieldHitMatTime, false );
</span><a name="1302"></a>
<a name="1303"></a>    <span class="source_comment">// Randomize Painsounds on Armor hit
</span><a name="1304"></a><span class="source_comment">//  PainSound = rand(6);
</span><a name="1305"></a><span class="source_comment">//  if (PainSound == 0)
</span><a name="1306"></a><span class="source_comment">//      PlaySound(sound'KFPlayerSound.hpain3', SLOT_Pain,2*TransientSoundVolume,,400);
</span><a name="1307"></a><span class="source_comment">//  else if (PainSound == 1)
</span><a name="1308"></a><span class="source_comment">//      PlaySound(sound'KFPlayerSound.hpain2', SLOT_Pain,2*TransientSoundVolume,,400);
</span><a name="1309"></a><span class="source_comment">//  else if (PainSound == 2)
</span><a name="1310"></a><span class="source_comment">//      PlaySound(sound'KFPlayerSound.hpain1', SLOT_Pain,2*TransientSoundVolume,,400);
</span><a name="1311"></a><span class="source_comment">//  else if (PainSound == 3)
</span><a name="1312"></a><span class="source_comment">//      PlaySound(sound'KFPlayerSound.hpain3', SLOT_Pain,2*TransientSoundVolume,,400);
</span><a name="1313"></a><span class="source_comment">//  else if (PainSound == 4)
</span><a name="1314"></a><span class="source_comment">//      PlaySound(sound'KFPlayerSound.hpain2', SLOT_Pain,2*TransientSoundVolume,,400);
</span><a name="1315"></a><span class="source_comment">//  else if (PainSound == 5)
</span><a name="1316"></a><span class="source_comment">//      PlaySound(sound'KFPlayerSound.hpain1', SLOT_Pain,2*TransientSoundVolume,,400);
</span><a name="1317"></a>
<a name="1318"></a>    if ( ShieldStrength &gt; SmallShieldStrength )
<a name="1319"></a>    {
<a name="1320"></a>        <span class="source_type">Interval</span> = ShieldStrength - SmallShieldStrength;
<a name="1321"></a>        if ( <span class="source_type">Interval</span> &gt;= <span class="source_int">0.75</span> * <span class="source_type">damage</span> )
<a name="1322"></a>        {
<a name="1323"></a>            ShieldStrength -= <span class="source_int">0.75</span> * <span class="source_type">damage</span>;
<a name="1324"></a>            if ( ShieldStrength &lt; SmallShieldStrength )
<a name="1325"></a>                SmallShieldStrength = ShieldStrength;
<a name="1326"></a>            return (<span class="source_int">0.25</span> * <span class="source_type">Damage</span>);
<a name="1327"></a>        }
<a name="1328"></a>        else
<a name="1329"></a>        {
<a name="1330"></a>            ShieldStrength = SmallShieldStrength;
<a name="1331"></a>            <span class="source_type">damage</span> -= <span class="source_type">Interval</span>;
<a name="1332"></a>            Remaining = <span class="source_int">0.33</span> * <span class="source_type">Interval</span>;
<a name="1333"></a>            if ( Remaining &lt;= <span class="source_type">damage</span> )
<a name="1334"></a>                return <span class="source_type">damage</span>;
<a name="1335"></a>            <span class="source_type">damage</span> -= Remaining;
<a name="1336"></a>        }
<a name="1337"></a>    }
<a name="1338"></a>
<a name="1339"></a>    if ( ShieldStrength &gt;= <span class="source_int">0.5</span> * <span class="source_type">damage</span> )
<a name="1340"></a>    {
<a name="1341"></a>        ShieldStrength -= <span class="source_type">damage</span> ;
<a name="1342"></a>        SmallShieldStrength = ShieldStrength;
<a name="1343"></a>        return Remaining + (<span class="source_int">0.25</span> * <span class="source_type">damage</span>);   <span class="source_comment">// 0.5
</span><a name="1344"></a>    }
<a name="1345"></a>    else
<a name="1346"></a>    {
<a name="1347"></a>        <span class="source_type">damage</span> -= ShieldStrength;
<a name="1348"></a>        ShieldStrength = <span class="source_int">0</span>;
<a name="1349"></a>        SmallShieldStrength = <span class="source_int">0</span>;
<a name="1350"></a>    }
<a name="1351"></a>
<a name="1352"></a>    return <span class="source_type">damage</span> + Remaining;
<a name="1353"></a>}
<a name="1354"></a>
<a name="1355"></a><span class="source_comment">// Play the pawn firing animations
</span><a name="1356"></a>simulated function StartFiringX(<span class="source_type">bool</span> bAltFire, <span class="source_type">bool</span> bRapid)
<a name="1357"></a>{
<a name="1358"></a>    local <span class="source_type">name</span> FireAnim;
<a name="1359"></a>    local <span class="source_type">int</span> AnimIndex;
<a name="1360"></a>
<a name="1361"></a>    if ( HasUDamage() && (<span class="source_type">Level</span>.TimeSeconds - LastUDamageSoundTime &gt; <span class="source_int">0.25</span>) )
<a name="1362"></a>    {
<a name="1363"></a>        LastUDamageSoundTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="1364"></a>        PlaySound(UDamageSound, SLOT_None, <span class="source_int">1.5</span>*TransientSoundVolume,,<span class="source_int">700</span>);
<a name="1365"></a>    }
<a name="1366"></a>
<a name="1367"></a>    if (Physics == PHYS_Swimming)
<a name="1368"></a>        return;
<a name="1369"></a>
<a name="1370"></a>    AnimIndex = Rand(<span class="source_int">4</span>);
<a name="1371"></a>
<a name="1372"></a>    if (bAltFire)
<a name="1373"></a>    {
<a name="1374"></a>        if( bIsCrouched )
<a name="1375"></a>        {
<a name="1376"></a>            FireAnim = FireCrouchAltAnims[AnimIndex];
<a name="1377"></a>        }
<a name="1378"></a>        else
<a name="1379"></a>        {
<a name="1380"></a>            FireAnim = FireAltAnims[AnimIndex];
<a name="1381"></a>        }
<a name="1382"></a>    }
<a name="1383"></a>    else
<a name="1384"></a>    {
<a name="1385"></a>        if( bIsCrouched )
<a name="1386"></a>        {
<a name="1387"></a>            FireAnim = FireCrouchAnims[AnimIndex];
<a name="1388"></a>        }
<a name="1389"></a>        else
<a name="1390"></a>        {
<a name="1391"></a>            FireAnim = FireAnims[AnimIndex];
<a name="1392"></a>        }
<a name="1393"></a>    }
<a name="1394"></a>
<a name="1395"></a>    AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="1396"></a>
<a name="1397"></a>    if (bRapid)
<a name="1398"></a>    {
<a name="1399"></a>        if (FireState != FS_Looping)
<a name="1400"></a>        {
<a name="1401"></a>            LoopAnim(FireAnim,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="1402"></a>            FireState = FS_Looping;
<a name="1403"></a>        }
<a name="1404"></a>    }
<a name="1405"></a>    else
<a name="1406"></a>    {
<a name="1407"></a>        PlayAnim(FireAnim,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="1408"></a>        FireState = FS_PlayOnce;
<a name="1409"></a>    }
<a name="1410"></a>
<a name="1411"></a>    IdleTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="1412"></a>}
<a name="1413"></a>
<a name="1414"></a>simulated function StopFiring()
<a name="1415"></a>{
<a name="1416"></a>    if (FireState == FS_Looping)
<a name="1417"></a>        FireState = FS_PlayOnce;
<a name="1418"></a>    IdleTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="1419"></a>}
<a name="1420"></a>
<a name="1421"></a>simulated function AnimEnd(<span class="source_type">int</span> <span class="source_type">Channel</span>)
<a name="1422"></a>{
<a name="1423"></a>    if (<span class="source_type">Channel</span> == <span class="source_int">1</span>)
<a name="1424"></a>    {
<a name="1425"></a>        if (FireState == FS_Ready)
<a name="1426"></a>        {
<a name="1427"></a>            AnimBlendToAlpha(<span class="source_int">1</span>, <span class="source_int">0.0</span>, <span class="source_int">0.12</span>);
<a name="1428"></a>            FireState = FS_None;
<a name="1429"></a>        }
<a name="1430"></a>        else if (FireState == FS_PlayOnce)
<a name="1431"></a>        {
<a name="1432"></a>            if( bIsCrouched )
<a name="1433"></a>            {
<a name="1434"></a>                PlayAnim(PostFireBlendCrouchAnim,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="1435"></a>            }
<a name="1436"></a>            else
<a name="1437"></a>            {
<a name="1438"></a>                PlayAnim(PostFireBlendStandAnim,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="1439"></a>            }
<a name="1440"></a>
<a name="1441"></a>            FireState = FS_Ready;
<a name="1442"></a>            IdleTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="1443"></a>        }
<a name="1444"></a>        else
<a name="1445"></a>            AnimBlendToAlpha(<span class="source_int">1</span>, <span class="source_int">0.0</span>, <span class="source_int">0.12</span>);
<a name="1446"></a>    }
<a name="1447"></a>    else if ( bKeepTaunting && (<span class="source_type">Channel</span> == <span class="source_int">0</span>) )
<a name="1448"></a>        PlayVictoryAnimation();
<a name="1449"></a>}
<a name="1450"></a>
<a name="1451"></a>
<a name="1452"></a>function RemoveInventorySP( <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/inventory.html" class="source">inventory</a></span>&gt; <span class="source_type">ItemClass</span> )
<a name="1453"></a>{
<a name="1454"></a>    <span class="source_comment">// If this item is in our inventory chain, unlink it.
</span><a name="1455"></a>    local <span class="source_type"><a href="../engine/actor.html" class="source">actor</a></span> Link;
<a name="1456"></a>    local <span class="source_type">int</span> Count;
<a name="1457"></a>    local <span class="source_type"><a href="../engine/inventory.html" class="source">inventory</a></span> <span class="source_type">Item</span> ;
<a name="1458"></a>
<a name="1459"></a>    <span class="source_type">Item</span> = spawn(<span class="source_type">ItemClass</span>) ;
<a name="1460"></a>
<a name="1461"></a>    if ( <span class="source_type">ItemClass</span> == <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.<span class="source_type">class</span> )
<a name="1462"></a>        <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> = None;
<a name="1463"></a>    if ( <span class="source_type">ItemClass</span> == SelectedItem.<span class="source_type">class</span> )
<a name="1464"></a>        SelectedItem = None;
<a name="1465"></a>    for( Link = Self; Link!=None; Link=Link.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="1466"></a>    {
<a name="1467"></a>        if( Link.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>.<span class="source_type">class</span> == <span class="source_type">ItemClass</span> )
<a name="1468"></a>        {
<a name="1469"></a>            Link.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> = <span class="source_type">Item</span>.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>;
<a name="1470"></a>            <span class="source_type">Item</span>.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> = None;
<a name="1471"></a>            Link.NetUpdateTime = <span class="source_type">Level</span>.TimeSeconds - <span class="source_int">1</span>;
<a name="1472"></a>            <span class="source_type">Item</span>.NetUpdateTime = <span class="source_type">Level</span>.TimeSeconds - <span class="source_int">1</span>;
<a name="1473"></a>            break;
<a name="1474"></a>        }
<a name="1475"></a>        if ( <span class="source_type">Level</span>.NetMode == NM_Client )
<a name="1476"></a>        {
<a name="1477"></a>        Count++;
<a name="1478"></a>        if ( Count &gt; <span class="source_int">1000</span> )
<a name="1479"></a>            break;
<a name="1480"></a>    }
<a name="1481"></a>    }
<a name="1482"></a>    <span class="source_type">Item</span>.SetOwner(None);
<a name="1483"></a>}
<a name="1484"></a>
<a name="1485"></a><span class="source_comment">// another one cut-n-pasted to remove must-have-ammo fetish
</span><a name="1486"></a>exec function SwitchToLastWeapon()
<a name="1487"></a>{
<a name="1488"></a>    if ( (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None) && (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.OldWeapon != None) ) <span class="source_comment">// && Weapon.OldWeapon.HasAmmo() )
</span><a name="1489"></a>    {
<a name="1490"></a>        PendingWeapon = <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.OldWeapon;
<a name="1491"></a>        <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.PutDown();
<a name="1492"></a>    }
<a name="1493"></a>}
<a name="1494"></a>
<a name="1495"></a><span class="source_comment">// TODO: GetWeapon
</span><a name="1496"></a>
<a name="1497"></a>simulated function AddHealth()
<a name="1498"></a>{
<a name="1499"></a>    local <span class="source_type">int</span> tempHeal ;
<a name="1500"></a>    if((<span class="source_type">level</span>.TimeSeconds - lastHealTime) &gt;= <span class="source_int">0.1</span>)
<a name="1501"></a>    {
<a name="1502"></a>        if(Health &lt; HealthMax)
<a name="1503"></a>        {
<a name="1504"></a>            tempHeal = <span class="source_type">int</span>(<span class="source_int">10</span> * (<span class="source_type">level</span>.TimeSeconds - lastHealTime)) ;
<a name="1505"></a>            if(tempHeal&gt;<span class="source_int">0</span>)
<a name="1506"></a>              lastHealTime = <span class="source_type">level</span>.TimeSeconds ;
<a name="1507"></a>
<a name="1508"></a>            Health = Min(Health+tempHeal, HealthMax);
<a name="1509"></a>            HealthToGive -= tempHeal ;
<a name="1510"></a>        }
<a name="1511"></a>        else
<a name="1512"></a>        {
<a name="1513"></a>            lastHealTime = <span class="source_type">level</span>.timeSeconds ;
<a name="1514"></a>            <span class="source_comment">// if we are all healed, there's gonna be no more healing
</span><a name="1515"></a>            HealthToGive = <span class="source_int">0</span> ;
<a name="1516"></a>        }
<a name="1517"></a>    }
<a name="1518"></a>}
<a name="1519"></a>
<a name="1520"></a>function <span class="source_type">bool</span> GiveHealth(<span class="source_type">int</span> HealAmount, <span class="source_type">int</span> HealMax)
<a name="1521"></a>{
<a name="1522"></a>    <span class="source_comment">// Taking this out for now because it nerfs the high level medic perks - Ramm
</span><a name="1523"></a><span class="source_comment">//  if(healAmount &gt;= 50)
</span><a name="1524"></a><span class="source_comment">//      healAmount = 50;
</span><a name="1525"></a>
<a name="1526"></a>    <span class="source_comment">// If someone gets healed while burning, reduce the burn length/damage
</span><a name="1527"></a>    if( BurnDown &gt; <span class="source_int">0</span> )
<a name="1528"></a>    {
<a name="1529"></a>        if( BurnDown &gt; <span class="source_int">1</span> )
<a name="1530"></a>        {
<a name="1531"></a>            BurnDown *= <span class="source_int">0.5</span>;
<a name="1532"></a>        }
<a name="1533"></a>
<a name="1534"></a>        LastBurnDamage *= <span class="source_int">0.5</span>;
<a name="1535"></a>    }
<a name="1536"></a>
<a name="1537"></a>    <span class="source_comment">// Don't let them heal more than the max health
</span><a name="1538"></a>    if( (healAmount + HealthToGive + Health) &gt; HealthMax)
<a name="1539"></a>    {
<a name="1540"></a>        healAmount = HealthMax - (Health + HealthToGive);
<a name="1541"></a>
<a name="1542"></a>        if( healAmount == <span class="source_int">0</span> )
<a name="1543"></a>        {
<a name="1544"></a>            return false;
<a name="1545"></a>        }
<a name="1546"></a>    }
<a name="1547"></a>
<a name="1548"></a>    if( Health&lt;HealMax )
<a name="1549"></a>    {
<a name="1550"></a>        HealthToGive+=HealAmount;
<a name="1551"></a>        lastHealTime = <span class="source_type">level</span>.timeSeconds;
<a name="1552"></a>        return true;
<a name="1553"></a>    }
<a name="1554"></a>    Return False;
<a name="1555"></a>}
<a name="1556"></a>
<a name="1557"></a>function ThrowGrenade()
<a name="1558"></a>{
<a name="1559"></a>    local <span class="source_type"><a href="../engine/inventory.html" class="source">inventory</a></span> inv;
<a name="1560"></a>    local <span class="source_type"><a href="../kfmod/frag.html" class="source">Frag</a></span> aFrag;
<a name="1561"></a>
<a name="1562"></a>    for ( inv = <span class="source_type"><a href="../engine/inventory.html" class="source">inventory</a></span>; inv != none; inv = inv.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="1563"></a>    {
<a name="1564"></a>        aFrag = <span class="source_type"><a href="../kfmod/frag.html" class="source">Frag</a></span>(inv);
<a name="1565"></a>
<a name="1566"></a>        if ( aFrag != none && aFrag.HasAmmo() && !bThrowingNade )
<a name="1567"></a>        {
<a name="1568"></a>            if ( <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) == none || <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.GetFireMode(<span class="source_int">0</span>).NextFireTime - <span class="source_type">Level</span>.TimeSeconds &gt; <span class="source_int">0.1</span> ||
<a name="1569"></a>                 (<span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).bIsReloading && !<span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).InterruptReload()) )
<a name="1570"></a>            {
<a name="1571"></a>                return;
<a name="1572"></a>            }
<a name="1573"></a>
<a name="1574"></a>            <span class="source_comment">//TODO: cache this without setting SecItem yet
</span><a name="1575"></a>            <span class="source_comment">//SecondaryItem = aFrag;
</span><a name="1576"></a>            <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).ClientGrenadeState = GN_TempDown;
<a name="1577"></a>            <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.PutDown();
<a name="1578"></a>            break;
<a name="1579"></a>            <span class="source_comment">//aFrag.StartThrow();
</span><a name="1580"></a>        }
<a name="1581"></a>    }
<a name="1582"></a>}
<a name="1583"></a>
<a name="1584"></a>function WeaponDown()
<a name="1585"></a>{
<a name="1586"></a>    local <span class="source_type"><a href="../engine/inventory.html" class="source">inventory</a></span> inv;
<a name="1587"></a>    local <span class="source_type"><a href="../kfmod/frag.html" class="source">Frag</a></span> aFrag;
<a name="1588"></a>
<a name="1589"></a>    for(inv=<span class="source_type"><a href="../engine/inventory.html" class="source">inventory</a></span>; inv!=none; inv=inv.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>)
<a name="1590"></a>    {
<a name="1591"></a>        aFrag=<span class="source_type"><a href="../kfmod/frag.html" class="source">Frag</a></span>(inv);
<a name="1592"></a>
<a name="1593"></a>        if(aFrag!=none && aFrag.HasAmmo() )
<a name="1594"></a>        {
<a name="1595"></a>            SecondaryItem = aFrag;
<a name="1596"></a>            aFrag.StartThrow();
<a name="1597"></a>        }
<a name="1598"></a>    }
<a name="1599"></a>}
<a name="1600"></a>
<a name="1601"></a>simulated function HandleNadeThrowAnim()
<a name="1602"></a>{
<a name="1603"></a>    if( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none )
<a name="1604"></a>    {
<a name="1605"></a>        if( <span class="source_type"><a href="../kfmod/ak47assaultrifle.html" class="source">AK47AssaultRifle</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1606"></a>        {
<a name="1607"></a>            SetAnimAction(<span class="source_name">'Frag_AK47'</span>);
<a name="1608"></a>        }
<a name="1609"></a>        else if( <span class="source_type"><a href="../kfmod/bullpup.html" class="source">Bullpup</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/seekersixrocketlauncher.html" class="source">SeekerSixRocketLauncher</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none)
<a name="1610"></a>        {
<a name="1611"></a>            SetAnimAction(<span class="source_name">'Frag_Bullpup'</span>);
<a name="1612"></a>        }
<a name="1613"></a>        else if( <span class="source_type"><a href="../kfmod/crossbow.html" class="source">Crossbow</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1614"></a>        {
<a name="1615"></a>            SetAnimAction(<span class="source_name">'Frag_Crossbow'</span>);
<a name="1616"></a>        }
<a name="1617"></a>        else if( <span class="source_type"><a href="../kfmod/deagle.html" class="source">Deagle</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/magnum44pistol.html" class="source">Magnum44Pistol</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/mk23pistol.html" class="source">MK23Pistol</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none)
<a name="1618"></a>        {
<a name="1619"></a>            SetAnimAction(<span class="source_name">'Frag_Single9mm'</span>);
<a name="1620"></a>        }
<a name="1621"></a>        else if( <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none && <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).bDualWeapon )
<a name="1622"></a>        {
<a name="1623"></a>            SetAnimAction(<span class="source_name">'Frag_Dual9mm'</span>);
<a name="1624"></a>        }
<a name="1625"></a>        else if( <span class="source_type"><a href="../kfmod/flamethrower.html" class="source">FlameThrower</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1626"></a>        {
<a name="1627"></a>            SetAnimAction(<span class="source_name">'Frag_Flamethrower'</span>);
<a name="1628"></a>        }
<a name="1629"></a>        else if( <span class="source_type"><a href="../kfmod/axe.html" class="source">Axe</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/dwarfaxe.html" class="source">DwarfAxe</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1630"></a>        {
<a name="1631"></a>            SetAnimAction(<span class="source_name">'Frag_Axe'</span>);
<a name="1632"></a>        }
<a name="1633"></a>        else if( <span class="source_type"><a href="../kfmod/chainsaw.html" class="source">Chainsaw</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1634"></a>        {
<a name="1635"></a>            SetAnimAction(<span class="source_name">'Frag_Chainsaw'</span>);
<a name="1636"></a>        }
<a name="1637"></a>        else if( <span class="source_type"><a href="../kfmod/katana.html" class="source">Katana</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/claymoresword.html" class="source">ClaymoreSword</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1638"></a>        {
<a name="1639"></a>            SetAnimAction(<span class="source_name">'Frag_Katana'</span>);
<a name="1640"></a>        }
<a name="1641"></a>        else if( <span class="source_type"><a href="../kfmod/knife.html" class="source">Knife</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1642"></a>        {
<a name="1643"></a>            SetAnimAction(<span class="source_name">'Frag_Knife'</span>);
<a name="1644"></a>        }
<a name="1645"></a>        else if( <span class="source_type"><a href="../kfmod/machete.html" class="source">Machete</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1646"></a>        {
<a name="1647"></a>            SetAnimAction(<span class="source_name">'Frag_Knife'</span>);
<a name="1648"></a>        }
<a name="1649"></a>        else if( <span class="source_type"><a href="../kfmod/syringe.html" class="source">Syringe</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1650"></a>        {
<a name="1651"></a>            SetAnimAction(<span class="source_name">'Frag_Syringe'</span>);
<a name="1652"></a>        }
<a name="1653"></a>        else if( <span class="source_type"><a href="../kfmod/welder.html" class="source">Welder</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1654"></a>        {
<a name="1655"></a>            SetAnimAction(<span class="source_name">'Frag_Syringe'</span>);
<a name="1656"></a>        }
<a name="1657"></a>        else if( <span class="source_type"><a href="../kfmod/boomstick.html" class="source">BoomStick</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1658"></a>        {
<a name="1659"></a>            SetAnimAction(<span class="source_name">'Frag_HuntingShotgun'</span>);
<a name="1660"></a>        }
<a name="1661"></a>        else if( <span class="source_type"><a href="../kfmod/law.html" class="source">LAW</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1662"></a>        {
<a name="1663"></a>            SetAnimAction(<span class="source_name">'Frag_LAW'</span>);
<a name="1664"></a>        }
<a name="1665"></a>        else if( <span class="source_type"><a href="../kfmod/shotgun.html" class="source">Shotgun</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/benellishotgun.html" class="source">BenelliShotgun</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/trenchgun.html" class="source">Trenchgun</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none)
<a name="1666"></a>        {
<a name="1667"></a>            SetAnimAction(<span class="source_name">'Frag_Shotgun'</span>);
<a name="1668"></a>        }
<a name="1669"></a>        else if( <span class="source_type"><a href="../kfmod/winchester.html" class="source">Winchester</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1670"></a>        {
<a name="1671"></a>            SetAnimAction(<span class="source_name">'Frag_Winchester'</span>);
<a name="1672"></a>        }
<a name="1673"></a>        else if( <span class="source_type"><a href="../kfmod/single.html" class="source">Single</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1674"></a>        {
<a name="1675"></a>            SetAnimAction(<span class="source_name">'Frag_Single9mm'</span>);
<a name="1676"></a>        }
<a name="1677"></a>        else if( <span class="source_type"><a href="../kfmod/m14ebrbattlerifle.html" class="source">M14EBRBattleRifle</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/spsniperrifle.html" class="source">SPSniperRifle</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1678"></a>        {
<a name="1679"></a>            SetAnimAction(<span class="source_name">'Frag_M14'</span>);
<a name="1680"></a>        }
<a name="1681"></a>        else if( <span class="source_type"><a href="../kfmod/scarmk17assaultrifle.html" class="source">SCARMK17AssaultRifle</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1682"></a>        {
<a name="1683"></a>            SetAnimAction(<span class="source_name">'Frag_SCAR'</span>);
<a name="1684"></a>        }
<a name="1685"></a>        else if( <span class="source_type"><a href="../kfmod/aa12autoshotgun.html" class="source">AA12AutoShotgun</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/fnfal_acog_assaultrifle.html" class="source">FNFAL_ACOG_AssaultRifle</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none
<a name="1686"></a>            || <span class="source_type"><a href="../kfmod/spautoshotgun.html" class="source">SPAutoShotgun</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1687"></a>        {
<a name="1688"></a>            SetAnimAction(<span class="source_name">'Frag_AA12'</span>);
<a name="1689"></a>        }
<a name="1690"></a>        else if( <span class="source_type"><a href="../kfmod/mp5mmedicgun.html" class="source">MP5MMedicGun</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/ksgshotgun.html" class="source">KSGShotgun</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1691"></a>        {
<a name="1692"></a>            SetAnimAction(<span class="source_name">'Frag_MP5'</span>);
<a name="1693"></a>        }
<a name="1694"></a>        else if( <span class="source_type"><a href="../kfmod/mp7mmedicgun.html" class="source">MP7MMedicGun</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1695"></a>        {
<a name="1696"></a>            SetAnimAction(<span class="source_name">'Frag_MP7'</span>);
<a name="1697"></a>        }
<a name="1698"></a>        else if( <span class="source_type"><a href="../kfmod/m7a3mmedicgun.html" class="source">M7A3MMedicGun</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/krissmmedicgun.html" class="source">KrissMMedicGun</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1699"></a>        {
<a name="1700"></a>            SetAnimAction(<span class="source_name">'Frag_Kriss'</span>);
<a name="1701"></a>        }
<a name="1702"></a>        else if( <span class="source_type"><a href="../kfmod/pipebombexplosive.html" class="source">PipeBombExplosive</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1703"></a>        {
<a name="1704"></a>            SetAnimAction(<span class="source_name">'Frag_PipeBomb'</span>);
<a name="1705"></a>        }
<a name="1706"></a>        else if( <span class="source_type"><a href="../kfmod/m79grenadelauncher.html" class="source">M79GrenadeLauncher</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/zedmkiiweapon.html" class="source">ZEDMKIIWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1707"></a>        {
<a name="1708"></a>            SetAnimAction(<span class="source_name">'Frag_M79'</span>);
<a name="1709"></a>        }
<a name="1710"></a>        else if( <span class="source_type"><a href="../kfmod/m32grenadelauncher.html" class="source">M32GrenadeLauncher</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1711"></a>        {
<a name="1712"></a>            SetAnimAction(<span class="source_name">'Frag_M32_MGL'</span>);
<a name="1713"></a>        }
<a name="1714"></a>        else if( <span class="source_type"><a href="../kfmod/sealsquealharpoonbomber.html" class="source">SealSquealHarpoonBomber</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1715"></a>        {
<a name="1716"></a>            SetAnimAction(<span class="source_name">'Frag_IJC_SealSqueal'</span>);
<a name="1717"></a>        }
<a name="1718"></a>        else if( <span class="source_type"><a href="../kfmod/m4203assaultrifle.html" class="source">M4203AssaultRifle</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/m99sniperrifle.html" class="source">M99SniperRifle</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1719"></a>        {
<a name="1720"></a>            SetAnimAction(<span class="source_name">'Frag_M4203'</span>);
<a name="1721"></a>        }
<a name="1722"></a>        else if( <span class="source_type"><a href="../kfmod/m4assaultrifle.html" class="source">M4AssaultRifle</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/mkb42assaultrifle.html" class="source">MKb42AssaultRifle</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none)
<a name="1723"></a>        {
<a name="1724"></a>            SetAnimAction(<span class="source_name">'Frag_M4'</span>);
<a name="1725"></a>        }
<a name="1726"></a>        else if( <span class="source_type"><a href="../kfmod/huskgun.html" class="source">HuskGun</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1727"></a>        {
<a name="1728"></a>            SetAnimAction(<span class="source_name">'Frag_HuskGun'</span>);
<a name="1729"></a>        }
<a name="1730"></a>        else if( <span class="source_type"><a href="../kfmod/zedgun.html" class="source">ZEDGun</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1731"></a>        {
<a name="1732"></a>            SetAnimAction(<span class="source_name">'Frag_Zed'</span>);
<a name="1733"></a>        }
<a name="1734"></a>        else if( <span class="source_type"><a href="../kfmod/nailgun.html" class="source">NailGun</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1735"></a>        {
<a name="1736"></a>            SetAnimAction(<span class="source_name">'Frag_Bullpup'</span>);
<a name="1737"></a>        }
<a name="1738"></a>        else if( <span class="source_type"><a href="../kfmod/spthompsonsmg.html" class="source">SPThompsonSMG</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none || <span class="source_type"><a href="../kfmod/thompsondrumsmg.html" class="source">ThompsonDrumSMG</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none)
<a name="1739"></a>        {
<a name="1740"></a>            SetAnimAction(<span class="source_name">'Frag_IJC_spThompson_Drum'</span>);
<a name="1741"></a>        }
<a name="1742"></a>        else if( <span class="source_type"><a href="../kfmod/thompsonsmg.html" class="source">ThompsonSMG</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1743"></a>        {
<a name="1744"></a>            SetAnimAction(<span class="source_name">'Frag_Thompson'</span>);
<a name="1745"></a>        }
<a name="1746"></a>        else if( <span class="source_type"><a href="../kfmod/scythe.html" class="source">Scythe</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1747"></a>        {
<a name="1748"></a>            SetAnimAction(<span class="source_name">'Frag_Scythe'</span>);
<a name="1749"></a>        }
<a name="1750"></a>        else if( <span class="source_type"><a href="../kfmod/crossbuzzsaw.html" class="source">Crossbuzzsaw</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1751"></a>        {
<a name="1752"></a>            SetAnimAction(<span class="source_name">'Frag_Cheetah'</span>);
<a name="1753"></a>        }
<a name="1754"></a>        else if( <span class="source_type"><a href="../kfmod/flarerevolver.html" class="source">FlareRevolver</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="1755"></a>        {
<a name="1756"></a>            SetAnimAction(<span class="source_name">'Frag_Single9mm'</span>);
<a name="1757"></a>        }
<a name="1758"></a>    }
<a name="1759"></a>    else
<a name="1760"></a>    {
<a name="1761"></a>        SetAnimAction(<span class="source_name">'Frag_Knife'</span>);
<a name="1762"></a>    }
<a name="1763"></a>}
<a name="1764"></a>
<a name="1765"></a>
<a name="1766"></a>simulated function ThrowGrenadeFinished()
<a name="1767"></a>{
<a name="1768"></a>  SecondaryItem = none;
<a name="1769"></a>  <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).ClientGrenadeState = GN_BringUp;
<a name="1770"></a>  <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.BringUp();
<a name="1771"></a>  bThrowingNade = false;
<a name="1772"></a>}
<a name="1773"></a>
<a name="1774"></a>simulated function SetNadeTimeOut(<span class="source_type">float</span> NewTimeOut)
<a name="1775"></a>{
<a name="1776"></a>    NadeThrowTimeout = NewTimeOut;
<a name="1777"></a>}
<a name="1778"></a>
<a name="1779"></a><span class="source_comment">/* Feet height adjusting functions ======================================================*/</span>
<a name="1780"></a>simulated function SetFootHeight( <span class="source_type">float</span> HeightMulti, <span class="source_type">byte</span> <span class="source_type">iNum</span> )
<a name="1781"></a>{
<a name="1782"></a><span class="source_comment">//  local rotator R;
</span><a name="1783"></a><span class="source_comment">//
</span><a name="1784"></a><span class="source_comment">//  OldAdjust[iNum] = (HeightMulti-OldAdjust[iNum])*0.5+OldAdjust[iNum];
</span><a name="1785"></a><span class="source_comment">//  if( Abs(OldAdjust[iNum]-HeightMulti)&lt;0.1 )
</span><a name="1786"></a><span class="source_comment">//      OldAdjust[iNum] = HeightMulti;
</span><a name="1787"></a><span class="source_comment">//  HeightMulti = OldAdjust[iNum];
</span><a name="1788"></a><span class="source_comment">//  HeightMulti = 1.f-HeightMulti; // Invert this value.
</span><a name="1789"></a><span class="source_comment">//  switch( FeetAdjSpec.Default.TorseRotType )
</span><a name="1790"></a><span class="source_comment">//  {
</span><a name="1791"></a><span class="source_comment">//  case BRot_Yaw:
</span><a name="1792"></a><span class="source_comment">//      R.Yaw = FeetAdjSpec.Default.MaxTorsoTurn*HeightMulti;
</span><a name="1793"></a><span class="source_comment">//      break;
</span><a name="1794"></a><span class="source_comment">//  case BRot_Roll:
</span><a name="1795"></a><span class="source_comment">//      R.Roll = FeetAdjSpec.Default.MaxTorsoTurn*HeightMulti;
</span><a name="1796"></a><span class="source_comment">//      break;
</span><a name="1797"></a><span class="source_comment">//  default:
</span><a name="1798"></a><span class="source_comment">//      R.Pitch = FeetAdjSpec.Default.MaxTorsoTurn*HeightMulti;
</span><a name="1799"></a><span class="source_comment">//  }
</span><a name="1800"></a><span class="source_comment">//  SetBoneRotation(FeetAdjSpec.Default.TorsoBones[iNum],R);
</span><a name="1801"></a><span class="source_comment">//  R = rot(0,0,0);
</span><a name="1802"></a><span class="source_comment">//  switch( FeetAdjSpec.Default.KneeRotType )
</span><a name="1803"></a><span class="source_comment">//  {
</span><a name="1804"></a><span class="source_comment">//  case BRot_Yaw:
</span><a name="1805"></a><span class="source_comment">//      R.Yaw = FeetAdjSpec.Default.MaxKneeTurn*HeightMulti;
</span><a name="1806"></a><span class="source_comment">//      break;
</span><a name="1807"></a><span class="source_comment">//  case BRot_Roll:
</span><a name="1808"></a><span class="source_comment">//      R.Roll = FeetAdjSpec.Default.MaxKneeTurn*HeightMulti;
</span><a name="1809"></a><span class="source_comment">//      break;
</span><a name="1810"></a><span class="source_comment">//  default:
</span><a name="1811"></a><span class="source_comment">//      R.Pitch = FeetAdjSpec.Default.MaxKneeTurn*HeightMulti;
</span><a name="1812"></a><span class="source_comment">//  }
</span><a name="1813"></a><span class="source_comment">//  SetBoneRotation(FeetAdjSpec.Default.KneeBones[iNum],R);
</span><a name="1814"></a>}
<a name="1815"></a>simulated function UpdateFeetCoords()
<a name="1816"></a>{
<a name="1817"></a><span class="source_comment">//  local Coords C;
</span><a name="1818"></a><span class="source_comment">//  local byte i;
</span><a name="1819"></a><span class="source_comment">//  local vector X,Y,Z,HL,Pos;
</span><a name="1820"></a><span class="source_comment">//
</span><a name="1821"></a><span class="source_comment">//  GetAxes(Rotation,X,Y,Z);
</span><a name="1822"></a><span class="source_comment">//  Pos = Location+PrePivot;
</span><a name="1823"></a><span class="source_comment">//  for( i=0; i&lt;2; i++ )
</span><a name="1824"></a><span class="source_comment">//  {
</span><a name="1825"></a><span class="source_comment">//      C = GetBoneCoords(FeetAdjSpec.Default.FeetBones[i]);
</span><a name="1826"></a><span class="source_comment">//      C.Origin = (C.Origin-Pos)&lt;&lt;Rotation;
</span><a name="1827"></a><span class="source_comment">//      C.Origin = X*C.Origin.X+Y*C.Origin.Y+Pos-Z*MinZHeight*DrawScale;
</span><a name="1828"></a><span class="source_comment">//      C.XAxis = C.Origin-Z*MaxZHeight*DrawScale;
</span><a name="1829"></a><span class="source_comment">//      if( Trace(HL,C.YAxis,C.XAxis,C.Origin,true)==None )
</span><a name="1830"></a><span class="source_comment">//          SetFootHeight(1,i);
</span><a name="1831"></a><span class="source_comment">//      else SetFootHeight(FClamp(VSize(HL-C.Origin)/DrawScale/MaxZHeight,0.f,1.f),i);
</span><a name="1832"></a><span class="source_comment">//  }
</span><a name="1833"></a>}
<a name="1834"></a><span class="source_comment">/* End of feet height adjusting functions ======================================================*/</span>
<a name="1835"></a>
<a name="1836"></a>simulated function Tick(<span class="source_type">float</span> <span class="source_type">DeltaTime</span>)
<a name="1837"></a>{
<a name="1838"></a><span class="source_comment">//  local float DMult;
</span><a name="1839"></a>
<a name="1840"></a>    if( Role &lt; ROLE_Authority && bThrowingNade )
<a name="1841"></a>    {
<a name="1842"></a>        if( NadeThrowTimeout &gt; <span class="source_int">0</span> )
<a name="1843"></a>    {
<a name="1844"></a>        NadeThrowTimeout -= <span class="source_type">DeltaTime</span>;
<a name="1845"></a>        }
<a name="1846"></a><span class="source_comment">// This is a hack to clear this flag on the client after a bit of time. This fixes a bug where you could get stuck unable to use weapons
</span><a name="1847"></a>        if( NadeThrowTimeout &lt;= <span class="source_int">0</span> )
<a name="1848"></a>        {
<a name="1849"></a>            NadeThrowTimeout = <span class="source_int">0</span>;
<a name="1850"></a>            ThrowGrenadeFinished();
<a name="1851"></a>        }
<a name="1852"></a>    }
<a name="1853"></a>
<a name="1854"></a>    <span class="source_comment">// IN other words - we're moving, we've got a piece, but we're not firing or reloading, or jumping / falling Faust:Perhaps we need that later: VSize(Acceleration) != 0 &&
</span><a name="1855"></a>    if (<span class="source_type">level</span>.NetMode != NM_DEDICATEDSERVER)
<a name="1856"></a>    {
<a name="1857"></a>        if(bBurnified && !bBurnApplied)
<a name="1858"></a>        {
<a name="1859"></a>            if ( !bGibbed )
<a name="1860"></a>            {
<a name="1861"></a>                StartBurnFX();
<a name="1862"></a>            }
<a name="1863"></a>        }
<a name="1864"></a>        else if(!bBurnified && bBurnApplied)
<a name="1865"></a>            StopBurnFX();
<a name="1866"></a>    }
<a name="1867"></a>
<a name="1868"></a>       <span class="source_comment">// CheckFlashLightAnims();
</span><a name="1869"></a>
<a name="1870"></a>    if( bResetingAnimAct && (AnimActResetTime&lt;<span class="source_type">Level</span>.TimeSeconds) ) <span class="source_comment">// Reset replication.
</span><a name="1871"></a>    {
<a name="1872"></a>        bResetingAnimAct = False;
<a name="1873"></a>        AnimAction = <span class="source_name">''</span>;
<a name="1874"></a>    }
<a name="1875"></a>    if(healthToGive &gt; <span class="source_int">0</span> && health &gt; <span class="source_int">0</span>)  <span class="source_comment">//
</span><a name="1876"></a>        AddHealth() ;
<a name="1877"></a>    else if(healthToGive &lt; <span class="source_int">0</span>)
<a name="1878"></a>        healthToGive = <span class="source_int">0</span> ;
<a name="1879"></a>
<a name="1880"></a>    if(BileCount&gt;<span class="source_int">0</span> && NextBileTime&lt;<span class="source_type">level</span>.TimeSeconds)
<a name="1881"></a>    {
<a name="1882"></a>        --BileCount;
<a name="1883"></a>        NextBileTime+=BileFrequency;
<a name="1884"></a>        TakeBileDamage();
<a name="1885"></a>    }
<a name="1886"></a><span class="source_comment">//  if( bHasFootAdjust && (Level.TimeSeconds-LastRenderTime)&lt;1 )
</span><a name="1887"></a><span class="source_comment">//  {
</span><a name="1888"></a><span class="source_comment">//      UpdateFeetCoords();
</span><a name="1889"></a><span class="source_comment">//      if( Level.NetMode!=NM_ListenServer )
</span><a name="1890"></a><span class="source_comment">//      {
</span><a name="1891"></a><span class="source_comment">//          if( Physics!=PHYS_Walking )
</span><a name="1892"></a><span class="source_comment">//              DMult = 1;
</span><a name="1893"></a><span class="source_comment">//          else DMult = OldAdjust[0]+OldAdjust[1];
</span><a name="1894"></a><span class="source_comment">//          if( DMult&lt;1.65 && PrePivot.Z&lt;0 )
</span><a name="1895"></a><span class="source_comment">//          {
</span><a name="1896"></a><span class="source_comment">//              PrePivot.Z+=DeltaTime*60f;
</span><a name="1897"></a><span class="source_comment">//              SetDrawScale(DrawScale);
</span><a name="1898"></a><span class="source_comment">//          }
</span><a name="1899"></a><span class="source_comment">//          else if( DMult&gt;1.85 && PrePivot.Z&gt;-35 )
</span><a name="1900"></a><span class="source_comment">//          {
</span><a name="1901"></a><span class="source_comment">//              PrePivot.Z-=DeltaTime*60f;
</span><a name="1902"></a><span class="source_comment">//              SetDrawScale(DrawScale);
</span><a name="1903"></a><span class="source_comment">//          }
</span><a name="1904"></a><span class="source_comment">//      }
</span><a name="1905"></a><span class="source_comment">//  }
</span><a name="1906"></a>
<a name="1907"></a><span class="source_comment">//  KFTODO: Maybe take this out because we're using notifies for footsteps in third person now
</span><a name="1908"></a><span class="source_comment">//  if( Level.Netmode != NM_DedicatedServer )
</span><a name="1909"></a><span class="source_comment">//  {
</span><a name="1910"></a><span class="source_comment">//      // do footsteps for nonlocal pawns and bots
</span><a name="1911"></a><span class="source_comment">//      if( !IsLocallyControlled() || (Level.Netmode == NM_Standalone && !IsHumanControlled()))
</span><a name="1912"></a><span class="source_comment">//      {
</span><a name="1913"></a><span class="source_comment">//          CheckFootSteps(DeltaTime);
</span><a name="1914"></a><span class="source_comment">//      }
</span><a name="1915"></a><span class="source_comment">//  }
</span><a name="1916"></a>
<a name="1917"></a>    if( Physics == PHYS_KarmaRagdoll && bDestroyAfterRagDollTick &&
<a name="1918"></a>        !bProcessedRagTickDestroy && GetRagDollFrames() &gt; <span class="source_int">0</span> )
<a name="1919"></a>    {
<a name="1920"></a>        bProcessedRagTickDestroy = true;
<a name="1921"></a>        Destroy();
<a name="1922"></a>    }
<a name="1923"></a>    <span class="source_comment">// If we've flagged this character to be destroyed next tick, handle that
</span><a name="1924"></a>    else if( bDestroyNextTick && TimeSetDestroyNextTickTime &lt; <span class="source_type">Level</span>.TimeSeconds )
<a name="1925"></a>    {
<a name="1926"></a>        Destroy();
<a name="1927"></a>    }
<a name="1928"></a>
<a name="1929"></a>
<a name="1930"></a>    Super.Tick(<span class="source_type">deltaTime</span>);
<a name="1931"></a>}
<a name="1932"></a>
<a name="1933"></a><span class="source_comment">// Blend the upper body back to full body animation.
</span><a name="1934"></a><span class="source_comment">// Called by the native code when AnimBlendTime counts down to zero
</span><a name="1935"></a>simulated event AnimBlendTimer()
<a name="1936"></a>{
<a name="1937"></a>    AnimBlendToAlpha(<span class="source_int">1</span>, <span class="source_int">0.0</span>, <span class="source_int">0.12</span>);
<a name="1938"></a>    <span class="source_comment">// Force a new idle anim to play, since we likely just switched weapons
</span><a name="1939"></a>    bIsIdle=false;
<a name="1940"></a>    IdleTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="1941"></a>}
<a name="1942"></a>
<a name="1943"></a>simulated event SetAnimAction(<span class="source_type">name</span> NewAction)
<a name="1944"></a>{
<a name="1945"></a>    local <span class="source_type">float</span> UsedBlendOutTime;
<a name="1946"></a>
<a name="1947"></a>    if( NewAction==<span class="source_name">''</span> )
<a name="1948"></a>        Return;
<a name="1949"></a>    if (!bWaitForAnim)
<a name="1950"></a>    {
<a name="1951"></a>        AnimAction = NewAction;
<a name="1952"></a>
<a name="1953"></a>        if ( AnimAction == <span class="source_name">'Weapon_Switch'</span> )
<a name="1954"></a>        {
<a name="1955"></a>            AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="1956"></a>            PlayAnim(NewAction,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="1957"></a>            <span class="source_comment">// Set the timer to blend out the upper body animation
</span><a name="1958"></a>            if( HasAnim( AnimAction ) )
<a name="1959"></a>            {
<a name="1960"></a>                UsedBlendOutTime = GetAnimDuration(NewAction, <span class="source_int">1.0</span>);
<a name="1961"></a>            }
<a name="1962"></a>            else
<a name="1963"></a>            {
<a name="1964"></a>                UsedBlendOutTime = <span class="source_int">0.2</span>;
<a name="1965"></a>            }
<a name="1966"></a>            AnimBlendTime = UsedBlendOutTime + <span class="source_int">0.1</span>;
<a name="1967"></a>        }
<a name="1968"></a>        else if ( AnimAction == IdleWeaponAnim )
<a name="1969"></a>        {
<a name="1970"></a>            PlayAnim(AnimAction,,<span class="source_int">0.1</span>);
<a name="1971"></a>            AnimBlendToAlpha(<span class="source_int">1</span>,<span class="source_int">0.0</span>,<span class="source_int">0.05</span>);
<a name="1972"></a>        }
<a name="1973"></a>        else if ( AnimAction == <span class="source_name">'Reload'</span> )
<a name="1974"></a>        {
<a name="1975"></a>            AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="1976"></a>            PlayAnim(NewAction,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="1977"></a>        }
<a name="1978"></a>        else if ( AnimAction == <span class="source_name">'AxeAttack'</span> )
<a name="1979"></a>        {
<a name="1980"></a>            AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="1981"></a>            PlayAnim(NewAction,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="1982"></a>        }
<a name="1983"></a>        else if ( AnimAction == <span class="source_name">'ChainSawAttack'</span> )
<a name="1984"></a>        {
<a name="1985"></a>            AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="1986"></a>            PlayAnim(NewAction,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="1987"></a>        }
<a name="1988"></a>        else if ( AnimAction == <span class="source_name">'DeagleHold'</span> )
<a name="1989"></a>        {
<a name="1990"></a>            AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="1991"></a>            LoopAnim(NewAction,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="1992"></a>        }
<a name="1993"></a>        else if ( AnimAction == <span class="source_name">'DualiesHold'</span> )
<a name="1994"></a>        {
<a name="1995"></a>            AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="1996"></a>            LoopAnim(NewAction,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="1997"></a>        }
<a name="1998"></a>        else if ( AnimAction == <span class="source_name">'Frag_AK47'</span> || AnimAction == <span class="source_name">'Frag_Bullpup'</span>
<a name="1999"></a>            || AnimAction == <span class="source_name">'Frag_Crossbow'</span> || AnimAction == <span class="source_name">'Frag_Single9mm'</span>
<a name="2000"></a>            || AnimAction == <span class="source_name">'Frag_Dual9mm'</span> || AnimAction == <span class="source_name">'Frag_Flamethrower'</span>
<a name="2001"></a>            || AnimAction == <span class="source_name">'Frag_Axe'</span> || AnimAction == <span class="source_name">'Frag_Chainsaw'</span>
<a name="2002"></a>            || AnimAction == <span class="source_name">'Frag_Katana'</span> || AnimAction == <span class="source_name">'Frag_Knife'</span>
<a name="2003"></a>            || AnimAction == <span class="source_name">'Frag_Syringe'</span> || AnimAction == <span class="source_name">'Frag_HuntingShotgun'</span>
<a name="2004"></a>            || AnimAction == <span class="source_name">'Frag_LAW'</span> || AnimAction == <span class="source_name">'Frag_Shotgun'</span>
<a name="2005"></a>            || AnimAction == <span class="source_name">'Frag_M14'</span> || AnimAction == <span class="source_name">'Frag_SCAR'</span>
<a name="2006"></a>            || AnimAction == <span class="source_name">'Frag_AA12'</span> || AnimAction == <span class="source_name">'Frag_MP7'</span>
<a name="2007"></a>            || AnimAction == <span class="source_name">'Frag_PipeBomb'</span> || AnimAction == <span class="source_name">'Frag_M79'</span>
<a name="2008"></a>            || AnimAction == <span class="source_name">'Frag_M32_MGL'</span> || AnimAction == <span class="source_name">'Frag_M4'</span>
<a name="2009"></a>            || AnimAction == <span class="source_name">'Frag_M4203'</span> || AnimAction == <span class="source_name">'Frag_MP5'</span>
<a name="2010"></a>            || AnimAction == <span class="source_name">'Frag_HuskGun'</span> || AnimAction == <span class="source_name">'Frag_Kriss'</span>
<a name="2011"></a>            || AnimAction == <span class="source_name">'Frag_Thompson'</span> || AnimAction == <span class="source_name">'Frag_scythe'</span>
<a name="2012"></a>            || AnimAction == <span class="source_name">'Frag_Cheetah'</span> || AnimAction == <span class="source_name">'Frag_Zed'</span>
<a name="2013"></a>            || AnimAction == <span class="source_name">'Frag_IJC_spThompson_Drum'</span> || AnimAction == <span class="source_name">'Frag_IJC_SealSqueal'</span>)
<a name="2014"></a>        {
<a name="2015"></a>            AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="2016"></a>            PlayAnim(NewAction,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="2017"></a>            bThrowingNade = true;
<a name="2018"></a>        }
<a name="2019"></a>        else if ( AnimAction == <span class="source_name">'ShotgunFire'</span> )
<a name="2020"></a>        {
<a name="2021"></a>            AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="2022"></a>            PlayAnim(NewAction,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="2023"></a>        }
<a name="2024"></a>        else if ( AnimAction == <span class="source_name">'DeagleBlast'</span> )
<a name="2025"></a>        {
<a name="2026"></a>            AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="2027"></a>            PlayAnim(NewAction,, <span class="source_int">0.0</span>, <span class="source_int">1</span>);
<a name="2028"></a>        } <span class="source_comment">// Reloads
</span><a name="2029"></a>        else if ( AnimAction == <span class="source_name">'Reload1'</span> || AnimAction == <span class="source_name">'Reload_BullPup'</span>
<a name="2030"></a>            || AnimAction == <span class="source_name">'Reload_Single9mm'</span> || AnimAction == <span class="source_name">'Reload_Winchester'</span>
<a name="2031"></a>            || AnimAction == <span class="source_name">'Reload_Crossbow'</span> || AnimAction == <span class="source_name">'Reload_Dual9mm'</span>
<a name="2032"></a>            || AnimAction == <span class="source_name">'Reload_Flamethrower'</span> || AnimAction == <span class="source_name">'Reload_HuntingShotgun'</span>
<a name="2033"></a>            || AnimAction == <span class="source_name">'Reload_LAW'</span> || AnimAction == <span class="source_name">'Reload_Shotgun'</span>
<a name="2034"></a>            || AnimAction == <span class="source_name">'Reload_Winchester'</span> || AnimAction == <span class="source_name">'Reload_AK47'</span>
<a name="2035"></a>            || AnimAction == <span class="source_name">'Reload_M14'</span> || AnimAction == <span class="source_name">'Reload_SCAR'</span>
<a name="2036"></a>            || AnimAction == <span class="source_name">'Reload_MP7'</span> || AnimAction == <span class="source_name">'Reload_AA12'</span>
<a name="2037"></a>            || AnimAction == <span class="source_name">'Reload_Secondary_M4203'</span> || AnimAction == <span class="source_name">'Reload_Fal_Acog'</span>
<a name="2038"></a>            || AnimAction == <span class="source_name">'Reload_Fal_Acog'</span> || AnimAction == <span class="source_name">'Reload_M7A3'</span>
<a name="2039"></a>            || AnimAction == <span class="source_name">'Reload_KSG'</span> || AnimAction == <span class="source_name">'Reload_Flare'</span>
<a name="2040"></a>            || AnimAction == <span class="source_name">'Reload_DualFlare'</span> || AnimAction == <span class="source_name">'Reload_Cheetah'</span>
<a name="2041"></a>            || AnimAction == <span class="source_name">'Reload_Thompson'</span> || AnimAction == <span class="source_name">'Reload_Kriss'</span>
<a name="2042"></a>            || AnimAction == <span class="source_name">'Reload_Zed'</span> || AnimAction == <span class="source_name">'Reload_IJC_spJackHammer'</span>
<a name="2043"></a>            || AnimAction == <span class="source_name">'Reload_spSinper'</span> || AnimAction == <span class="source_name">'Reload_IJC_spThompson_Drum'</span>
<a name="2044"></a>            || AnimAction == <span class="source_name">'Reload_IJC_SealSqueal'</span> || AnimAction == <span class="source_name">'Reload_M32_MGL'</span>
<a name="2045"></a>            || AnimAction == <span class="source_name">'Reload_IJC_SeekerSix'</span> || AnimAction == <span class="source_name">'Reload_IJC_ZEDV2'</span> )
<a name="2046"></a>        {
<a name="2047"></a>            AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="2048"></a>            PlayAnim(NewAction,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="2049"></a>            FireState = FS_Ready;
<a name="2050"></a>        }
<a name="2051"></a>        else if ( ((Physics == PHYS_None)|| ((<span class="source_type">Level</span>.Game != None) && <span class="source_type">Level</span>.Game.IsInState(<span class="source_name">'MatchOver'</span>))) && (DrivenVehicle == None) )
<a name="2052"></a>        {
<a name="2053"></a>            PlayAnim(AnimAction,,<span class="source_int">0.1</span>);
<a name="2054"></a>            AnimBlendToAlpha(<span class="source_int">1</span>,<span class="source_int">0.0</span>,<span class="source_int">0.05</span>);
<a name="2055"></a>        }
<a name="2056"></a>        else if ( (DrivenVehicle != None) || (Physics == PHYS_Falling) || ((Physics == PHYS_Walking) && (Velocity.<span class="source_type">Z</span> != <span class="source_int">0</span>)) )
<a name="2057"></a>        {
<a name="2058"></a>            if ( CheckTauntValid(AnimAction) )
<a name="2059"></a>            {
<a name="2060"></a>                if (FireState == FS_None || FireState == FS_Ready)
<a name="2061"></a>                {
<a name="2062"></a>                    AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="2063"></a>                    PlayAnim(NewAction,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="2064"></a>                    FireState = FS_Ready;
<a name="2065"></a>                }
<a name="2066"></a>            }
<a name="2067"></a>            else if ( HasAnim(AnimAction) && PlayAnim(AnimAction) )
<a name="2068"></a>            {
<a name="2069"></a>                if ( Physics != PHYS_None )
<a name="2070"></a>                    bWaitForAnim = true;
<a name="2071"></a>            }
<a name="2072"></a>            else AnimAction = NewAction;
<a name="2073"></a>        }
<a name="2074"></a>        else if (bIsIdle && !bIsCrouched && (<span class="source_type"><a href="../unrealgame/bot.html" class="source">Bot</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) == None) ) <span class="source_comment">// standing taunt
</span><a name="2075"></a>        {
<a name="2076"></a>            AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="2077"></a>            PlayAnim(AnimAction,,<span class="source_int">0.1</span>,<span class="source_int">1</span>);
<a name="2078"></a>        }
<a name="2079"></a>        else if (FireState == FS_None || FireState == FS_Ready)
<a name="2080"></a>        {
<a name="2081"></a>            AnimBlendParams(<span class="source_int">1</span>, <span class="source_int">1.0</span>, <span class="source_int">0.0</span>, <span class="source_int">0.2</span>, FireRootBone);
<a name="2082"></a>            PlayAnim(NewAction,, <span class="source_int">0.1</span>, <span class="source_int">1</span>);
<a name="2083"></a>            FireState = FS_Ready;
<a name="2084"></a>        }
<a name="2085"></a>    }
<a name="2086"></a>    if( <span class="source_type">Level</span>.NetMode!=NM_Client )
<a name="2087"></a>    {
<a name="2088"></a>        <span class="source_comment">// Reset to fix replication.
</span><a name="2089"></a>        bResetingAnimAct = True;
<a name="2090"></a>        AnimActResetTime = <span class="source_type">Level</span>.TimeSeconds+<span class="source_int">0.45</span>;
<a name="2091"></a>    }
<a name="2092"></a>}
<a name="2093"></a>
<a name="2094"></a>simulated function StartBurnFX()
<a name="2095"></a>{
<a name="2096"></a>    if( bDeleteMe )
<a name="2097"></a>    {
<a name="2098"></a>        return;
<a name="2099"></a>    }
<a name="2100"></a>
<a name="2101"></a>    if( ItBUURRNNNS==None )
<a name="2102"></a>    {
<a name="2103"></a>        ItBUURRNNNS = Spawn(BurnEffect);
<a name="2104"></a>        ItBUURRNNNS.SetBase(Self);
<a name="2105"></a>        ItBUURRNNNS.Emitters[<span class="source_int">0</span>].SkeletalMeshActor = self;
<a name="2106"></a>        ItBUURRNNNS.Emitters[<span class="source_int">0</span>].UseSkeletalLocationAs = PTSU_SpawnOffset;
<a name="2107"></a>    }
<a name="2108"></a>    bBurnApplied = True;
<a name="2109"></a>}
<a name="2110"></a>
<a name="2111"></a>simulated function StopBurnFX()
<a name="2112"></a>{
<a name="2113"></a>    RemoveFlamingEffects();
<a name="2114"></a>    if( ItBUURRNNNS!=None )
<a name="2115"></a>        ItBUURRNNNS.Kill();
<a name="2116"></a>    bBurnApplied = False;
<a name="2117"></a>}
<a name="2118"></a>
<a name="2119"></a><span class="source_comment">// Process a precision hit
</span><a name="2120"></a>function ProcessLocationalDamage(<span class="source_type">int</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> instigatedBy, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">hitlocation</span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">momentum</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, array&lt;<span class="source_type">int</span>&gt; <span class="source_type">PointsHit</span> )
<a name="2121"></a>{
<a name="2122"></a>    local <span class="source_type">int</span> actualDamage, originalDamage, cumulativeDamage, totalDamage, <span class="source_type">i</span>;
<a name="2123"></a>    local <span class="source_type">int</span> HighestDamagePoint, HighestDamageAmount;
<a name="2124"></a>    local <span class="source_type">bool</span> bHeadShot;
<a name="2125"></a>    <span class="source_comment">// Hit detection debugging
</span><a name="2126"></a><span class="source_comment">//    local coords CO;
</span><a name="2127"></a><span class="source_comment">//  local vector HeadLoc;
</span><a name="2128"></a><span class="source_comment">//  local bool bFirstHit;
</span><a name="2129"></a>
<a name="2130"></a>    originalDamage = <span class="source_type">damage</span>;
<a name="2131"></a>
<a name="2132"></a>    <span class="source_comment">// If someone else has killed this player , return
</span><a name="2133"></a>    if( bDeleteMe || <span class="source_type">PointsHit</span>.Length &lt; <span class="source_int">1</span> || Health &lt;= <span class="source_int">0</span> )
<a name="2134"></a>        return;
<a name="2135"></a>
<a name="2136"></a>    <span class="source_comment">// Don't process locational damage if we're not going to damage a friendly anyway
</span><a name="2137"></a>    if( <span class="source_type"><a href="../unrealgame/teamgame.html" class="source">TeamGame</a></span>(<span class="source_type">Level</span>.Game)!=None && <span class="source_type"><a href="../unrealgame/teamgame.html" class="source">TeamGame</a></span>(<span class="source_type">Level</span>.Game).FriendlyFireScale==<span class="source_int">0</span> && instigatedBy!=None && instigatedBy!=Self
<a name="2138"></a>     && instigatedBy.GetTeamNum()==GetTeamNum() )
<a name="2139"></a>    {
<a name="2140"></a>        Return;
<a name="2141"></a>    }
<a name="2142"></a>
<a name="2143"></a>    for(<span class="source_type">i</span>=<span class="source_int">0</span>; <span class="source_type">i</span>&lt;<span class="source_type">PointsHit</span>.Length; <span class="source_type">i</span>++)
<a name="2144"></a>    {
<a name="2145"></a>        <span class="source_comment">// If someone else has killed this player , return
</span><a name="2146"></a>        if( bDeleteMe || Health &lt;= <span class="source_int">0</span> )
<a name="2147"></a>            return;
<a name="2148"></a>
<a name="2149"></a>        actualDamage = originalDamage;
<a name="2150"></a>
<a name="2151"></a>        actualDamage *= Hitpoints[<span class="source_type">PointsHit</span>[<span class="source_type">i</span>]].DamageMultiplier;
<a name="2152"></a>        totalDamage += actualDamage;
<a name="2153"></a>        actualDamage = <span class="source_type">Level</span>.Game.ReduceDamage(actualDamage, self, instigatedBy, <span class="source_type">HitLocation</span>, <span class="source_type">Momentum</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>);
<a name="2154"></a>        cumulativeDamage += actualDamage;
<a name="2155"></a>
<a name="2156"></a>        if( actualDamage &gt; HighestDamageAmount )
<a name="2157"></a>        {
<a name="2158"></a>            HighestDamageAmount = actualDamage;
<a name="2159"></a>            HighestDamagePoint = <span class="source_type">PointsHit</span>[<span class="source_type">i</span>];
<a name="2160"></a>        }
<a name="2161"></a>
<a name="2162"></a>        <span class="source_comment">// Store if one of the shots was a headshot
</span><a name="2163"></a>        if( Hitpoints[<span class="source_type">PointsHit</span>[<span class="source_type">i</span>]].HitPointType == PHP_Head && <span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/kfweapondamagetype.html" class="source">KFWeaponDamageType</a></span>&gt;(<span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>)!=none &&
<a name="2164"></a>            <span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/kfweapondamagetype.html" class="source">KFWeaponDamageType</a></span>&gt;(<span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>).default.bCheckForHeadShots)
<a name="2165"></a>        {
<a name="2166"></a>            bHeadShot = true;
<a name="2167"></a>        }
<a name="2168"></a>
<a name="2169"></a>        <span class="source_comment">//log("We hit "$GetEnum(enum'EPawnHitPointType',Hitpoints[PointsHit[i]].HitPointType));
</span><a name="2170"></a>
<a name="2171"></a>        <span class="source_comment">// Hit detection debugging
</span><a name="2172"></a>        <span class="source_comment">/*if( PointsHit[i] != 0 && !bFirstHit )
<a name="2173"></a>        {
<a name="2174"></a>            CO = GetBoneCoords(Hitpoints[PointsHit[i]].PointBone);
<a name="2175"></a>            HeadLoc = CO.Origin;
<a name="2176"></a>            HeadLoc = HeadLoc + (Hitpoints[PointsHit[i]].PointOffset &gt;&gt; GetBoneRotation(Hitpoints[PointsHit[i]].PointBone));
<a name="2177"></a>
<a name="2178"></a>            DrawLocation = HeadLoc;
<a name="2179"></a>            DrawRotation = GetBoneRotation(Hitpoints[PointsHit[i]].PointBone);
<a name="2180"></a>            DrawIndex = PointsHit[i];
<a name="2181"></a>            HitPointDebugByte++;
<a name="2182"></a>            bFirstHit = true;
<a name="2183"></a>        }*/</span>
<a name="2184"></a>
<a name="2185"></a>        <span class="source_comment">// Lets exit out if one of the shots killed the player
</span><a name="2186"></a>        if ( cumulativeDamage &gt;=  Health )
<a name="2187"></a>        {
<a name="2188"></a>            <span class="source_comment">// Play a sound when someone gets a headshot - KFTODO: Replace this with a better bullet hitting a helmet sound
</span><a name="2189"></a>            if( bHeadShot )
<a name="2190"></a>            {
<a name="2191"></a>                PlaySound(<span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span><span class="source_name">'ProjectileSounds.impact_metal09'</span>, SLOT_None,<span class="source_int">2.0</span>,true,<span class="source_int">500</span>);
<a name="2192"></a>            }
<a name="2193"></a>            TakeDamage(totalDamage, instigatedBy, <span class="source_type">hitlocation</span>, <span class="source_type">momentum</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, HighestDamagePoint);
<a name="2194"></a>        }
<a name="2195"></a>    }
<a name="2196"></a>
<a name="2197"></a>    if( totalDamage &gt; <span class="source_int">0</span> )
<a name="2198"></a>    {
<a name="2199"></a>        <span class="source_comment">// If someone else has killed this player , return
</span><a name="2200"></a>        if( bDeleteMe || Health &lt;= <span class="source_int">0</span> )
<a name="2201"></a>            return;
<a name="2202"></a>
<a name="2203"></a>        <span class="source_comment">// Play a sound when someone gets a headshot
</span><a name="2204"></a>        if( bHeadShot )
<a name="2205"></a>        {
<a name="2206"></a>            <span class="source_comment">// Play a sound when someone gets a headshot - KFTODO: Replace this with a better bullet hitting a helmet sound
</span><a name="2207"></a>            PlaySound(<span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span><span class="source_name">'ProjectileSounds.impact_metal09'</span>, SLOT_None,<span class="source_int">2.0</span>,true,<span class="source_int">500</span>);
<a name="2208"></a>        }
<a name="2209"></a>
<a name="2210"></a>        TakeDamage(totalDamage, instigatedBy, <span class="source_type">hitlocation</span>, <span class="source_type">momentum</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, HighestDamagePoint);
<a name="2211"></a>    }
<a name="2212"></a>}
<a name="2213"></a>
<a name="2214"></a><span class="source_comment">// Hit detection debugging - Only use when debugging
</span><a name="2215"></a><span class="source_comment">/*
<a name="2216"></a>simulated function DrawBoneLocation()
<a name="2217"></a>{
<a name="2218"></a>    local vector X, Y, Z;
<a name="2219"></a>
<a name="2220"></a>    GetAxes(DrawRotation, X,Y,Z);
<a name="2221"></a>    ClearStayingDebugLines();
<a name="2222"></a>
<a name="2223"></a>    DrawStayingDebugLine(HitStart, HitEnd, 0,255,0);
<a name="2224"></a>    Spawn(class 'ROEngine.RODebugTracer',self,,HitStart,Rotator(Normal(HitEnd-HitStart)));
<a name="2225"></a>
<a name="2226"></a>    DrawDebugCylinder(DrawLocation,Z,Y,X,Hitpoints[DrawIndex].PointRadius * Hitpoints[DrawIndex].PointScale,Hitpoints[DrawIndex].PointHeight * Hitpoints[DrawIndex].PointScale,10,0, 255, 0);
<a name="2227"></a>}
<a name="2228"></a>
<a name="2229"></a>simulated function DrawDebugCylinder(vector Base,vector X, vector Y,vector Z, FLOAT Radius,float HalfHeight,int NumSides, byte R, byte G, byte B)
<a name="2230"></a>{
<a name="2231"></a>    local float AngleDelta;
<a name="2232"></a>    local vector LastVertex, Vertex;
<a name="2233"></a>    local int SideIndex;
<a name="2234"></a>
<a name="2235"></a>    AngleDelta = 2.0f * PI / NumSides;
<a name="2236"></a>    LastVertex = Base + X * Radius;
<a name="2237"></a>
<a name="2238"></a>    for(SideIndex = 0;SideIndex &lt; NumSides;SideIndex++)
<a name="2239"></a>    {
<a name="2240"></a>        Vertex = Base + (X * Cos(AngleDelta * (SideIndex + 1)) + Y * Sin(AngleDelta * (SideIndex + 1))) * Radius;
<a name="2241"></a>
<a name="2242"></a>        DrawStayingDebugLine( LastVertex - Z * HalfHeight,Vertex - Z * HalfHeight,R,G,B);
<a name="2243"></a>        DrawStayingDebugLine( LastVertex + Z * HalfHeight,Vertex + Z * HalfHeight,R,G,B);
<a name="2244"></a>        DrawStayingDebugLine( LastVertex - Z * HalfHeight,LastVertex + Z * HalfHeight,R,G,B);
<a name="2245"></a>
<a name="2246"></a>        LastVertex = Vertex;
<a name="2247"></a>    }
<a name="2248"></a>}*/</span>
<a name="2249"></a>
<a name="2250"></a>function TakeDamage(<span class="source_type">int</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> instigatedBy, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">hitlocation</span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">momentum</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, optional <span class="source_type">int</span> <span class="source_type">HitIdx</span> )
<a name="2251"></a>{
<a name="2252"></a>    local <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span> KFPRI;
<a name="2253"></a>
<a name="2254"></a>    LastHitDamType = <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>;
<a name="2255"></a>    LastDamagedBy = instigatedBy;
<a name="2256"></a>
<a name="2257"></a>    super.TakeDamage(<span class="source_type">Damage</span>, instigatedBy, <span class="source_type">hitLocation</span>, <span class="source_type">momentum</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>);
<a name="2258"></a>
<a name="2259"></a>    healthtoGive-=<span class="source_int">5</span>;
<a name="2260"></a>
<a name="2261"></a>    KFPRI = <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>);
<a name="2262"></a>
<a name="2263"></a>    <span class="source_comment">// Just return if this wouldn't even damage us. Prevents us from catching on fire for high level perks that dont take fire damage
</span><a name="2264"></a>    if( KFPRI != none &&  KFPRI.ClientVeteranSkill != none )
<a name="2265"></a>    {
<a name="2266"></a>       if( KFPRI.ClientVeteranSkill.Static.ReduceDamage(KFPRI, self, instigatedBy, <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>) &lt;= <span class="source_int">0</span> )
<a name="2267"></a>       {
<a name="2268"></a>           return;
<a name="2269"></a>       }
<a name="2270"></a>    }
<a name="2271"></a>
<a name="2272"></a>    if ( <span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/damtypeburned.html" class="source">DamTypeBurned</a></span>&gt;(<span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>) != none || <span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/damtypeflamethrower.html" class="source">DamTypeFlamethrower</a></span>&gt;(<span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>) != none)
<a name="2273"></a>    {
<a name="2274"></a>        if( <span class="source_type"><a href="../unrealgame/teamgame.html" class="source">TeamGame</a></span>(<span class="source_type">Level</span>.Game)!=None && <span class="source_type"><a href="../unrealgame/teamgame.html" class="source">TeamGame</a></span>(<span class="source_type">Level</span>.Game).FriendlyFireScale==<span class="source_int">0</span> && instigatedBy!=None && instigatedBy!=Self
<a name="2275"></a>         && instigatedBy.GetTeamNum()==GetTeamNum()  )
<a name="2276"></a>        {
<a name="2277"></a>            Return;
<a name="2278"></a>        }
<a name="2279"></a>
<a name="2280"></a>        <span class="source_comment">// Do burn damage if the damage was significant enough
</span><a name="2281"></a>        if( <span class="source_type">Damage</span> &gt; <span class="source_int">2</span> )
<a name="2282"></a>        {
<a name="2283"></a>            <span class="source_comment">// If we are already burning, and this damage is more than our current burn amount, add more burn time
</span><a name="2284"></a>            if( BurnDown &gt; <span class="source_int">0</span> && <span class="source_type">Damage</span> &gt; LastBurnDamage )
<a name="2285"></a>            {
<a name="2286"></a>                BurnDown = <span class="source_int">5</span>;
<a name="2287"></a>                BurnInstigator = instigatedBy;
<a name="2288"></a>            }
<a name="2289"></a>
<a name="2290"></a>            LastBurnDamage = <span class="source_type">Damage</span>;
<a name="2291"></a>
<a name="2292"></a>            if (BurnDown &lt;= <span class="source_int">0</span> )
<a name="2293"></a>            {
<a name="2294"></a>                bBurnified = true;
<a name="2295"></a>                BurnDown = <span class="source_int">5</span>;
<a name="2296"></a>                BurnInstigator = instigatedBy;
<a name="2297"></a>                SetTimer(<span class="source_int">1.5</span>,true);
<a name="2298"></a>            }
<a name="2299"></a>        }
<a name="2300"></a>    }
<a name="2301"></a>
<a name="2302"></a>    if(<span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/damtypevomit.html" class="source">DamTypeVomit</a></span>&gt;(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>)!=none)
<a name="2303"></a>    {
<a name="2304"></a>        BileCount=<span class="source_int">7</span>;
<a name="2305"></a>        BileInstigator = instigatedBy;
<a name="2306"></a>        LastBileDamagedByType=<span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/damtypevomit.html" class="source">DamTypeVomit</a></span>&gt;(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>);
<a name="2307"></a>        if(NextBileTime&lt; <span class="source_type">Level</span>.TimeSeconds )
<a name="2308"></a>            NextBileTime = <span class="source_type">Level</span>.TimeSeconds+BileFrequency;
<a name="2309"></a>
<a name="2310"></a>        if ( <span class="source_type">Level</span>.Game != none && <span class="source_type">Level</span>.Game.GameDifficulty &gt;= <span class="source_int">4.0</span> && <span class="source_type"><a href="../kfmod/kfplayercontroller.html" class="source">KFPlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none &&
<a name="2311"></a>             !<span class="source_type"><a href="../kfmod/kfplayercontroller.html" class="source">KFPlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).bVomittedOn)
<a name="2312"></a>        {
<a name="2313"></a>            <span class="source_type"><a href="../kfmod/kfplayercontroller.html" class="source">KFPlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).bVomittedOn = true;
<a name="2314"></a>            <span class="source_type"><a href="../kfmod/kfplayercontroller.html" class="source">KFPlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).VomittedOnTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="2315"></a>
<a name="2316"></a>            if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.TimerRate == <span class="source_int">0.0</span> )
<a name="2317"></a>            {
<a name="2318"></a>                <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.SetTimer(<span class="source_int">10.0</span>, false);
<a name="2319"></a>            }
<a name="2320"></a>        }
<a name="2321"></a>    }
<a name="2322"></a>    else if ( <span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/sirenscreamdamage.html" class="source">SirenScreamDamage</a></span>&gt;(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>) != none )
<a name="2323"></a>    {
<a name="2324"></a>        if ( <span class="source_type">Level</span>.Game != none && <span class="source_type">Level</span>.Game.GameDifficulty &gt;= <span class="source_int">4.0</span> && <span class="source_type"><a href="../kfmod/kfplayercontroller.html" class="source">KFPlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none &&
<a name="2325"></a>             !<span class="source_type"><a href="../kfmod/kfplayercontroller.html" class="source">KFPlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).bScreamedAt)
<a name="2326"></a>        {
<a name="2327"></a>            <span class="source_type"><a href="../kfmod/kfplayercontroller.html" class="source">KFPlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).bScreamedAt = true;
<a name="2328"></a>            <span class="source_type"><a href="../kfmod/kfplayercontroller.html" class="source">KFPlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).ScreamTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="2329"></a>
<a name="2330"></a>            if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.TimerRate == <span class="source_int">0.0</span> )
<a name="2331"></a>            {
<a name="2332"></a>                <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.SetTimer(<span class="source_int">10.0</span>, false);
<a name="2333"></a>            }
<a name="2334"></a>        }
<a name="2335"></a>    }
<a name="2336"></a>}
<a name="2337"></a>
<a name="2338"></a>function TakeBileDamage()
<a name="2339"></a>{
<a name="2340"></a>    Super.TakeDamage(<span class="source_int">2</span>+Rand(<span class="source_int">3</span>), BileInstigator, Location, vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>), LastBileDamagedByType);
<a name="2341"></a>    healthtoGive-=<span class="source_int">5</span>;
<a name="2342"></a>}
<a name="2343"></a>
<a name="2344"></a>function <span class="source_type">bool</span> AddShieldStrength(<span class="source_type">int</span> ShieldAmount)
<a name="2345"></a>{
<a name="2346"></a>    if(ShieldStrength &gt;= <span class="source_int">100</span>)
<a name="2347"></a>        return false;
<a name="2348"></a>
<a name="2349"></a>    ShieldStrength+=ShieldAmount;
<a name="2350"></a>    if(ShieldStrength &gt; <span class="source_int">100</span>)
<a name="2351"></a>        ShieldStrength = <span class="source_int">100</span>;
<a name="2352"></a>    return true ;
<a name="2353"></a>}
<a name="2354"></a>
<a name="2355"></a>function TakeFireDamage(<span class="source_type">int</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">pawn</a></span> BInstigator)
<a name="2356"></a>{
<a name="2357"></a>    if( <span class="source_type">Damage</span> &gt; <span class="source_int">0</span> )
<a name="2358"></a>    {
<a name="2359"></a>        TakeDamage(<span class="source_type">Damage</span>, BInstigator, Location, vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>), <span class="source_type">class</span><span class="source_name">'DamTypeBurned'</span>);
<a name="2360"></a>
<a name="2361"></a>        if (BurnDown &gt; <span class="source_int">0</span>)
<a name="2362"></a>        {
<a name="2363"></a>            BurnDown --; <span class="source_comment">// Decrement the number of FireDamage calls left before our Zombie is extinguished :)
</span><a name="2364"></a>        }
<a name="2365"></a>        if(BurnDown==<span class="source_int">0</span>)
<a name="2366"></a>        {
<a name="2367"></a>            bBurnified = false;
<a name="2368"></a>        }
<a name="2369"></a>    }
<a name="2370"></a>    else
<a name="2371"></a>    {
<a name="2372"></a>        BurnDown = <span class="source_int">0</span>;
<a name="2373"></a>        bBurnified = false;
<a name="2374"></a>    }
<a name="2375"></a>}
<a name="2376"></a>
<a name="2377"></a>function PlayHit(<span class="source_type">float</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> InstigatedBy, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitLocation</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">Momentum</span>, optional <span class="source_type">int</span> <span class="source_type">HI</span> )
<a name="2378"></a>{
<a name="2379"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">HitNormal</span>;
<a name="2380"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> HitRay;
<a name="2381"></a>    local <span class="source_type">Name</span> HitBone;
<a name="2382"></a>    local <span class="source_type">float</span> HitBoneDist;
<a name="2383"></a>    local <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span> <span class="source_type">PC</span>;
<a name="2384"></a>    local <span class="source_type">bool</span> bShowEffects, bRecentHit;
<a name="2385"></a>    local <span class="source_type"><a href="../roeffects/projectilebloodsplat.html" class="source">ProjectileBloodSplat</a></span> BloodHit;
<a name="2386"></a>    local <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span> SplatRot;
<a name="2387"></a>
<a name="2388"></a>    bRecentHit = <span class="source_type">Level</span>.TimeSeconds - LastPainTime &lt; <span class="source_int">0.2</span>;
<a name="2389"></a>
<a name="2390"></a>    <span class="source_comment">// Take you out of ironsights when taking momentum from damage
</span><a name="2391"></a>    if( VSize(<span class="source_type">Momentum</span>) &gt; <span class="source_int">0</span> && <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none )
<a name="2392"></a>    {
<a name="2393"></a>        <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).bForceLeaveIronsights = true;
<a name="2394"></a>    }
<a name="2395"></a>
<a name="2396"></a>    if ( <span class="source_type">Damage</span> &lt;= <span class="source_int">0</span> )
<a name="2397"></a>        return;
<a name="2398"></a>
<a name="2399"></a>    <span class="source_comment">// Call the modified version of the original Pawn playhit
</span><a name="2400"></a>    OldPlayHit(<span class="source_type">Damage</span>,InstigatedBy,<span class="source_type">HitLocation</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>,<span class="source_type">Momentum</span>);
<a name="2401"></a>
<a name="2402"></a>    <span class="source_type">PC</span> = <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>);
<a name="2403"></a>    bShowEffects = ( (<span class="source_type">Level</span>.NetMode != NM_Standalone) || (<span class="source_type">Level</span>.TimeSeconds - LastRenderTime &lt; <span class="source_int">2.5</span>)
<a name="2404"></a>                    || ((InstigatedBy != None) && (<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(InstigatedBy.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != None))
<a name="2405"></a>                    || (<span class="source_type">PC</span> != None) );
<a name="2406"></a>    if ( !bShowEffects )
<a name="2407"></a>        return;
<a name="2408"></a>
<a name="2409"></a>    if ( BurnDown &gt; <span class="source_int">0</span> && !bBurnified )
<a name="2410"></a>        bBurnified = true;
<a name="2411"></a>
<a name="2412"></a>    HitRay = vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>);
<a name="2413"></a>    if( InstigatedBy != None )
<a name="2414"></a>        HitRay = Normal(<span class="source_type">HitLocation</span>-(InstigatedBy.Location+(vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>)*InstigatedBy.EyeHeight)));
<a name="2415"></a>
<a name="2416"></a>    if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bLocationalHit )
<a name="2417"></a>    {
<a name="2418"></a>        CalcHitLoc( <span class="source_type">HitLocation</span>, HitRay, HitBone, HitBoneDist );
<a name="2419"></a>    }
<a name="2420"></a>    else
<a name="2421"></a>    {
<a name="2422"></a>        <span class="source_type">HitLocation</span> = Location;
<a name="2423"></a>        HitBone = FireRootBone;
<a name="2424"></a>        HitBoneDist = <span class="source_int">0.0f</span>;
<a name="2425"></a>    }
<a name="2426"></a>
<a name="2427"></a>    if( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bAlwaysSevers && <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bSpecial )
<a name="2428"></a>        HitBone = <span class="source_name">'head'</span>;
<a name="2429"></a>
<a name="2430"></a>    if( InstigatedBy != None )
<a name="2431"></a>        <span class="source_type">HitNormal</span> = Normal( Normal(InstigatedBy.Location-<span class="source_type">HitLocation</span>) + VRand() * <span class="source_int">0.2</span> + vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">2.8</span>) );
<a name="2432"></a>    else
<a name="2433"></a>        <span class="source_type">HitNormal</span> = Normal( Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>) + VRand() * <span class="source_int">0.2</span> + vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">2.8</span>) );
<a name="2434"></a>
<a name="2435"></a>    <span class="source_comment">//log("HitLocation "$Hitlocation) ;
</span><a name="2436"></a>
<a name="2437"></a>    if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.bCausesBlood && (!bRecentHit || (bRecentHit && (FRand() &gt; <span class="source_int">0.8</span>))))
<a name="2438"></a>    {
<a name="2439"></a>        if ( !<span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.NoBlood() )
<a name="2440"></a>        {
<a name="2441"></a>            if ( <span class="source_type">Momentum</span> != vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>) )
<a name="2442"></a>                SplatRot = <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>(Normal(<span class="source_type">Momentum</span>));
<a name="2443"></a>            else
<a name="2444"></a>            {
<a name="2445"></a>                if ( InstigatedBy != None )
<a name="2446"></a>                    SplatRot = <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>(Normal(Location - InstigatedBy.Location));
<a name="2447"></a>                else
<a name="2448"></a>                    SplatRot = <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>(Normal(Location - <span class="source_type">HitLocation</span>));
<a name="2449"></a>            }
<a name="2450"></a>
<a name="2451"></a>            BloodHit = Spawn(ProjectileBloodSplatClass,InstigatedBy,, <span class="source_type">HitLocation</span>, SplatRot);
<a name="2452"></a>        }
<a name="2453"></a>    }
<a name="2454"></a>
<a name="2455"></a>    <span class="source_comment">// hack for siren
</span><a name="2456"></a>    if ( (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.<span class="source_type">name</span> == <span class="source_name">'SirenScreamDamage'</span>) && (Health &lt; <span class="source_int">0</span>) )
<a name="2457"></a>    {
<a name="2458"></a>        if( (InstigatedBy != None) && (VSize(InstigatedBy.Location - Location) &lt; <span class="source_int">200</span>) )
<a name="2459"></a>        {
<a name="2460"></a>            DoDamageFX( <span class="source_name">'obliterate'</span>, <span class="source_int">5000</span> * <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span>(<span class="source_type">HitNormal</span>) );
<a name="2461"></a>        }
<a name="2462"></a>        else
<a name="2463"></a>        {
<a name="2464"></a>            DoDamageFX( HeadBone, <span class="source_int">5000</span> * <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span>(<span class="source_type">HitNormal</span>) );
<a name="2465"></a>            PlaySound(DecapitationSound, SLOT_Misc,<span class="source_int">1.30</span>,true,<span class="source_int">525</span>);
<a name="2466"></a>        }
<a name="2467"></a>    }
<a name="2468"></a>    else
<a name="2469"></a>        DoDamageFX( HitBone, <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span>(<span class="source_type">HitNormal</span>) );
<a name="2470"></a>
<a name="2471"></a>    if (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DamageOverlayMaterial != None && <span class="source_type">Damage</span> &gt; <span class="source_int">0</span> ) <span class="source_comment">// additional check in case shield absorbed
</span><a name="2472"></a>                SetOverlayMaterial( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DamageOverlayMaterial, <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.DamageOverlayTime, false );
<a name="2473"></a>
<a name="2474"></a>
<a name="2475"></a>}
<a name="2476"></a>
<a name="2477"></a><span class="source_comment">// Modified version of the original Pawn playhit. Set up because we want our blood puffs to be directional based
</span><a name="2478"></a><span class="source_comment">// On the momentum of the bullet, not out from the center of the player
</span><a name="2479"></a>function OldPlayHit(<span class="source_type">float</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> InstigatedBy, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitLocation</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">Momentum</span>, optional <span class="source_type">int</span> <span class="source_type">HitIndex</span>)
<a name="2480"></a>{
<a name="2481"></a>    local <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span> Hearer;
<a name="2482"></a>
<a name="2483"></a>    if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> == None )
<a name="2484"></a>        return;
<a name="2485"></a>    if ( (<span class="source_type">Damage</span> &lt;= <span class="source_int">0</span>) && ((<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> == None) || !<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.bGodMode) )
<a name="2486"></a>        return;
<a name="2487"></a>
<a name="2488"></a>    if (<span class="source_type">Damage</span> &gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Default.DamageThreshold) <span class="source_comment">//spawn some blood
</span><a name="2489"></a>    {
<a name="2490"></a>        SpawnHitEmitter( <span class="source_type">Damage</span>, InstigatedBy, <span class="source_type">HitLocation</span>, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, <span class="source_type">Momentum</span> );
<a name="2491"></a>    }
<a name="2492"></a>    if ( Health &lt;= <span class="source_int">0</span> )
<a name="2493"></a>    {
<a name="2494"></a>        if ( <span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>.bDestructive && (<span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>.ExitActor != None) )
<a name="2495"></a>            Spawn(<span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>.ExitActor);
<a name="2496"></a>        return;
<a name="2497"></a>    }
<a name="2498"></a>
<a name="2499"></a>    if ( <span class="source_type">Level</span>.TimeSeconds - LastPainTime &gt; <span class="source_int">0.1</span> )
<a name="2500"></a>    {
<a name="2501"></a>        if ( InstigatedBy != None && (<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span> != None) && <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bDirectDamage )
<a name="2502"></a>            Hearer = <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(InstigatedBy.<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>);
<a name="2503"></a>        if ( Hearer != None )
<a name="2504"></a>            Hearer.bAcuteHearing = true;
<a name="2505"></a>        PlayTakeHit(<span class="source_type">HitLocation</span>,<span class="source_type">Damage</span>,<span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>);
<a name="2506"></a>        if ( Hearer != None )
<a name="2507"></a>            Hearer.bAcuteHearing = false;
<a name="2508"></a>        LastPainTime = <span class="source_type">Level</span>.TimeSeconds;
<a name="2509"></a>    }
<a name="2510"></a>}
<a name="2511"></a>
<a name="2512"></a>function SpawnHitEmitter( <span class="source_type">float</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> InstigatedBy, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitLocation</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">Momentum</span> )
<a name="2513"></a>{
<a name="2514"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">HitNormal</span>;
<a name="2515"></a>    local <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/effects.html" class="source">Effects</a></span>&gt; DesiredEffect;
<a name="2516"></a>    local <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/emitter.html" class="source">Emitter</a></span>&gt; DesiredEmitter;
<a name="2517"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> BloodOffset, <span class="source_type">Mo</span>;
<a name="2518"></a>
<a name="2519"></a>    <span class="source_comment">// Play any set effect
</span><a name="2520"></a>    if ( EffectIsRelevant(Location,true) )
<a name="2521"></a>    {
<a name="2522"></a>        <span class="source_type">HitNormal</span> = Normal(<span class="source_type">HitLocation</span> - Location);
<a name="2523"></a>        DesiredEffect = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.static.GetPawnDamageEffect(<span class="source_type">HitLocation</span>, <span class="source_type">Damage</span>, <span class="source_type">Momentum</span>, self, (<span class="source_type">Level</span>.bDropDetail || <span class="source_type">Level</span>.DetailMode == DM_Low));
<a name="2524"></a>
<a name="2525"></a>        if ( DesiredEffect != None )
<a name="2526"></a>        {
<a name="2527"></a>            BloodOffset = <span class="source_int">0.2</span> * CollisionRadius * <span class="source_type">HitNormal</span>;
<a name="2528"></a>            BloodOffset.<span class="source_type">Z</span> = BloodOffset.<span class="source_type">Z</span> * <span class="source_int">0.5</span>;
<a name="2529"></a>
<a name="2530"></a>            <span class="source_type">Mo</span> = <span class="source_type">Momentum</span>;
<a name="2531"></a>            if ( <span class="source_type">Mo</span>.<span class="source_type">Z</span> &gt; <span class="source_int">0</span> )
<a name="2532"></a>                <span class="source_type">Mo</span>.<span class="source_type">Z</span> *= <span class="source_int">0.5</span>;
<a name="2533"></a>            spawn(DesiredEffect,self,,<span class="source_type">HitLocation</span> + BloodOffset, <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span>(<span class="source_type">Mo</span>));
<a name="2534"></a>        }
<a name="2535"></a>
<a name="2536"></a>        <span class="source_comment">// Spawn any preset emitter
</span><a name="2537"></a>        DesiredEmitter = <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.Static.GetPawnDamageEmitter(<span class="source_type">HitLocation</span>, <span class="source_type">Damage</span>, <span class="source_type">Momentum</span>, self, (<span class="source_type">Level</span>.bDropDetail || <span class="source_type">Level</span>.DetailMode == DM_Low));
<a name="2538"></a>        if (DesiredEmitter != None)
<a name="2539"></a>        {
<a name="2540"></a>            if( InstigatedBy != none )
<a name="2541"></a>                <span class="source_type">HitNormal</span> = Normal((InstigatedBy.Location+(vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>)*InstigatedBy.EyeHeight))-<span class="source_type">HitLocation</span>);
<a name="2542"></a>
<a name="2543"></a>            spawn(DesiredEmitter,,,<span class="source_type">HitLocation</span>+<span class="source_type">HitNormal</span> + (-<span class="source_type">HitNormal</span> * CollisionRadius), <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span>(<span class="source_type">HitNormal</span>));
<a name="2544"></a>        }
<a name="2545"></a>    }
<a name="2546"></a>}
<a name="2547"></a>
<a name="2548"></a>simulated function AttachEffect( <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/xemitter.html" class="source">xEmitter</a></span>&gt; EmitterClass, <span class="source_type">Name</span> BoneName, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> Location, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span> <span class="source_type">Rotation</span> )
<a name="2549"></a>{
<a name="2550"></a>    local <span class="source_type"><a href="../engine/actor.html" class="source">Actor</a></span> <span class="source_type">a</span>;
<a name="2551"></a>    local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="2552"></a>
<a name="2553"></a>    if( bSkeletized || (BoneName == <span class="source_name">'None'</span>) )
<a name="2554"></a>        return;
<a name="2555"></a>
<a name="2556"></a>    for( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; Attached.Length; <span class="source_type">i</span>++ )
<a name="2557"></a>    {
<a name="2558"></a>        if( Attached[<span class="source_type">i</span>] == None )
<a name="2559"></a>            continue;
<a name="2560"></a>
<a name="2561"></a>        if( Attached[<span class="source_type">i</span>].AttachmentBone != BoneName )
<a name="2562"></a>            continue;
<a name="2563"></a>
<a name="2564"></a>        if( ClassIsChildOf( EmitterClass, Attached[<span class="source_type">i</span>].<span class="source_type">Class</span> ) )
<a name="2565"></a>            return;
<a name="2566"></a>    }
<a name="2567"></a>
<a name="2568"></a>    <span class="source_type">a</span> = Spawn( EmitterClass,,, Location, <span class="source_type">Rotation</span> );
<a name="2569"></a>
<a name="2570"></a>    if (<span class="source_type">a</span> == none)
<a name="2571"></a>     return;
<a name="2572"></a>
<a name="2573"></a>    if( !AttachToBone( <span class="source_type">a</span>, BoneName ) )
<a name="2574"></a>    {
<a name="2575"></a>        log( <span class="source_string">"Couldn't attach "</span>$EmitterClass$<span class="source_string">" to "</span>$BoneName, <span class="source_name">'Error'</span> );
<a name="2576"></a>        <span class="source_type">a</span>.Destroy();
<a name="2577"></a>        return;
<a name="2578"></a>    }
<a name="2579"></a>
<a name="2580"></a>    for( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; Attached.length; <span class="source_type">i</span>++ )
<a name="2581"></a>    {
<a name="2582"></a>        if( Attached[<span class="source_type">i</span>] == <span class="source_type">a</span> )
<a name="2583"></a>            break;
<a name="2584"></a>    }
<a name="2585"></a>
<a name="2586"></a>    <span class="source_type">a</span>.SetRelativeRotation( <span class="source_type">Rotation</span> );
<a name="2587"></a>}
<a name="2588"></a>
<a name="2589"></a>simulated function SpawnGiblet( <span class="source_type">class</span>&lt;<span class="source_type"><a href="../old2k4/gib.html" class="source">Gib</a></span>&gt; GibClass, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> Location, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span> <span class="source_type">Rotation</span>, <span class="source_type">float</span> <span class="source_type">GibPerterbation</span> )
<a name="2590"></a>{
<a name="2591"></a>    local <span class="source_type"><a href="../old2k4/gib.html" class="source">Gib</a></span> Giblet;
<a name="2592"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">Direction</span>, Dummy;
<a name="2593"></a>
<a name="2594"></a>    if( (GibClass == None) || <span class="source_type">class</span><span class="source_name">'GameInfo'</span>.static.UseLowGore() )
<a name="2595"></a>        return;
<a name="2596"></a>
<a name="2597"></a>    <span class="source_type">Instigator</span> = self;
<a name="2598"></a>    Giblet = Spawn( GibClass,,, Location, <span class="source_type">Rotation</span> );
<a name="2599"></a>    if( Giblet == None )
<a name="2600"></a>        return;
<a name="2601"></a>
<a name="2602"></a>    Giblet.bFlaming = bFlaming;
<a name="2603"></a>    Giblet.SpawnTrail();
<a name="2604"></a>
<a name="2605"></a>    <span class="source_type">GibPerterbation</span> *= <span class="source_int">32768.0</span>;
<a name="2606"></a>    <span class="source_type">Rotation</span>.Pitch += ( FRand() * <span class="source_int">2.0</span> * <span class="source_type">GibPerterbation</span> ) - <span class="source_type">GibPerterbation</span>;
<a name="2607"></a>    <span class="source_type">Rotation</span>.Yaw += ( FRand() * <span class="source_int">2.0</span> * <span class="source_type">GibPerterbation</span> ) - <span class="source_type">GibPerterbation</span>;
<a name="2608"></a>    <span class="source_type">Rotation</span>.Roll += ( FRand() * <span class="source_int">2.0</span> * <span class="source_type">GibPerterbation</span> ) - <span class="source_type">GibPerterbation</span>;
<a name="2609"></a>
<a name="2610"></a>    GetAxes( <span class="source_type">Rotation</span>, Dummy, Dummy, <span class="source_type">Direction</span> );
<a name="2611"></a>
<a name="2612"></a>    Giblet.Velocity = Velocity + Normal(<span class="source_type">Direction</span>) * (<span class="source_int">250</span> + <span class="source_int">260</span> * FRand());
<a name="2613"></a>    Giblet.LifeSpan = Giblet.LifeSpan + <span class="source_int">2</span> * FRand() - <span class="source_int">1</span>;
<a name="2614"></a>}
<a name="2615"></a>
<a name="2616"></a><span class="source_type">State</span> Dying
<a name="2617"></a>{
<a name="2618"></a>    simulated function AnimEnd( <span class="source_type">int</span> <span class="source_type">Channel</span> );
<a name="2619"></a>
<a name="2620"></a>    simulated function <span class="source_type">bool</span> SpecialCalcView( out <span class="source_type"><a href="../engine/actor.html" class="source">Actor</a></span> ViewActor, out <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> CameraLocation, out <span class="source_type"><a href="../core/object.html#Rotator" class="source">rotator</a></span> <span class="source_type">CameraRotation</span> )
<a name="2621"></a>    {
<a name="2622"></a>        local <span class="source_type"><a href="../core/object.html#Coords" class="source">Coords</a></span> Co;
<a name="2623"></a>        local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> HL,HN;
<a name="2624"></a>
<a name="2625"></a>        ViewActor = Self;
<a name="2626"></a>        Co = GetBoneCoords(<span class="source_name">'CHR_Head'</span>);
<a name="2627"></a>        CameraLocation = Co.Origin+Co.XAxis*<span class="source_int">8</span>;
<a name="2628"></a>        <span class="source_comment">// Make sure camera dosent show through world geometry.
</span><a name="2629"></a>        if( Trace(HL,HN,CameraLocation+vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">25</span>),CameraLocation,False)!=None )
<a name="2630"></a>            CameraLocation+=HN*<span class="source_int">25</span>;
<a name="2631"></a>        if( Trace(HL,HN,CameraLocation-vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">25</span>),CameraLocation,False)!=None )
<a name="2632"></a>            CameraLocation+=HN*<span class="source_int">25</span>;
<a name="2633"></a>        if( Trace(HL,HN,CameraLocation+vect(<span class="source_int">25</span>,<span class="source_int">0</span>,<span class="source_int">0</span>),CameraLocation,False)!=None )
<a name="2634"></a>            CameraLocation+=HN*<span class="source_int">25</span>;
<a name="2635"></a>        if( Trace(HL,HN,CameraLocation-vect(<span class="source_int">25</span>,<span class="source_int">0</span>,<span class="source_int">0</span>),CameraLocation,False)!=None )
<a name="2636"></a>            CameraLocation+=HN*<span class="source_int">25</span>;
<a name="2637"></a>        if( Trace(HL,HN,CameraLocation+vect(<span class="source_int">0</span>,<span class="source_int">25</span>,<span class="source_int">0</span>),CameraLocation,False)!=None )
<a name="2638"></a>            CameraLocation+=HN*<span class="source_int">25</span>;
<a name="2639"></a>        if( Trace(HL,HN,CameraLocation-vect(<span class="source_int">0</span>,<span class="source_int">25</span>,<span class="source_int">0</span>),CameraLocation,False)!=None )
<a name="2640"></a>            CameraLocation+=HN*<span class="source_int">25</span>;
<a name="2641"></a>        GetAxes(GetBoneRotation(<span class="source_name">'CHR_Head'</span>),Co.XAxis,Co.YAxis,Co.<span class="source_type">ZAxis</span>);
<a name="2642"></a>        <span class="source_type">CameraRotation</span> = OrthoRotation(-Co.YAxis,Co.<span class="source_type">ZAxis</span>,Co.XAxis); <span class="source_comment">// Turns the camera by 90 degrees.
</span><a name="2643"></a>        Return True;
<a name="2644"></a>    }
<a name="2645"></a>    event FellOutOfWorld(<span class="source_type"><a href="../engine/actor.html#eKillZType" class="source">eKillZType</a></span> KillType)
<a name="2646"></a>    {
<a name="2647"></a>        local <span class="source_type"><a href="../old2k4/lavadeath.html" class="source">LavaDeath</a></span> LD;
<a name="2648"></a>
<a name="2649"></a>        <span class="source_comment">// If we fall past a lava killz while dead- burn off skin.
</span><a name="2650"></a>        if( KillType == KILLZ_Lava )
<a name="2651"></a>        {
<a name="2652"></a>            if ( !bSkeletized )
<a name="2653"></a>            {
<a name="2654"></a>                if ( SkeletonMesh != None )
<a name="2655"></a>                {
<a name="2656"></a>                    LinkMesh(SkeletonMesh, true);
<a name="2657"></a>                    Skins.Length = <span class="source_int">0</span>;
<a name="2658"></a>                }
<a name="2659"></a>                bSkeletized = true;
<a name="2660"></a>
<a name="2661"></a>                LD = spawn(<span class="source_type">class</span><span class="source_name">'LavaDeath'</span>, , , Location + vect(<span class="source_int">0</span>, <span class="source_int">0</span>, <span class="source_int">10</span>), <span class="source_type">Rotation</span> );
<a name="2662"></a>                if ( LD != None )
<a name="2663"></a>                    LD.SetBase(self);
<a name="2664"></a>                <span class="source_comment">// This should destroy itself once its finished.
</span><a name="2665"></a>                PlaySound( <span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span><span class="source_name">'Inf_Weapons.F1.f1_explode01'</span>, SLOT_None, <span class="source_int">1.5</span>*TransientSoundVolume ); <span class="source_comment">// KFTODO: Replace this sound
</span><a name="2666"></a>            }
<a name="2667"></a>            return;
<a name="2668"></a>        }
<a name="2669"></a>        Super.FellOutOfWorld(KillType);
<a name="2670"></a>    }
<a name="2671"></a>
<a name="2672"></a>    simulated function TakeDamage( <span class="source_type">int</span> <span class="source_type">Damage</span>, <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span> InstigatedBy, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">Hitlocation</span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">Momentum</span>, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, optional <span class="source_type">int</span> <span class="source_type">HI</span> )
<a name="2673"></a>    {
<a name="2674"></a>        local <span class="source_type"><a href="../engine/emitter.html" class="source">emitter</a></span> BloodHit;
<a name="2675"></a>
<a name="2676"></a>        Health -= <span class="source_type">Damage</span>;
<a name="2677"></a>
<a name="2678"></a>        if (Health &lt;= -<span class="source_int">200</span>)
<a name="2679"></a>        {
<a name="2680"></a>            <span class="source_comment">// Gibbed
</span><a name="2681"></a>            BloodHit = Spawn(<span class="source_type">class</span><span class="source_name">'KFMod.FeedingSpray'</span>,InstigatedBy,,Location,<span class="source_type">Rotation</span>);
<a name="2682"></a>
<a name="2683"></a>            <span class="source_comment">// KFTODO: Replace this spawn giblet with
</span><a name="2684"></a><span class="source_comment">//            SpawnGiblet(class 'ClotGibHead',HitLocation, self.Rotation, 0.06 ) ;
</span><a name="2685"></a><span class="source_comment">//
</span><a name="2686"></a><span class="source_comment">//          SpawnGiblet(class 'ClotGibTorso',HitLocation, self.Rotation, 0.06) ;
</span><a name="2687"></a><span class="source_comment">//          SpawnGiblet(class 'ClotGibLowerTorso',HitLocation, self.Rotation, 0.06 ) ;
</span><a name="2688"></a><span class="source_comment">//
</span><a name="2689"></a><span class="source_comment">//          SpawnGiblet(class 'ClotGibArm',HitLocation, self.Rotation, 0.06 ) ;
</span><a name="2690"></a><span class="source_comment">//          SpawnGiblet(class 'ClotGibArm',HitLocation, self.Rotation, 0.06 ) ;
</span><a name="2691"></a><span class="source_comment">//
</span><a name="2692"></a><span class="source_comment">//          SpawnGiblet(class 'ClotGibThigh',HitLocation, self.Rotation, 0.06 ) ;
</span><a name="2693"></a><span class="source_comment">//          SpawnGiblet(class 'ClotGibThigh',HitLocation, self.Rotation, 0.06 ) ;
</span><a name="2694"></a><span class="source_comment">//
</span><a name="2695"></a><span class="source_comment">//          SpawnGiblet(class 'ClotGibLeg',HitLocation, self.Rotation, 0.06 ) ;
</span><a name="2696"></a><span class="source_comment">//          SpawnGiblet(class 'ClotGibLeg',HitLocation, self.Rotation, 0.06 ) ;
</span><a name="2697"></a>
<a name="2698"></a>            if( Physics == PHYS_KarmaRagdoll )
<a name="2699"></a>            {
<a name="2700"></a>                bDestroyAfterRagDollTick = true;
<a name="2701"></a>            }
<a name="2702"></a>            else
<a name="2703"></a>            {
<a name="2704"></a>                Destroy();
<a name="2705"></a>            }
<a name="2706"></a>        }
<a name="2707"></a>    }
<a name="2708"></a>
<a name="2709"></a>    simulated function BeginState()
<a name="2710"></a>    {
<a name="2711"></a>        local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="2712"></a>
<a name="2713"></a>        bSpecialCalcView = <span class="source_type">Class</span><span class="source_name">'KFPawn'</span>.Default.bRealDeathType;
<a name="2714"></a>        if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="2715"></a>        {
<a name="2716"></a>            if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.bIsPlayer )
<a name="2717"></a>                <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.PawnDied(self);
<a name="2718"></a>            else <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.Destroy();
<a name="2719"></a>        }
<a name="2720"></a>        for (<span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; Attached.length; <span class="source_type">i</span>++)
<a name="2721"></a>            if (Attached[<span class="source_type">i</span>] != None)
<a name="2722"></a>                Attached[<span class="source_type">i</span>].PawnBaseDied();
<a name="2723"></a>        <span class="source_type"><a href="../engine/ambientsound.html" class="source">AmbientSound</a></span> = None;
<a name="2724"></a>        if( <span class="source_type">Level</span>.NetMode==NM_DedicatedServer )
<a name="2725"></a>            SetTimer(<span class="source_int">1</span>,False);
<a name="2726"></a>        SetTimer(<span class="source_int">5</span>,False);
<a name="2727"></a>    }
<a name="2728"></a>
<a name="2729"></a>    simulated function Timer()
<a name="2730"></a>    {
<a name="2731"></a>        if( <span class="source_type">Level</span>.NetMode==NM_DedicatedServer )
<a name="2732"></a>        {
<a name="2733"></a>            Destroy();
<a name="2734"></a>            Return;
<a name="2735"></a>        }
<a name="2736"></a>        if( Physics!=PHYS_None )
<a name="2737"></a>        {
<a name="2738"></a>            if( VSize(Velocity)&gt;<span class="source_int">10</span> )
<a name="2739"></a>            {
<a name="2740"></a>                SetTimer(<span class="source_int">1</span>,False);
<a name="2741"></a>                Return;
<a name="2742"></a>            }
<a name="2743"></a>            SetPhysics(PHYS_None);
<a name="2744"></a>            SetTimer(<span class="source_int">30</span>,False);
<a name="2745"></a>            if(PlayerShadow != None)
<a name="2746"></a>                PlayerShadow.bShadowActive = false;
<a name="2747"></a>        }
<a name="2748"></a>        else if( (<span class="source_type">Level</span>.TimeSeconds-LastRenderTime)&gt;<span class="source_int">40</span> || <span class="source_type">Level</span>.bDropDetail )
<a name="2749"></a>            Destroy();
<a name="2750"></a>        else SetTimer(<span class="source_int">5</span>,False);
<a name="2751"></a>    }
<a name="2752"></a>
<a name="2753"></a>    <span class="source_comment">// We shorten the lifetime when the guys comes to rest.
</span><a name="2754"></a>    <span class="source_comment">// Alex: No , you dont.
</span><a name="2755"></a>    event KVelDropBelow()
<a name="2756"></a>    {
<a name="2757"></a>    }
<a name="2758"></a>}
<a name="2759"></a>
<a name="2760"></a>simulated event Destroyed()
<a name="2761"></a>{
<a name="2762"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="2763"></a>
<a name="2764"></a>    <span class="source_comment">// Make attached explosives blow up when this pawn dies
</span><a name="2765"></a>	for( <span class="source_type">i</span>=<span class="source_int">0</span>; <span class="source_type">i</span>&lt;Attached.length; <span class="source_type">i</span>++ )
<a name="2766"></a>	{
<a name="2767"></a>		if( <span class="source_type"><a href="../kfmod/sealsquealprojectile.html" class="source">SealSquealProjectile</a></span>(Attached[<span class="source_type">i</span>])!=None )
<a name="2768"></a>		{
<a name="2769"></a>			<span class="source_type"><a href="../kfmod/sealsquealprojectile.html" class="source">SealSquealProjectile</a></span>(Attached[<span class="source_type">i</span>]).HandleBasePawnDestroyed();
<a name="2770"></a>		}
<a name="2771"></a>	}
<a name="2772"></a>
<a name="2773"></a>    if ( ItBUURRNNNS != none )
<a name="2774"></a>    {
<a name="2775"></a>        ItBUURRNNNS.Emitters[<span class="source_int">0</span>].SkeletalMeshActor = none;
<a name="2776"></a>        ItBUURRNNNS.Destroy();
<a name="2777"></a>    }
<a name="2778"></a>
<a name="2779"></a>    if( Adjuster!=None )
<a name="2780"></a>        Adjuster.Destroy();
<a name="2781"></a>
<a name="2782"></a>    if( SeveredLeftArm != none )
<a name="2783"></a>    {
<a name="2784"></a>        SeveredLeftArm.Destroy();
<a name="2785"></a>    }
<a name="2786"></a>
<a name="2787"></a>    if( SeveredRightArm != none )
<a name="2788"></a>    {
<a name="2789"></a>        SeveredRightArm.Destroy();
<a name="2790"></a>    }
<a name="2791"></a>
<a name="2792"></a>    if( SeveredRightLeg != none )
<a name="2793"></a>    {
<a name="2794"></a>        SeveredRightLeg.Destroy();
<a name="2795"></a>    }
<a name="2796"></a>
<a name="2797"></a>    if( SeveredLeftLeg != none )
<a name="2798"></a>    {
<a name="2799"></a>        SeveredLeftLeg.Destroy();
<a name="2800"></a>    }
<a name="2801"></a>
<a name="2802"></a>    if( <span class="source_type"><a href="../kfmod/severedhead.html" class="source">SeveredHead</a></span> != none )
<a name="2803"></a>    {
<a name="2804"></a>        <span class="source_type"><a href="../kfmod/severedhead.html" class="source">SeveredHead</a></span>.Destroy();
<a name="2805"></a>    }
<a name="2806"></a>
<a name="2807"></a>    if ( AuxCollisionCylinder != none )
<a name="2808"></a>    {
<a name="2809"></a>        AuxCollisionCylinder.Destroy();
<a name="2810"></a>    }
<a name="2811"></a>
<a name="2812"></a>    if ( AttachedEmitter != none )
<a name="2813"></a>    {
<a name="2814"></a>        AttachedEmitter.Destroy();
<a name="2815"></a>    }
<a name="2816"></a>
<a name="2817"></a>    Super.Destroyed();
<a name="2818"></a>}
<a name="2819"></a>
<a name="2820"></a>function Died(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> Killer, <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>&gt; <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">HitLocation</span>)
<a name="2821"></a>{
<a name="2822"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span>            TossVel;
<a name="2823"></a>    local <span class="source_type"><a href="../engine/trigger.html" class="source">Trigger</a></span>           <span class="source_type">T</span>;
<a name="2824"></a>    local <span class="source_type"><a href="../engine/navigationpoint.html" class="source">NavigationPoint</a></span>   <span class="source_type">N</span>;
<a name="2825"></a>    local <span class="source_type"><a href="../kfmod/playerdeathmark.html" class="source">PlayerDeathMark</a></span> D;
<a name="2826"></a>    local <span class="source_type"><a href="../engine/projectile.html" class="source">Projectile</a></span> PP;
<a name="2827"></a>    local <span class="source_type"><a href="../kfmod/fakeplayerpawn.html" class="source">FakePlayerPawn</a></span> FP;
<a name="2828"></a>	local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="2829"></a>
<a name="2830"></a>    if ( bDeleteMe || <span class="source_type">Level</span>.bLevelChange || <span class="source_type">Level</span>.Game == None )
<a name="2831"></a>        return; <span class="source_comment">// already destroyed, or level is being cleaned up
</span><a name="2832"></a>
<a name="2833"></a>    if ( <span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>.default.bCausedByWorld && (Killer == None || Killer == <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) && LastHitBy != None )
<a name="2834"></a>        Killer = LastHitBy;
<a name="2835"></a>
<a name="2836"></a>    <span class="source_comment">// mutator hook to prevent deaths
</span><a name="2837"></a>    <span class="source_comment">// WARNING - don't prevent bot suicides - they suicide when really needed
</span><a name="2838"></a>    if ( <span class="source_type">Level</span>.Game.PreventDeath(self, Killer, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>, <span class="source_type">HitLocation</span>) )
<a name="2839"></a>    {
<a name="2840"></a>        Health = <span class="source_type">max</span>(Health, <span class="source_int">1</span>); <span class="source_comment">//mutator should set this higher
</span><a name="2841"></a>        return;
<a name="2842"></a>    }
<a name="2843"></a>
<a name="2844"></a>    <span class="source_comment">// Turn off the auxilary collision when the player dies
</span><a name="2845"></a>    if (  AuxCollisionCylinder != none )
<a name="2846"></a>    {
<a name="2847"></a>        AuxCollisionCylinder.SetCollision(false,false,false);
<a name="2848"></a>    }
<a name="2849"></a>
<a name="2850"></a>    <span class="source_comment">// Hack fix for team-killing.
</span><a name="2851"></a>    if( <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>)!=None )
<a name="2852"></a>    {
<a name="2853"></a>        FP = <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).GetBlamePawn();
<a name="2854"></a>        if( FP!=None )
<a name="2855"></a>        {
<a name="2856"></a>            ForEach DynamicActors(<span class="source_type">Class</span><span class="source_name">'Projectile'</span>,PP)
<a name="2857"></a>            {
<a name="2858"></a>                if( PP.<span class="source_type">Instigator</span>==Self )
<a name="2859"></a>                    PP.<span class="source_type">Instigator</span> = FP;
<a name="2860"></a>            }
<a name="2861"></a>        }
<a name="2862"></a>    }
<a name="2863"></a>
<a name="2864"></a>    D = Spawn(<span class="source_type">Class</span><span class="source_name">'PlayerDeathMark'</span>);
<a name="2865"></a>    if( D!=None )
<a name="2866"></a>        D.Velocity = Velocity;
<a name="2867"></a>
<a name="2868"></a>    Health = Min(<span class="source_int">0</span>, Health);
<a name="2869"></a>
<a name="2870"></a>    if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None && (DrivenVehicle == None || DrivenVehicle.bAllowWeaponToss) )
<a name="2871"></a>    {
<a name="2872"></a>        if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="2873"></a>            <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.LastPawnWeapon = <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.<span class="source_type">Class</span>;
<a name="2874"></a>        <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.HolderDied();
<a name="2875"></a>        TossVel = <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span>(GetViewRotation());
<a name="2876"></a>        TossVel = TossVel * ((Velocity Dot TossVel) + <span class="source_int">500</span>) + Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">200</span>);
<a name="2877"></a>        TossWeapon(TossVel);
<a name="2878"></a>    }
<a name="2879"></a>    if ( DrivenVehicle != None )
<a name="2880"></a>    {
<a name="2881"></a>        Velocity = DrivenVehicle.Velocity;
<a name="2882"></a>        DrivenVehicle.DriverDied();
<a name="2883"></a>    }
<a name="2884"></a>
<a name="2885"></a>    if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> != None )
<a name="2886"></a>    {
<a name="2887"></a>        <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.WasKilledBy(Killer);
<a name="2888"></a>        <span class="source_type">Level</span>.Game.<span class="source_type">Killed</span>(Killer, <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>, self, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>);
<a name="2889"></a>    }
<a name="2890"></a>    else <span class="source_type">Level</span>.Game.<span class="source_type">Killed</span>(Killer, <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>(<span class="source_type">Owner</span>), self, <span class="source_type"><a href="../engine/damagetype.html" class="source">damageType</a></span>);
<a name="2891"></a>
<a name="2892"></a>    DrivenVehicle = None;
<a name="2893"></a>
<a name="2894"></a>    if ( Killer != None )
<a name="2895"></a>        TriggerEvent(Event, self, Killer.<span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>);
<a name="2896"></a>    else TriggerEvent(Event, self, None);
<a name="2897"></a>
<a name="2898"></a>    <span class="source_comment">// make sure to untrigger any triggers requiring player touch
</span><a name="2899"></a>    if ( IsPlayerPawn() || WasPlayerPawn() )
<a name="2900"></a>    {
<a name="2901"></a>        <span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>.PlayerPawnDiedInVolume(self);
<a name="2902"></a>        ForEach TouchingActors(<span class="source_type">class</span><span class="source_name">'Trigger'</span>,<span class="source_type">T</span>)
<a name="2903"></a>            <span class="source_type">T</span>.PlayerToucherDied(self);
<a name="2904"></a>
<a name="2905"></a>        <span class="source_comment">// event for HoldObjectives
</span><a name="2906"></a>        ForEach TouchingActors(<span class="source_type">class</span><span class="source_name">'NavigationPoint'</span>, <span class="source_type">N</span>)
<a name="2907"></a>            if ( <span class="source_type">N</span>.bReceivePlayerToucherDiedNotify )
<a name="2908"></a>                <span class="source_type">N</span>.PlayerToucherDied( Self );
<a name="2909"></a>    }
<a name="2910"></a>    <span class="source_comment">// remove powerup effects, etc.
</span><a name="2911"></a>    RemovePowerups();
<a name="2912"></a>
<a name="2913"></a>    Velocity.<span class="source_type">Z</span> *= <span class="source_int">1.3</span>;
<a name="2914"></a>
<a name="2915"></a>    <span class="source_comment">// Make attached explosives blow up when this pawn dies
</span><a name="2916"></a> 	for( <span class="source_type">i</span>=<span class="source_int">0</span>; <span class="source_type">i</span>&lt;Attached.length; <span class="source_type">i</span>++ )
<a name="2917"></a>	{
<a name="2918"></a>		if( <span class="source_type"><a href="../kfmod/sealsquealprojectile.html" class="source">SealSquealProjectile</a></span>(Attached[<span class="source_type">i</span>])!=None )
<a name="2919"></a>		{
<a name="2920"></a>			<span class="source_type"><a href="../kfmod/sealsquealprojectile.html" class="source">SealSquealProjectile</a></span>(Attached[<span class="source_type">i</span>]).HandleBasePawnDestroyed();
<a name="2921"></a>		}
<a name="2922"></a>	}
<a name="2923"></a>
<a name="2924"></a>    if ( IsHumanControlled() )
<a name="2925"></a>        <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).ForceDeathUpdate();
<a name="2926"></a>
<a name="2927"></a>    NetUpdateFrequency = Default.NetUpdateFrequency;
<a name="2928"></a>    PlayDying(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type">HitLocation</span>);
<a name="2929"></a>    if ( !bPhysicsAnimUpdate && !IsLocallyControlled() )
<a name="2930"></a>        ClientDying(<span class="source_type"><a href="../engine/damagetype.html" class="source">DamageType</a></span>, <span class="source_type">HitLocation</span>);
<a name="2931"></a>}
<a name="2932"></a>
<a name="2933"></a>simulated function ChunkUp( <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span> HitRotation, <span class="source_type">float</span> <span class="source_type">ChunkPerterbation</span> )
<a name="2934"></a>{
<a name="2935"></a>  <span class="source_comment">/*
<a name="2936"></a>    if ( (Level.NetMode != NM_Client) && (Controller != None) )
<a name="2937"></a>    {
<a name="2938"></a>        if ( Controller.bIsPlayer )
<a name="2939"></a>            Controller.PawnDied(self);
<a name="2940"></a>        else
<a name="2941"></a>            Controller.Destroy();
<a name="2942"></a>    }
<a name="2943"></a>
<a name="2944"></a>    bTearOff = true;
<a name="2945"></a>    HitDamageType = class'Gibbed'; // make sure clients gib also
<a name="2946"></a>    if ( (Level.NetMode == NM_DedicatedServer) || (Level.NetMode == NM_ListenServer) )
<a name="2947"></a>        GotoState('TimingOut');
<a name="2948"></a>    if ( Level.NetMode == NM_DedicatedServer )
<a name="2949"></a>        return;
<a name="2950"></a>    if ( class'GameInfo'.static.UseLowGore() )
<a name="2951"></a>    {
<a name="2952"></a>        Destroy();
<a name="2953"></a>        return;
<a name="2954"></a>    }
<a name="2955"></a>    SpawnGibs(HitRotation,ChunkPerterbation);
<a name="2956"></a>
<a name="2957"></a>    if ( Level.NetMode != NM_ListenServer )
<a name="2958"></a>        Destroy();
<a name="2959"></a>        */</span>
<a name="2960"></a>}
<a name="2961"></a>
<a name="2962"></a>
<a name="2963"></a><span class="source_comment">// toss some of your cash away. (to help a cash-strapped ally or perhaps just to party like its 1994)
</span><a name="2964"></a>exec function TossCash( <span class="source_type">int</span> <span class="source_type">Amount</span> )
<a name="2965"></a>{
<a name="2966"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>;
<a name="2967"></a>    local <span class="source_type"><a href="../kfmod/cashpickup.html" class="source">CashPickup</a></span> <span class="source_type"><a href="../kfmod/cashpickup.html" class="source">CashPickup</a></span> ;
<a name="2968"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> TossVel;
<a name="2969"></a>    local <span class="source_type"><a href="../engine/actor.html" class="source">Actor</a></span> <span class="source_type">A</span>;
<a name="2970"></a>
<a name="2971"></a>    if( <span class="source_type">Amount</span>&lt;=<span class="source_int">0</span> )
<a name="2972"></a>        <span class="source_type">Amount</span> = <span class="source_int">50</span>;
<a name="2973"></a>    <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> = <span class="source_type">int</span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span>); <span class="source_comment">// To fix issue with throwing 0 pounds.
</span><a name="2974"></a>    if( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span>&lt;=<span class="source_int">0</span> || <span class="source_type">Amount</span>&lt;=<span class="source_int">0</span> )
<a name="2975"></a>        return;
<a name="2976"></a>    <span class="source_type">Amount</span> = Min(<span class="source_type">Amount</span>,<span class="source_type">int</span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span>));
<a name="2977"></a>
<a name="2978"></a>    GetAxes(<span class="source_type">Rotation</span>,<span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>);
<a name="2979"></a>
<a name="2980"></a>    TossVel = <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span>(GetViewRotation());
<a name="2981"></a>    TossVel = TossVel * ((Velocity Dot TossVel) + <span class="source_int">500</span>) + Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">200</span>);
<a name="2982"></a>
<a name="2983"></a>    <span class="source_type"><a href="../kfmod/cashpickup.html" class="source">CashPickup</a></span> = Spawn(<span class="source_type">class</span><span class="source_name">'CashPickup'</span>,,, Location + <span class="source_int">0.8</span> * CollisionRadius * <span class="source_type">X</span> - <span class="source_int">0.5</span> * CollisionRadius * <span class="source_type">Y</span>);
<a name="2984"></a>
<a name="2985"></a>    if(<span class="source_type"><a href="../kfmod/cashpickup.html" class="source">CashPickup</a></span> != none)
<a name="2986"></a>    {
<a name="2987"></a>        <span class="source_type"><a href="../kfmod/cashpickup.html" class="source">CashPickup</a></span>.CashAmount = <span class="source_type">Amount</span>;
<a name="2988"></a>        <span class="source_type"><a href="../kfmod/cashpickup.html" class="source">CashPickup</a></span>.bDroppedCash = true;
<a name="2989"></a>        <span class="source_type"><a href="../kfmod/cashpickup.html" class="source">CashPickup</a></span>.RespawnTime = <span class="source_int">0</span>;   <span class="source_comment">// Dropped cash doesnt respawn. For obvious reasons.
</span><a name="2990"></a>        <span class="source_type"><a href="../kfmod/cashpickup.html" class="source">CashPickup</a></span>.Velocity = TossVel;
<a name="2991"></a>        <span class="source_type"><a href="../kfmod/cashpickup.html" class="source">CashPickup</a></span>.DroppedBy = <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>;
<a name="2992"></a>        <span class="source_type"><a href="../kfmod/cashpickup.html" class="source">CashPickup</a></span>.InitDroppedPickupFor(None);
<a name="2993"></a>        <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>.<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> -= <span class="source_type">Amount</span>;
<a name="2994"></a>
<a name="2995"></a>        if ( <span class="source_type">Level</span>.Game.NumPlayers &gt; <span class="source_int">1</span> && <span class="source_type">Level</span>.TimeSeconds - LastDropCashMessageTime &gt; DropCashMessageDelay )
<a name="2996"></a>        {
<a name="2997"></a>            <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).Speech(<span class="source_name">'AUTO'</span>, <span class="source_int">4</span>, <span class="source_string">""</span>);
<a name="2998"></a>        }
<a name="2999"></a>
<a name="3000"></a>        <span class="source_comment">// Hack to get Slot machines to accept dosh that's thrown inside their collision cylinder.
</span><a name="3001"></a>        ForEach <span class="source_type"><a href="../kfmod/cashpickup.html" class="source">CashPickup</a></span>.TouchingActors(<span class="source_type">class</span> <span class="source_name">'Actor'</span>, <span class="source_type">A</span>)
<a name="3002"></a>        {
<a name="3003"></a>            if(<span class="source_type">A</span>.IsA(<span class="source_name">'KF_Slot_Machine'</span>))
<a name="3004"></a>            {
<a name="3005"></a>                <span class="source_type">A</span>.Touch(<span class="source_type"><a href="../kfmod/cashpickup.html" class="source">Cashpickup</a></span>);
<a name="3006"></a>            }
<a name="3007"></a>        }
<a name="3008"></a>    }
<a name="3009"></a>}
<a name="3010"></a>
<a name="3011"></a><span class="source_comment">// Used to attach an emitter instead of an xemitter
</span><a name="3012"></a>simulated function AttachEmitterEffect( <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/emitter.html" class="source">Emitter</a></span>&gt; EmitterClass, <span class="source_type">Name</span> BoneName, <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> Location, <span class="source_type"><a href="../core/object.html#Rotator" class="source">Rotator</a></span> <span class="source_type">Rotation</span> )
<a name="3013"></a>{
<a name="3014"></a>    local <span class="source_type"><a href="../engine/actor.html" class="source">Actor</a></span> <span class="source_type">a</span>;
<a name="3015"></a>    local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="3016"></a>
<a name="3017"></a>    if( bSkeletized || (BoneName == <span class="source_name">'None'</span>) )
<a name="3018"></a>        return;
<a name="3019"></a>
<a name="3020"></a>    for( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; Attached.Length; <span class="source_type">i</span>++ )
<a name="3021"></a>    {
<a name="3022"></a>        if( Attached[<span class="source_type">i</span>] == None )
<a name="3023"></a>            continue;
<a name="3024"></a>
<a name="3025"></a>        if( Attached[<span class="source_type">i</span>].AttachmentBone != BoneName )
<a name="3026"></a>            continue;
<a name="3027"></a>
<a name="3028"></a>        if( ClassIsChildOf( EmitterClass, Attached[<span class="source_type">i</span>].<span class="source_type">Class</span> ) )
<a name="3029"></a>            return;
<a name="3030"></a>    }
<a name="3031"></a>
<a name="3032"></a>    <span class="source_type">a</span> = Spawn( EmitterClass,,, Location, <span class="source_type">Rotation</span> );
<a name="3033"></a>
<a name="3034"></a>    if( !AttachToBone( <span class="source_type">a</span>, BoneName ) )
<a name="3035"></a>    {
<a name="3036"></a>        log( <span class="source_string">"Couldn't attach "</span>$EmitterClass$<span class="source_string">" to "</span>$BoneName, <span class="source_name">'Error'</span> );
<a name="3037"></a>        <span class="source_type">a</span>.Destroy();
<a name="3038"></a>        return;
<a name="3039"></a>    }
<a name="3040"></a>
<a name="3041"></a>    for( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; Attached.length; <span class="source_type">i</span>++ )
<a name="3042"></a>    {
<a name="3043"></a>        if( Attached[<span class="source_type">i</span>] == <span class="source_type">a</span> )
<a name="3044"></a>            break;
<a name="3045"></a>    }
<a name="3046"></a>
<a name="3047"></a>    <span class="source_type">a</span>.SetRelativeRotation( <span class="source_type">Rotation</span> );
<a name="3048"></a>}
<a name="3049"></a>
<a name="3050"></a>simulated function RemoveFlamingEffects()
<a name="3051"></a>{
<a name="3052"></a>    local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="3053"></a>
<a name="3054"></a>    if( <span class="source_type">Level</span>.NetMode == NM_DedicatedServer )
<a name="3055"></a>        return;
<a name="3056"></a>
<a name="3057"></a>    for( <span class="source_type">i</span>=<span class="source_int">0</span>; <span class="source_type">i</span>&lt;Attached.length; <span class="source_type">i</span>++ )
<a name="3058"></a>    {
<a name="3059"></a>        if( Attached[<span class="source_type">i</span>].IsA(<span class="source_name">'xEmitter'</span>) && !Attached[<span class="source_type">i</span>].IsA(<span class="source_name">'BloodJet'</span>))
<a name="3060"></a>        {
<a name="3061"></a>            <span class="source_type"><a href="../engine/xemitter.html" class="source">xEmitter</a></span>(Attached[<span class="source_type">i</span>]).mRegen = false;
<a name="3062"></a>        }
<a name="3063"></a>
<a name="3064"></a>         if( Attached[<span class="source_type">i</span>].IsA(<span class="source_name">'KFMonsterFlame'</span>))
<a name="3065"></a>        {
<a name="3066"></a>          Attached[<span class="source_type">i</span>].LifeSpan = <span class="source_int">0.1</span>;
<a name="3067"></a>        }
<a name="3068"></a>    }
<a name="3069"></a>}
<a name="3070"></a>
<a name="3071"></a>simulated function <span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/kfveterancytypes.html" class="source">KFVeterancyTypes</a></span>&gt; GetVeteran()
<a name="3072"></a>{
<a name="3073"></a>    if( <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>) != none && <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill != none )
<a name="3074"></a>    {
<a name="3075"></a>        return <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill;
<a name="3076"></a>    }
<a name="3077"></a>
<a name="3078"></a>    return <span class="source_type">class</span><span class="source_name">'KFVeterancyTypes'</span>; <span class="source_comment">// The base neutral class.
</span><a name="3079"></a>}
<a name="3080"></a>
<a name="3081"></a>function <span class="source_type">bool</span> CanCarry( <span class="source_type">float</span> <span class="source_type">Weight</span> )
<a name="3082"></a>{
<a name="3083"></a>    Return True;
<a name="3084"></a>}
<a name="3085"></a>
<a name="3086"></a><span class="source_comment">// Validate that client is not hacking.
</span><a name="3087"></a>function <span class="source_type">bool</span> CanBuyNow()
<a name="3088"></a>{
<a name="3089"></a>    local <span class="source_type"><a href="../kfmod/shopvolume.html" class="source">ShopVolume</a></span> <span class="source_type">Sh</span>;
<a name="3090"></a>
<a name="3091"></a>    if( <span class="source_type"><a href="../kfmod/kfgametype.html" class="source">KFGameType</a></span>(<span class="source_type">Level</span>.Game)==None || <span class="source_type"><a href="../kfmod/kfgametype.html" class="source">KFGameType</a></span>(<span class="source_type">Level</span>.Game).bWaveInProgress || <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>==None )
<a name="3092"></a>        return False;
<a name="3093"></a>    foreach TouchingActors(<span class="source_type">Class</span><span class="source_name">'ShopVolume'</span>,<span class="source_type">Sh</span>)
<a name="3094"></a>        Return True;
<a name="3095"></a>    Return False;
<a name="3096"></a>}
<a name="3097"></a>
<a name="3098"></a>function <span class="source_type">bool</span> ItemIsBuyable( <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../engine/pickup.html" class="source">Pickup</a></span>&gt; <span class="source_type">IC</span> )
<a name="3099"></a>{
<a name="3100"></a>    local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="3101"></a>
<a name="3102"></a>    if( LevRls==None )
<a name="3103"></a>    {
<a name="3104"></a>        ForEach DynamicActors(<span class="source_type">Class</span><span class="source_name">'KFLevelRules'</span>,LevRls)
<a name="3105"></a>            Break;
<a name="3106"></a>        if( LevRls==None )
<a name="3107"></a>            Return False;
<a name="3108"></a>    }
<a name="3109"></a>
<a name="3110"></a>    For( <span class="source_type">i</span>=<span class="source_int">0</span>; <span class="source_type">i</span>&lt;<span class="source_int">25</span>; <span class="source_type">i</span>++ )
<a name="3111"></a>    {
<a name="3112"></a>        if( LevRls.ItemForSale[<span class="source_type">i</span>]==<span class="source_type">IC</span> )
<a name="3113"></a>            Return True;
<a name="3114"></a>    }
<a name="3115"></a>
<a name="3116"></a>    Return False;
<a name="3117"></a>}
<a name="3118"></a>
<a name="3119"></a>simulated function ClientCurrentWeaponSold()
<a name="3120"></a>{
<a name="3121"></a>    local <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> <span class="source_type">I</span>;
<a name="3122"></a>    local <span class="source_type">int</span> Count;
<a name="3123"></a>
<a name="3124"></a>    for ( <span class="source_type">I</span> = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; <span class="source_type">I</span> != none && Count &lt; <span class="source_int">50</span>; <span class="source_type">I</span> = <span class="source_type">I</span>.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>)
<a name="3125"></a>    {
<a name="3126"></a>        if ( <span class="source_type">I</span> != <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> && <span class="source_type">I</span> != PendingWeapon && <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>(<span class="source_type">I</span>) != none )
<a name="3127"></a>        {
<a name="3128"></a>            PendingWeapon = <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>(<span class="source_type">I</span>);
<a name="3129"></a>            break;
<a name="3130"></a>        }
<a name="3131"></a>
<a name="3132"></a>        Count++;
<a name="3133"></a>    }
<a name="3134"></a>
<a name="3135"></a>    ChangedWeapon();
<a name="3136"></a>}
<a name="3137"></a>
<a name="3138"></a>simulated function ClientForceChangeWeapon(<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> NewWeapon)
<a name="3139"></a>{
<a name="3140"></a>    PendingWeapon = <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>(NewWeapon);
<a name="3141"></a>    ChangedWeapon();
<a name="3142"></a>}
<a name="3143"></a>
<a name="3144"></a>function ServerBuyPotato()
<a name="3145"></a>{
<a name="3146"></a>    local <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> <span class="source_type">C</span>;
<a name="3147"></a>
<a name="3148"></a>    for ( <span class="source_type">C</span> = <span class="source_type">Level</span>.ControllerList; <span class="source_type">C</span> != none; <span class="source_type">C</span> = <span class="source_type">C</span>.NextController )
<a name="3149"></a>    {
<a name="3150"></a>        if ( <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type">C</span>) != none && <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type">C</span>).SteamStatsAndAchievements != none )
<a name="3151"></a>        {
<a name="3152"></a>            <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type">C</span>).SteamStatsAndAchievements.SetSteamAchievementCompleted(<span class="source_int">132</span>);
<a name="3153"></a>        }
<a name="3154"></a>    }
<a name="3155"></a>
<a name="3156"></a>    <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> -= <span class="source_int">70000</span>;
<a name="3157"></a>}
<a name="3158"></a>
<a name="3159"></a>function ServerBuyWeapon( <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>&gt; <span class="source_type">WClass</span>, <span class="source_type">float</span> <span class="source_type">ItemWeight</span> )
<a name="3160"></a>{
<a name="3161"></a>    local <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> <span class="source_type">I</span>, J;
<a name="3162"></a>    local <span class="source_type">float</span> Price;
<a name="3163"></a>    local <span class="source_type">bool</span> bIsDualWeapon, bHasDual9mms, bHasDualHCs, bHasDualRevolvers;
<a name="3164"></a>
<a name="3165"></a>    if ( !CanBuyNow() || <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>&gt;(<span class="source_type">WClass</span>) == none || <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/kfweaponpickup.html" class="source">KFWeaponPickup</a></span>&gt;(<span class="source_type">WClass</span>.Default.PickupClass) == none )
<a name="3166"></a>    {
<a name="3167"></a>        return;
<a name="3168"></a>    }
<a name="3169"></a>
<a name="3170"></a>    if ( <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>&gt;(<span class="source_type">WClass</span>).Default.AppID &gt; <span class="source_int">0</span> && <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>&gt;(<span class="source_type">WClass</span>).Default.UnlockedByAchievement != -<span class="source_int">1</span> )
<a name="3171"></a>    {
<a name="3172"></a>
<a name="3173"></a>        if ( <span class="source_type"><a href="../roengine/kfsteamstatsandachievements.html" class="source">KFSteamStatsAndAchievements</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.SteamStatsAndAchievements) == none ||
<a name="3174"></a>            (!<span class="source_type"><a href="../roengine/kfsteamstatsandachievements.html" class="source">KFSteamStatsAndAchievements</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.SteamStatsAndAchievements).PlayerOwnsWeaponDLC(<span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>&gt;(<span class="source_type">WClass</span>).Default.AppID) &&
<a name="3175"></a>             <span class="source_type"><a href="../roengine/kfsteamstatsandachievements.html" class="source">KFSteamStatsAndAchievements</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.SteamStatsAndAchievements).Achievements[<span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>&gt;(<span class="source_type">WClass</span>).Default.UnlockedByAchievement].bCompleted != <span class="source_int">1</span> ))
<a name="3176"></a>        {
<a name="3177"></a>            return;
<a name="3178"></a>        }
<a name="3179"></a>
<a name="3180"></a>    }
<a name="3181"></a>    else if ( <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>&gt;(<span class="source_type">WClass</span>).Default.AppID &gt; <span class="source_int">0</span> )
<a name="3182"></a>    {
<a name="3183"></a>        if ( <span class="source_type"><a href="../roengine/kfsteamstatsandachievements.html" class="source">KFSteamStatsAndAchievements</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.SteamStatsAndAchievements) == none ||
<a name="3184"></a>            !<span class="source_type"><a href="../roengine/kfsteamstatsandachievements.html" class="source">KFSteamStatsAndAchievements</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.SteamStatsAndAchievements).PlayerOwnsWeaponDLC(<span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>&gt;(<span class="source_type">WClass</span>).Default.AppID))
<a name="3185"></a>        {
<a name="3186"></a>            return;
<a name="3187"></a>        }
<a name="3188"></a>    }
<a name="3189"></a>    else if ( <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>&gt;(<span class="source_type">WClass</span>).Default.UnlockedByAchievement != -<span class="source_int">1</span>  )
<a name="3190"></a>    {
<a name="3191"></a>        if ( <span class="source_type"><a href="../roengine/kfsteamstatsandachievements.html" class="source">KFSteamStatsAndAchievements</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.SteamStatsAndAchievements) == none ||
<a name="3192"></a>             <span class="source_type"><a href="../roengine/kfsteamstatsandachievements.html" class="source">KFSteamStatsAndAchievements</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.SteamStatsAndAchievements).Achievements[<span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>&gt;(<span class="source_type">WClass</span>).Default.UnlockedByAchievement].bCompleted != <span class="source_int">1</span> )
<a name="3193"></a>        {
<a name="3194"></a>            return;
<a name="3195"></a>        }
<a name="3196"></a>    }
<a name="3197"></a>
<a name="3198"></a>    Price = <span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/kfweaponpickup.html" class="source">KFWeaponPickup</a></span>&gt;(<span class="source_type">WClass</span>.Default.PickupClass).Default.Cost;
<a name="3199"></a>
<a name="3200"></a>    if ( <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill != none )
<a name="3201"></a>    {
<a name="3202"></a>        Price *= <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill.static.GetCostScaling(<span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>), <span class="source_type">WClass</span>.Default.PickupClass);
<a name="3203"></a>    }
<a name="3204"></a>
<a name="3205"></a>    for ( <span class="source_type">I</span>=<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; <span class="source_type">I</span>!=None; <span class="source_type">I</span>=<span class="source_type">I</span>.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="3206"></a>    {
<a name="3207"></a>        if( <span class="source_type">I</span>.<span class="source_type">Class</span>==<span class="source_type">WClass</span> )
<a name="3208"></a>        {
<a name="3209"></a>            Return; <span class="source_comment">// Already has weapon.
</span><a name="3210"></a>        }
<a name="3211"></a>
<a name="3212"></a>        if ( <span class="source_type">I</span>.<span class="source_type">Class</span> == <span class="source_type">class</span><span class="source_name">'Dualies'</span> )
<a name="3213"></a>        {
<a name="3214"></a>            bHasDual9mms = true;
<a name="3215"></a>        }
<a name="3216"></a>        else if ( <span class="source_type">I</span>.<span class="source_type">Class</span> == <span class="source_type">class</span><span class="source_name">'DualDeagle'</span> || <span class="source_type">I</span>.<span class="source_type">Class</span> == <span class="source_type">class</span><span class="source_name">'GoldenDualDeagle'</span> )
<a name="3217"></a>        {
<a name="3218"></a>            bHasDualHCs = true;
<a name="3219"></a>        }
<a name="3220"></a>        else if ( <span class="source_type">I</span>.<span class="source_type">Class</span> == <span class="source_type">class</span><span class="source_name">'Dual44Magnum'</span> )
<a name="3221"></a>        {
<a name="3222"></a>            bHasDualRevolvers = true;
<a name="3223"></a>        }
<a name="3224"></a>    }
<a name="3225"></a>
<a name="3226"></a>    if ( <span class="source_type">WClass</span> == <span class="source_type">class</span><span class="source_name">'DualDeagle'</span> )
<a name="3227"></a>    {
<a name="3228"></a>        for ( J = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; J != None; J = J.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="3229"></a>        {
<a name="3230"></a>            if ( J.<span class="source_type">class</span> == <span class="source_type">class</span><span class="source_name">'Deagle'</span> )
<a name="3231"></a>            {
<a name="3232"></a>                Price = Price / <span class="source_int">2</span>;
<a name="3233"></a>                break;
<a name="3234"></a>            }
<a name="3235"></a>        }
<a name="3236"></a>
<a name="3237"></a>        bIsDualWeapon = true;
<a name="3238"></a>        bHasDualHCs = true;
<a name="3239"></a>    }
<a name="3240"></a>
<a name="3241"></a>    if ( <span class="source_type">WClass</span> == <span class="source_type">class</span><span class="source_name">'GoldenDualDeagle'</span> )
<a name="3242"></a>    {
<a name="3243"></a>        for ( J = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; J != None; J = J.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="3244"></a>        {
<a name="3245"></a>            if ( J.<span class="source_type">class</span> == <span class="source_type">class</span><span class="source_name">'GoldenDeagle'</span> )
<a name="3246"></a>            {
<a name="3247"></a>                Price = Price / <span class="source_int">2</span>;
<a name="3248"></a>                break;
<a name="3249"></a>            }
<a name="3250"></a>        }
<a name="3251"></a>
<a name="3252"></a>        bIsDualWeapon = true;
<a name="3253"></a>        bHasDualHCs = true;
<a name="3254"></a>    }
<a name="3255"></a>
<a name="3256"></a>    if ( <span class="source_type">WClass</span> == <span class="source_type">class</span><span class="source_name">'Dual44Magnum'</span> )
<a name="3257"></a>    {
<a name="3258"></a>        for ( J = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; J != None; J = J.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="3259"></a>        {
<a name="3260"></a>            if ( J.<span class="source_type">class</span> == <span class="source_type">class</span><span class="source_name">'Magnum44Pistol'</span> )
<a name="3261"></a>            {
<a name="3262"></a>                Price = Price / <span class="source_int">2</span>;
<a name="3263"></a>                break;
<a name="3264"></a>            }
<a name="3265"></a>        }
<a name="3266"></a>
<a name="3267"></a>        bIsDualWeapon = true;
<a name="3268"></a>        bHasDualRevolvers = true;
<a name="3269"></a>    }
<a name="3270"></a>
<a name="3271"></a>    if ( <span class="source_type">WClass</span> == <span class="source_type">class</span><span class="source_name">'DualMK23Pistol'</span> )
<a name="3272"></a>    {
<a name="3273"></a>        for ( J = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; J != None; J = J.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="3274"></a>        {
<a name="3275"></a>            if ( J.<span class="source_type">class</span> == <span class="source_type">class</span><span class="source_name">'MK23Pistol'</span> )
<a name="3276"></a>            {
<a name="3277"></a>                Price = Price / <span class="source_int">2</span>;
<a name="3278"></a>                break;
<a name="3279"></a>            }
<a name="3280"></a>        }
<a name="3281"></a>
<a name="3282"></a>        bIsDualWeapon = true;
<a name="3283"></a>    }
<a name="3284"></a>
<a name="3285"></a>    if ( <span class="source_type">WClass</span> == <span class="source_type">class</span><span class="source_name">'DualFlareRevolver'</span> )
<a name="3286"></a>    {
<a name="3287"></a>        for ( J = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; J != None; J = J.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="3288"></a>        {
<a name="3289"></a>            if ( J.<span class="source_type">class</span> == <span class="source_type">class</span><span class="source_name">'FlareRevolver'</span> )
<a name="3290"></a>            {
<a name="3291"></a>                Price = Price / <span class="source_int">2</span>;
<a name="3292"></a>                break;
<a name="3293"></a>            }
<a name="3294"></a>        }
<a name="3295"></a>
<a name="3296"></a>        bIsDualWeapon = true;
<a name="3297"></a>    }
<a name="3298"></a>
<a name="3299"></a>    bIsDualWeapon = bIsDualWeapon || <span class="source_type">WClass</span> == <span class="source_type">class</span><span class="source_name">'Dualies'</span>;
<a name="3300"></a>
<a name="3301"></a>    if ( !CanCarry(<span class="source_type">ItemWeight</span>) )
<a name="3302"></a>    {
<a name="3303"></a>        Return;
<a name="3304"></a>    }
<a name="3305"></a>
<a name="3306"></a>    if ( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> &lt; Price )
<a name="3307"></a>    {
<a name="3308"></a>        Return; <span class="source_comment">// Not enough CASH.
</span><a name="3309"></a>    }
<a name="3310"></a>
<a name="3311"></a>    <span class="source_type">I</span> = Spawn(<span class="source_type">WClass</span>);
<a name="3312"></a>
<a name="3313"></a>    if ( <span class="source_type">I</span> != none )
<a name="3314"></a>    {
<a name="3315"></a>        if ( <span class="source_type"><a href="../kfmod/kfgametype.html" class="source">KFGameType</a></span>(<span class="source_type">Level</span>.Game) != none )
<a name="3316"></a>        {
<a name="3317"></a>            <span class="source_type"><a href="../kfmod/kfgametype.html" class="source">KFGameType</a></span>(<span class="source_type">Level</span>.Game).WeaponSpawned(<span class="source_type">I</span>);
<a name="3318"></a>        }
<a name="3319"></a>
<a name="3320"></a>        <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type">I</span>).UpdateMagCapacity(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>);
<a name="3321"></a>        <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type">I</span>).FillToInitialAmmo();
<a name="3322"></a>        <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type">I</span>).SellValue = Price * <span class="source_int">0.75</span>;
<a name="3323"></a>        <span class="source_type">I</span>.GiveTo(self);
<a name="3324"></a>        <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> -= Price;
<a name="3325"></a>
<a name="3326"></a>        if ( bIsDualWeapon )
<a name="3327"></a>        {
<a name="3328"></a>            <span class="source_type"><a href="../roengine/kfsteamstatsandachievements.html" class="source">KFSteamStatsAndAchievements</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.SteamStatsAndAchievements).OnDualsAddedToInventory(bHasDual9mms, bHasDualHCs, bHasDualRevolvers);
<a name="3329"></a>        }
<a name="3330"></a>
<a name="3331"></a>        ClientForceChangeWeapon(<span class="source_type">I</span>);
<a name="3332"></a>    }
<a name="3333"></a>
<a name="3334"></a>    SetTraderUpdate();
<a name="3335"></a>}
<a name="3336"></a>
<a name="3337"></a>function ServerSellWeapon( <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>&gt; <span class="source_type">WClass</span> )
<a name="3338"></a>{
<a name="3339"></a>    local <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> <span class="source_type">I</span>;
<a name="3340"></a>    local <span class="source_type"><a href="../kfmod/single.html" class="source">Single</a></span> NewSingle;
<a name="3341"></a>    local <span class="source_type"><a href="../kfmod/deagle.html" class="source">Deagle</a></span> NewDeagle;
<a name="3342"></a>    local <span class="source_type"><a href="../kfmod/magnum44pistol.html" class="source">Magnum44Pistol</a></span> New44Magnum;
<a name="3343"></a>    local <span class="source_type"><a href="../kfmod/mk23pistol.html" class="source">MK23Pistol</a></span> NewMK23;
<a name="3344"></a>    local <span class="source_type"><a href="../kfmod/flarerevolver.html" class="source">FlareRevolver</a></span> NewFlare;
<a name="3345"></a>    local <span class="source_type">float</span> Price;
<a name="3346"></a>
<a name="3347"></a>    if ( !CanBuyNow() || <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>&gt;(<span class="source_type">WClass</span>) == none || <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/kfweaponpickup.html" class="source">KFWeaponPickup</a></span>&gt;(<span class="source_type">WClass</span>.Default.PickupClass) == none )
<a name="3348"></a>    {
<a name="3349"></a>        SetTraderUpdate();
<a name="3350"></a>        Return;
<a name="3351"></a>    }
<a name="3352"></a>
<a name="3353"></a>    for ( <span class="source_type">I</span> = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; <span class="source_type">I</span> != none; <span class="source_type">I</span> = <span class="source_type">I</span>.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="3354"></a>    {
<a name="3355"></a>        if ( <span class="source_type">I</span>.<span class="source_type">Class</span> == <span class="source_type">WClass</span> )
<a name="3356"></a>        {
<a name="3357"></a>            if ( <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type">I</span>) != none && <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type">I</span>).SellValue != -<span class="source_int">1</span> )
<a name="3358"></a>            {
<a name="3359"></a>                Price = <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type">I</span>).SellValue;
<a name="3360"></a>            }
<a name="3361"></a>            else
<a name="3362"></a>            {
<a name="3363"></a>                Price = <span class="source_type">int</span>(<span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/kfweaponpickup.html" class="source">KFWeaponPickup</a></span>&gt;(<span class="source_type">WClass</span>.default.PickupClass).default.Cost * <span class="source_int">0.75</span>);
<a name="3364"></a>
<a name="3365"></a>                if ( <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill != none )
<a name="3366"></a>                {
<a name="3367"></a>                    Price *= <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill.static.GetCostScaling(<span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>), <span class="source_type">WClass</span>.Default.PickupClass);
<a name="3368"></a>                }
<a name="3369"></a>            }
<a name="3370"></a>
<a name="3371"></a>            if ( <span class="source_type"><a href="../kfmod/dualies.html" class="source">Dualies</a></span>(<span class="source_type">I</span>) != none && <span class="source_type"><a href="../kfmod/dualdeagle.html" class="source">DualDeagle</a></span>(<span class="source_type">I</span>) == none && <span class="source_type"><a href="../kfmod/dual44magnum.html" class="source">Dual44Magnum</a></span>(<span class="source_type">I</span>) == none
<a name="3372"></a>                && <span class="source_type"><a href="../kfmod/dualmk23pistol.html" class="source">DualMK23Pistol</a></span>(<span class="source_type">I</span>) == none && <span class="source_type"><a href="../kfmod/dualflarerevolver.html" class="source">DualFlareRevolver</a></span>(<span class="source_type">I</span>) == none )
<a name="3373"></a>            {
<a name="3374"></a>                NewSingle = Spawn(<span class="source_type">class</span><span class="source_name">'Single'</span>);
<a name="3375"></a>                NewSingle.GiveTo(self);
<a name="3376"></a>            }
<a name="3377"></a>
<a name="3378"></a>            if ( <span class="source_type"><a href="../kfmod/dualdeagle.html" class="source">DualDeagle</a></span>(<span class="source_type">I</span>) != none )
<a name="3379"></a>            {
<a name="3380"></a>                if( <span class="source_type"><a href="../kfmod/goldendualdeagle.html" class="source">GoldenDualDeagle</a></span>(<span class="source_type">I</span>) != none )
<a name="3381"></a>                {
<a name="3382"></a>                    NewDeagle = Spawn(<span class="source_type">class</span><span class="source_name">'GoldenDeagle'</span>);
<a name="3383"></a>                }
<a name="3384"></a>                else
<a name="3385"></a>                {
<a name="3386"></a>                    NewDeagle = Spawn(<span class="source_type">class</span><span class="source_name">'Deagle'</span>);
<a name="3387"></a>                }
<a name="3388"></a>                NewDeagle.GiveTo(self);
<a name="3389"></a>                Price = Price / <span class="source_int">2</span>;
<a name="3390"></a>                NewDeagle.SellValue = Price;
<a name="3391"></a>            }
<a name="3392"></a>
<a name="3393"></a>            if ( <span class="source_type"><a href="../kfmod/dual44magnum.html" class="source">Dual44Magnum</a></span>(<span class="source_type">I</span>) != none )
<a name="3394"></a>            {
<a name="3395"></a>                New44Magnum = Spawn(<span class="source_type">class</span><span class="source_name">'Magnum44Pistol'</span>);
<a name="3396"></a>                New44Magnum.GiveTo(self);
<a name="3397"></a>                Price = Price / <span class="source_int">2</span>;
<a name="3398"></a>                New44Magnum.SellValue = Price;
<a name="3399"></a>            }
<a name="3400"></a>
<a name="3401"></a>            if ( <span class="source_type"><a href="../kfmod/dualmk23pistol.html" class="source">DualMK23Pistol</a></span>(<span class="source_type">I</span>) != none )
<a name="3402"></a>            {
<a name="3403"></a>                NewMK23 = Spawn(<span class="source_type">class</span><span class="source_name">'MK23Pistol'</span>);
<a name="3404"></a>                NewMK23.GiveTo(self);
<a name="3405"></a>                Price = Price / <span class="source_int">2</span>;
<a name="3406"></a>                NewMK23.SellValue = Price;
<a name="3407"></a>            }
<a name="3408"></a>
<a name="3409"></a>            if ( <span class="source_type"><a href="../kfmod/dualflarerevolver.html" class="source">DualFlareRevolver</a></span>(<span class="source_type">I</span>) != none )
<a name="3410"></a>            {
<a name="3411"></a>                NewFlare = Spawn(<span class="source_type">class</span><span class="source_name">'FlareRevolver'</span>);
<a name="3412"></a>                NewFlare.GiveTo(self);
<a name="3413"></a>                Price = Price / <span class="source_int">2</span>;
<a name="3414"></a>                NewFlare.SellValue = Price;
<a name="3415"></a>            }
<a name="3416"></a>
<a name="3417"></a>            if ( <span class="source_type">I</span> == <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> || <span class="source_type">I</span> == PendingWeapon )
<a name="3418"></a>            {
<a name="3419"></a>                ClientCurrentWeaponSold();
<a name="3420"></a>            }
<a name="3421"></a>
<a name="3422"></a>            <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> += Price;
<a name="3423"></a>
<a name="3424"></a>            <span class="source_type">I</span>.Destroyed();
<a name="3425"></a>            <span class="source_type">I</span>.Destroy();
<a name="3426"></a>
<a name="3427"></a>            SetTraderUpdate();
<a name="3428"></a>
<a name="3429"></a>            if ( <span class="source_type"><a href="../kfmod/kfgametype.html" class="source">KFGameType</a></span>(<span class="source_type">Level</span>.Game) != none )
<a name="3430"></a>            {
<a name="3431"></a>                <span class="source_type"><a href="../kfmod/kfgametype.html" class="source">KFGameType</a></span>(<span class="source_type">Level</span>.Game).WeaponDestroyed(<span class="source_type">WClass</span>);
<a name="3432"></a>            }
<a name="3433"></a>
<a name="3434"></a>            return;
<a name="3435"></a>        }
<a name="3436"></a>    }
<a name="3437"></a>}
<a name="3438"></a>
<a name="3439"></a>function ServerBuyKevlar()
<a name="3440"></a>{
<a name="3441"></a>    local <span class="source_type">float</span> Cost;
<a name="3442"></a>    local <span class="source_type">int</span> UnitsAffordable;
<a name="3443"></a>
<a name="3444"></a>    Cost = <span class="source_type">class</span><span class="source_name">'Vest'</span>.default.ItemCost * ((<span class="source_int">100.0</span> - ShieldStrength) / <span class="source_int">100.0</span>);
<a name="3445"></a>
<a name="3446"></a>    if ( <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill != none)
<a name="3447"></a>    {
<a name="3448"></a>        Cost *= <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill.static.GetCostScaling(<span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>), <span class="source_type">class</span><span class="source_name">'Vest'</span>);
<a name="3449"></a>    }
<a name="3450"></a>
<a name="3451"></a>    if ( !CanBuyNow() || ShieldStrength==<span class="source_int">100</span> )
<a name="3452"></a>    {
<a name="3453"></a>        SetTraderUpdate();
<a name="3454"></a>        Return;
<a name="3455"></a>    }
<a name="3456"></a>
<a name="3457"></a>    if ( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> &gt;= Cost )
<a name="3458"></a>    {
<a name="3459"></a>        <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> -= Cost;
<a name="3460"></a>        ShieldStrength = <span class="source_int">100</span>;
<a name="3461"></a>    }
<a name="3462"></a>    else if ( ShieldStrength &gt; <span class="source_int">0</span> )
<a name="3463"></a>    {
<a name="3464"></a>        Cost = <span class="source_type">class</span><span class="source_name">'Vest'</span>.default.ItemCost;
<a name="3465"></a>        if ( <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill != none)
<a name="3466"></a>        {
<a name="3467"></a>            Cost *= <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill.static.GetCostScaling(<span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>), <span class="source_type">class</span><span class="source_name">'Vest'</span>);
<a name="3468"></a>        }
<a name="3469"></a>
<a name="3470"></a>        Cost /= <span class="source_int">100.0</span>;
<a name="3471"></a>
<a name="3472"></a>        UnitsAffordable = <span class="source_type">int</span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> / Cost);
<a name="3473"></a>
<a name="3474"></a>        <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> -= <span class="source_type">int</span>(Cost * UnitsAffordable);
<a name="3475"></a>
<a name="3476"></a>        ShieldStrength += UnitsAffordable;
<a name="3477"></a>    }
<a name="3478"></a>
<a name="3479"></a>    SetTraderUpdate();
<a name="3480"></a>}
<a name="3481"></a>
<a name="3482"></a>function ServerBuyFirstAid()
<a name="3483"></a>{
<a name="3484"></a>    local <span class="source_type">int</span> Cost;
<a name="3485"></a>
<a name="3486"></a>    Cost = <span class="source_type">class</span><span class="source_name">'FirstAidKit'</span>.default.ItemCost;
<a name="3487"></a>
<a name="3488"></a>    if( !CanBuyNow() || Health==<span class="source_int">100</span> )
<a name="3489"></a>    {
<a name="3490"></a>        SetTraderUpdate();
<a name="3491"></a>        Return;
<a name="3492"></a>    }
<a name="3493"></a>
<a name="3494"></a>    if( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> &lt; Cost )
<a name="3495"></a>    {
<a name="3496"></a>        SetTraderUpdate();
<a name="3497"></a>        Return;
<a name="3498"></a>    }
<a name="3499"></a>
<a name="3500"></a>    <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> -= Cost;
<a name="3501"></a>    GiveHealth(<span class="source_int">100</span>, <span class="source_int">100</span>);
<a name="3502"></a>
<a name="3503"></a>    SetTraderUpdate();
<a name="3504"></a>}
<a name="3505"></a>
<a name="3506"></a>function <span class="source_type">bool</span> ServerBuyAmmo( <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../engine/ammunition.html" class="source">Ammunition</a></span>&gt; <span class="source_type">AClass</span>, <span class="source_type">bool</span> <span class="source_type">bOnlyClip</span> )
<a name="3507"></a>{
<a name="3508"></a>    local <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> <span class="source_type">I</span>;
<a name="3509"></a>    local <span class="source_type">float</span> Price;
<a name="3510"></a>    local <span class="source_type"><a href="../engine/ammunition.html" class="source">Ammunition</a></span> AM;
<a name="3511"></a>    local <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span> KW;
<a name="3512"></a>    local <span class="source_type">int</span> <span class="source_type">c</span>;
<a name="3513"></a>    local <span class="source_type">float</span> UsedMagCapacity;
<a name="3514"></a>    local <span class="source_type"><a href="../kfmod/boomstick.html" class="source">Boomstick</a></span> DBShotty;
<a name="3515"></a>
<a name="3516"></a>    if ( !CanBuyNow() || <span class="source_type">AClass</span> == None )
<a name="3517"></a>    {
<a name="3518"></a>        SetTraderUpdate();
<a name="3519"></a>        return false;
<a name="3520"></a>    }
<a name="3521"></a>
<a name="3522"></a>    for ( <span class="source_type">I</span>=<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; <span class="source_type">I</span> != none; <span class="source_type">I</span>=<span class="source_type">I</span>.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="3523"></a>    {
<a name="3524"></a>        if ( <span class="source_type">I</span>.<span class="source_type">Class</span> == <span class="source_type">AClass</span> )
<a name="3525"></a>        {
<a name="3526"></a>            AM = <span class="source_type"><a href="../engine/ammunition.html" class="source">Ammunition</a></span>(<span class="source_type">I</span>);
<a name="3527"></a>        }
<a name="3528"></a>        else if ( KW == None && <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type">I</span>) != None && (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>(<span class="source_type">I</span>).AmmoClass[<span class="source_int">0</span>] == <span class="source_type">AClass</span> || <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>(<span class="source_type">I</span>).AmmoClass[<span class="source_int">1</span>] == <span class="source_type">AClass</span>) )
<a name="3529"></a>        {
<a name="3530"></a>            KW = <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type">I</span>);
<a name="3531"></a>        }
<a name="3532"></a>    }
<a name="3533"></a>
<a name="3534"></a>    if ( KW == none || AM == none )
<a name="3535"></a>    {
<a name="3536"></a>        SetTraderUpdate();
<a name="3537"></a>        return false;
<a name="3538"></a>    }
<a name="3539"></a>
<a name="3540"></a>    DBShotty = <span class="source_type"><a href="../kfmod/boomstick.html" class="source">Boomstick</a></span>(KW);
<a name="3541"></a>
<a name="3542"></a>    AM.MaxAmmo = AM.default.MaxAmmo;
<a name="3543"></a>
<a name="3544"></a>    if ( <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>) != none && <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill != none )
<a name="3545"></a>    {
<a name="3546"></a>        AM.MaxAmmo = <span class="source_type">int</span>(<span class="source_type">float</span>(AM.MaxAmmo) * <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill.static.AddExtraAmmoFor(<span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>), <span class="source_type">AClass</span>));
<a name="3547"></a>    }
<a name="3548"></a>
<a name="3549"></a>    if ( AM.AmmoAmount &gt;= AM.MaxAmmo )
<a name="3550"></a>    {
<a name="3551"></a>        SetTraderUpdate();
<a name="3552"></a>        return false;
<a name="3553"></a>    }
<a name="3554"></a>
<a name="3555"></a>    Price = <span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/kfweaponpickup.html" class="source">KFWeaponPickup</a></span>&gt;(KW.PickupClass).default.AmmoCost * <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill.static.GetAmmoCostScaling(<span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>), KW.PickupClass); <span class="source_comment">// Clip price.
</span><a name="3556"></a>
<a name="3557"></a>    if ( KW.bHasSecondaryAmmo && <span class="source_type">AClass</span> == KW.FireModeClass[<span class="source_int">1</span>].default.AmmoClass )
<a name="3558"></a>    {
<a name="3559"></a>        UsedMagCapacity = <span class="source_int">1</span>; <span class="source_comment">// Secondary Mags always have a Mag Capacity of 1? KW.default.SecondaryMagCapacity;
</span><a name="3560"></a>    }
<a name="3561"></a>    else
<a name="3562"></a>    {
<a name="3563"></a>        UsedMagCapacity = KW.default.MagCapacity;
<a name="3564"></a>    }
<a name="3565"></a>
<a name="3566"></a>    if( KW.PickupClass == <span class="source_type">class</span><span class="source_name">'HuskGunPickup'</span> )
<a name="3567"></a>    {
<a name="3568"></a>        UsedMagCapacity = <span class="source_type">class</span>&lt;<span class="source_type"><a href="../kfmod/huskgunpickup.html" class="source">HuskGunPickup</a></span>&gt;(KW.PickupClass).default.BuyClipSize;
<a name="3569"></a>    }
<a name="3570"></a>
<a name="3571"></a>    if ( <span class="source_type">bOnlyClip</span> )
<a name="3572"></a>    {
<a name="3573"></a>        if ( <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>) != none && <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill != none )
<a name="3574"></a>        {
<a name="3575"></a>            if( KW.PickupClass == <span class="source_type">class</span><span class="source_name">'HuskGunPickup'</span> )
<a name="3576"></a>            {
<a name="3577"></a>                <span class="source_type">c</span> = UsedMagCapacity * <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill.static.AddExtraAmmoFor(<span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>), AM.<span class="source_type">Class</span>);
<a name="3578"></a>            }
<a name="3579"></a>            else
<a name="3580"></a>            {
<a name="3581"></a>                <span class="source_type">c</span> = UsedMagCapacity * <span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>).ClientVeteranSkill.static.GetMagCapacityMod(<span class="source_type"><a href="../kfmod/kfplayerreplicationinfo.html" class="source">KFPlayerReplicationInfo</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>), KW);
<a name="3582"></a>            }
<a name="3583"></a>        }
<a name="3584"></a>        else
<a name="3585"></a>        {
<a name="3586"></a>            <span class="source_type">c</span> = UsedMagCapacity;
<a name="3587"></a>        }
<a name="3588"></a>    }
<a name="3589"></a>    else
<a name="3590"></a>    {
<a name="3591"></a>        <span class="source_type">c</span> = (AM.MaxAmmo-AM.AmmoAmount);
<a name="3592"></a>    }
<a name="3593"></a>
<a name="3594"></a>    Price = <span class="source_type">int</span>(<span class="source_type">float</span>(<span class="source_type">c</span>) / UsedMagCapacity * Price);
<a name="3595"></a>
<a name="3596"></a>    if ( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> &lt; Price ) <span class="source_comment">// Not enough CASH (so buy the amount you CAN buy).
</span><a name="3597"></a>    {
<a name="3598"></a>        <span class="source_type">c</span> *= (<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span>/Price);
<a name="3599"></a>
<a name="3600"></a>        if ( <span class="source_type">c</span> == <span class="source_int">0</span> )
<a name="3601"></a>        {
<a name="3602"></a>            SetTraderUpdate();
<a name="3603"></a>            return false; <span class="source_comment">// Couldn't even afford 1 bullet.
</span><a name="3604"></a>        }
<a name="3605"></a>
<a name="3606"></a>        AM.AddAmmo(<span class="source_type">c</span>);
<a name="3607"></a>        if( DBShotty != none )
<a name="3608"></a>        {
<a name="3609"></a>            DBShotty.AmmoPickedUp();
<a name="3610"></a>        }
<a name="3611"></a>
<a name="3612"></a>        <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> = <span class="source_type">Max</span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> - (<span class="source_type">float</span>(<span class="source_type">c</span>) / UsedMagCapacity * Price), <span class="source_int">0</span>);
<a name="3613"></a>
<a name="3614"></a>        SetTraderUpdate();
<a name="3615"></a>
<a name="3616"></a>        return false;
<a name="3617"></a>    }
<a name="3618"></a>
<a name="3619"></a>    <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span> = <span class="source_type">int</span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span>-Price);
<a name="3620"></a>    AM.AddAmmo(<span class="source_type">c</span>);
<a name="3621"></a>    if( DBShotty != none )
<a name="3622"></a>    {
<a name="3623"></a>        DBShotty.AmmoPickedUp();
<a name="3624"></a>    }
<a name="3625"></a>
<a name="3626"></a>    SetTraderUpdate();
<a name="3627"></a>
<a name="3628"></a>    return true;
<a name="3629"></a>}
<a name="3630"></a>
<a name="3631"></a>function ServerSellAmmo( <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../engine/ammunition.html" class="source">Ammunition</a></span>&gt; <span class="source_type">AClass</span> )
<a name="3632"></a>{
<a name="3633"></a>    local <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> <span class="source_type">I</span>;
<a name="3634"></a>    local <span class="source_type">float</span> Price;
<a name="3635"></a>    local <span class="source_type"><a href="../engine/ammunition.html" class="source">Ammunition</a></span> AM;
<a name="3636"></a>    local <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span> KW;
<a name="3637"></a>    local <span class="source_type">int</span> <span class="source_type">c</span>;
<a name="3638"></a>
<a name="3639"></a>    if( !CanBuyNow() || <span class="source_type">AClass</span>==None )
<a name="3640"></a>        Return;
<a name="3641"></a>    For( <span class="source_type">I</span>=<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; <span class="source_type">I</span>!=None; <span class="source_type">I</span>=<span class="source_type">I</span>.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="3642"></a>    {
<a name="3643"></a>        if( <span class="source_type">I</span>.<span class="source_type">Class</span>==<span class="source_type">AClass</span> )
<a name="3644"></a>            AM = <span class="source_type"><a href="../engine/ammunition.html" class="source">Ammunition</a></span>(<span class="source_type">I</span>);
<a name="3645"></a>        else if( KW==None && <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type">I</span>)!=None && (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>(<span class="source_type">I</span>).AmmoClass[<span class="source_int">0</span>]==<span class="source_type">AClass</span> || <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>(<span class="source_type">I</span>).AmmoClass[<span class="source_int">1</span>]==<span class="source_type">AClass</span>) )
<a name="3646"></a>            KW = <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type">I</span>);
<a name="3647"></a>    }
<a name="3648"></a>    if( (AM==None && KW==None) || AM.AmmoAmount==AM.MaxAmmo )
<a name="3649"></a>        Return;
<a name="3650"></a>    Price = <span class="source_type">Class</span>&lt;<span class="source_type"><a href="../kfmod/kfweaponpickup.html" class="source">KFWeaponPickup</a></span>&gt;(KW.PickupClass).Default.AmmoCost; <span class="source_comment">// Clip price.
</span><a name="3651"></a>    <span class="source_type">c</span> = KW.Default.MagCapacity;
<a name="3652"></a>    if( <span class="source_type">c</span>&gt;AM.AmmoAmount )
<a name="3653"></a>        <span class="source_type">c</span> = AM.AmmoAmount;
<a name="3654"></a>    Price = <span class="source_type">float</span>(<span class="source_type">c</span>)/<span class="source_type">float</span>(KW.Default.MagCapacity)*Price*<span class="source_int">0.75</span>;
<a name="3655"></a>    <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">Score</span>+=Price;
<a name="3656"></a>    AM.AmmoAmount-=<span class="source_type">c</span>;
<a name="3657"></a>
<a name="3658"></a>    SetTraderUpdate();
<a name="3659"></a>}
<a name="3660"></a>
<a name="3661"></a>simulated function SetTraderUpdate()
<a name="3662"></a>{
<a name="3663"></a>    if ( <span class="source_type"><a href="../kfmod/kfplayercontroller.html" class="source">KFPlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none )
<a name="3664"></a>    {
<a name="3665"></a>        <span class="source_type"><a href="../kfmod/kfplayercontroller.html" class="source">KFPlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).DoTraderUpdate();
<a name="3666"></a>    }
<a name="3667"></a>}
<a name="3668"></a>
<a name="3669"></a><span class="source_comment">// Allow players spawn on top of each other.
</span><a name="3670"></a>event <span class="source_type">bool</span> EncroachingOn( <span class="source_type"><a href="../engine/actor.html" class="source">actor</a></span> <span class="source_type">Other</span> )
<a name="3671"></a>{
<a name="3672"></a>    if ( <span class="source_type">Other</span>.bWorldGeometry || <span class="source_type">Other</span>.bBlocksTeleport )
<a name="3673"></a>        return true;
<a name="3674"></a>
<a name="3675"></a>    if ( (<span class="source_type"><a href="../engine/vehicle.html" class="source">Vehicle</a></span>(<span class="source_type">Other</span>) != None) && (<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != None) && <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.IsA(<span class="source_name">'Translauncher'</span>) )
<a name="3676"></a>        return true;
<a name="3677"></a>
<a name="3678"></a>    return false;
<a name="3679"></a>}
<a name="3680"></a>event EncroachedBy( <span class="source_type"><a href="../engine/actor.html" class="source">actor</a></span> <span class="source_type">Other</span> )
<a name="3681"></a>{
<a name="3682"></a>    if ( <span class="source_type"><a href="../engine/pawn.html" class="source">Pawn</a></span>(<span class="source_type">Other</span>)!=None && <span class="source_type"><a href="../engine/vehicle.html" class="source">Vehicle</a></span>(<span class="source_type">Other</span>)==None && <span class="source_type"><a href="../kfmod/kfpawn.html" class="source">KFPawn</a></span>(<span class="source_type">Other</span>)==None )
<a name="3683"></a>        gibbedBy(<span class="source_type">Other</span>);
<a name="3684"></a>}
<a name="3685"></a>
<a name="3686"></a>function <span class="source_type">name</span> GetWeaponBoneFor(<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> <span class="source_type">I</span>)
<a name="3687"></a>{
<a name="3688"></a>     return <span class="source_name">'WeaponR_Bone'</span>;
<a name="3689"></a>}
<a name="3690"></a>
<a name="3691"></a>function <span class="source_type">name</span> GetOffhandBoneFor(<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> <span class="source_type">I</span>)
<a name="3692"></a>{
<a name="3693"></a>     return <span class="source_name">'WeaponL_Bone'</span>;
<a name="3694"></a>}
<a name="3695"></a>
<a name="3696"></a>
<a name="3697"></a>simulated function SetWeaponAttachment(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> NewAtt)
<a name="3698"></a>{
<a name="3699"></a>    local <span class="source_type"><a href="../kfmod/kfweaponattachment.html" class="source">KFWeaponAttachment</a></span> KFWeapAttach;
<a name="3700"></a>    local <span class="source_type"><a href="../kfmod/dualiesattachment.html" class="source">DualiesAttachment</a></span> DualiesAttach;
<a name="3701"></a>    local <span class="source_type">int</span> <span class="source_type">i</span>;
<a name="3702"></a>
<a name="3703"></a>    <span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span> = NewAtt;
<a name="3704"></a>    KFWeapAttach =  <span class="source_type"><a href="../kfmod/kfweaponattachment.html" class="source">KFWeaponAttachment</a></span>(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>);
<a name="3705"></a>    DualiesAttach = <span class="source_type"><a href="../kfmod/dualiesattachment.html" class="source">DualiesAttachment</a></span>(<span class="source_type"><a href="../engine/weaponattachment.html" class="source">WeaponAttachment</a></span>);
<a name="3706"></a>
<a name="3707"></a>    <span class="source_comment">// For remote clients set the brother class for dualies
</span><a name="3708"></a>    if( <span class="source_type">Level</span>.NetMode == NM_Client && DualiesAttach != none )
<a name="3709"></a>    {
<a name="3710"></a>        for( <span class="source_type">i</span> = <span class="source_int">0</span>; <span class="source_type">i</span> &lt; Attached.Length; <span class="source_type">i</span>++ )
<a name="3711"></a>        {
<a name="3712"></a>            if( Attached[<span class="source_type">i</span>] == None )
<a name="3713"></a>                continue;
<a name="3714"></a>
<a name="3715"></a>            if( <span class="source_type"><a href="../kfmod/dualiesattachment.html" class="source">DualiesAttachment</a></span>(Attached[<span class="source_type">i</span>]) != none && DualiesAttach != Attached[<span class="source_type">i</span>] )
<a name="3716"></a>            {
<a name="3717"></a>                DualiesAttach.brother = <span class="source_type"><a href="../kfmod/dualiesattachment.html" class="source">DualiesAttachment</a></span>(Attached[<span class="source_type">i</span>]);
<a name="3718"></a>                <span class="source_type"><a href="../kfmod/dualiesattachment.html" class="source">DualiesAttachment</a></span>(Attached[<span class="source_type">i</span>]).brother = DualiesAttach;
<a name="3719"></a>                break;
<a name="3720"></a>            }
<a name="3721"></a>        }
<a name="3722"></a>    }
<a name="3723"></a>
<a name="3724"></a>    if( KFWeapAttach != none )
<a name="3725"></a>    {
<a name="3726"></a>        MovementAnims[<span class="source_int">0</span>]= KFWeapAttach.MovementAnims[<span class="source_int">0</span>];
<a name="3727"></a>        MovementAnims[<span class="source_int">1</span>]= KFWeapAttach.MovementAnims[<span class="source_int">1</span>];
<a name="3728"></a>        MovementAnims[<span class="source_int">2</span>]= KFWeapAttach.MovementAnims[<span class="source_int">2</span>];
<a name="3729"></a>        MovementAnims[<span class="source_int">3</span>]= KFWeapAttach.MovementAnims[<span class="source_int">3</span>];
<a name="3730"></a>        TurnLeftAnim = KFWeapAttach.TurnLeftAnim;
<a name="3731"></a>        TurnRightAnim = KFWeapAttach.TurnRightAnim;
<a name="3732"></a>        SwimAnims[<span class="source_int">0</span>]= KFWeapAttach.SwimAnims[<span class="source_int">0</span>];
<a name="3733"></a>        SwimAnims[<span class="source_int">1</span>]= KFWeapAttach.SwimAnims[<span class="source_int">1</span>];
<a name="3734"></a>        SwimAnims[<span class="source_int">2</span>]= KFWeapAttach.SwimAnims[<span class="source_int">2</span>];
<a name="3735"></a>        SwimAnims[<span class="source_int">3</span>]= KFWeapAttach.SwimAnims[<span class="source_int">3</span>];
<a name="3736"></a>        CrouchAnims[<span class="source_int">0</span>]= KFWeapAttach.CrouchAnims[<span class="source_int">0</span>];
<a name="3737"></a>        CrouchAnims[<span class="source_int">1</span>]= KFWeapAttach.CrouchAnims[<span class="source_int">1</span>];
<a name="3738"></a>        CrouchAnims[<span class="source_int">2</span>]= KFWeapAttach.CrouchAnims[<span class="source_int">2</span>];
<a name="3739"></a>        CrouchAnims[<span class="source_int">3</span>]= KFWeapAttach.CrouchAnims[<span class="source_int">3</span>];
<a name="3740"></a>        WalkAnims[<span class="source_int">0</span>]= KFWeapAttach.WalkAnims[<span class="source_int">0</span>];
<a name="3741"></a>        WalkAnims[<span class="source_int">1</span>]= KFWeapAttach.WalkAnims[<span class="source_int">1</span>];
<a name="3742"></a>        WalkAnims[<span class="source_int">2</span>]= KFWeapAttach.WalkAnims[<span class="source_int">2</span>];
<a name="3743"></a>        WalkAnims[<span class="source_int">3</span>]= KFWeapAttach.WalkAnims[<span class="source_int">3</span>];
<a name="3744"></a>        AirAnims[<span class="source_int">0</span>]= KFWeapAttach.AirAnims[<span class="source_int">0</span>];
<a name="3745"></a>        AirAnims[<span class="source_int">1</span>]= KFWeapAttach.AirAnims[<span class="source_int">1</span>];
<a name="3746"></a>        AirAnims[<span class="source_int">2</span>]= KFWeapAttach.AirAnims[<span class="source_int">2</span>];
<a name="3747"></a>        AirAnims[<span class="source_int">3</span>]= KFWeapAttach.AirAnims[<span class="source_int">3</span>];
<a name="3748"></a>        TakeoffAnims[<span class="source_int">0</span>]= KFWeapAttach.TakeoffAnims[<span class="source_int">0</span>];
<a name="3749"></a>        TakeoffAnims[<span class="source_int">1</span>]= KFWeapAttach.TakeoffAnims[<span class="source_int">1</span>];
<a name="3750"></a>        TakeoffAnims[<span class="source_int">2</span>]= KFWeapAttach.TakeoffAnims[<span class="source_int">2</span>];
<a name="3751"></a>        TakeoffAnims[<span class="source_int">3</span>]= KFWeapAttach.TakeoffAnims[<span class="source_int">3</span>];
<a name="3752"></a>        LandAnims[<span class="source_int">0</span>]= KFWeapAttach.LandAnims[<span class="source_int">0</span>];
<a name="3753"></a>        LandAnims[<span class="source_int">1</span>]= KFWeapAttach.LandAnims[<span class="source_int">1</span>];
<a name="3754"></a>        LandAnims[<span class="source_int">2</span>]= KFWeapAttach.LandAnims[<span class="source_int">2</span>];
<a name="3755"></a>        LandAnims[<span class="source_int">3</span>]= KFWeapAttach.LandAnims[<span class="source_int">3</span>];
<a name="3756"></a>        DoubleJumpAnims[<span class="source_int">0</span>]= KFWeapAttach.DoubleJumpAnims[<span class="source_int">0</span>];
<a name="3757"></a>        DoubleJumpAnims[<span class="source_int">1</span>]= KFWeapAttach.DoubleJumpAnims[<span class="source_int">1</span>];
<a name="3758"></a>        DoubleJumpAnims[<span class="source_int">2</span>]= KFWeapAttach.DoubleJumpAnims[<span class="source_int">2</span>];
<a name="3759"></a>        DoubleJumpAnims[<span class="source_int">3</span>]= KFWeapAttach.DoubleJumpAnims[<span class="source_int">3</span>];
<a name="3760"></a>        DodgeAnims[<span class="source_int">0</span>]= KFWeapAttach.DodgeAnims[<span class="source_int">0</span>];
<a name="3761"></a>        DodgeAnims[<span class="source_int">1</span>]= KFWeapAttach.DodgeAnims[<span class="source_int">1</span>];
<a name="3762"></a>        DodgeAnims[<span class="source_int">2</span>]= KFWeapAttach.DodgeAnims[<span class="source_int">2</span>];
<a name="3763"></a>        DodgeAnims[<span class="source_int">3</span>]= KFWeapAttach.DodgeAnims[<span class="source_int">3</span>];
<a name="3764"></a>        AirStillAnim = KFWeapAttach.AirStillAnim;
<a name="3765"></a>        TakeoffStillAnim = KFWeapAttach.TakeoffStillAnim;
<a name="3766"></a>        CrouchTurnRightAnim = KFWeapAttach.CrouchTurnRightAnim;
<a name="3767"></a>        CrouchTurnLeftAnim = KFWeapAttach.CrouchTurnLeftAnim;
<a name="3768"></a>        IdleCrouchAnim = KFWeapAttach.IdleCrouchAnim;
<a name="3769"></a>        IdleSwimAnim = KFWeapAttach.IdleSwimAnim;
<a name="3770"></a>        IdleWeaponAnim = KFWeapAttach.IdleWeaponAnim;
<a name="3771"></a>        IdleRestAnim = KFWeapAttach.IdleRestAnim;
<a name="3772"></a>        IdleChatAnim = KFWeapAttach.IdleChatAnim;
<a name="3773"></a>        FireAnims[<span class="source_int">0</span>]=KFWeapAttach.FireAnims[<span class="source_int">0</span>];
<a name="3774"></a>        FireAnims[<span class="source_int">1</span>]=KFWeapAttach.FireAnims[<span class="source_int">1</span>];
<a name="3775"></a>        FireAnims[<span class="source_int">2</span>]=KFWeapAttach.FireAnims[<span class="source_int">2</span>];
<a name="3776"></a>        FireAnims[<span class="source_int">3</span>]=KFWeapAttach.FireAnims[<span class="source_int">3</span>];
<a name="3777"></a>        FireAltAnims[<span class="source_int">0</span>]=KFWeapAttach.FireAltAnims[<span class="source_int">0</span>];
<a name="3778"></a>        FireAltAnims[<span class="source_int">1</span>]=KFWeapAttach.FireAltAnims[<span class="source_int">1</span>];
<a name="3779"></a>        FireAltAnims[<span class="source_int">2</span>]=KFWeapAttach.FireAltAnims[<span class="source_int">2</span>];
<a name="3780"></a>        FireAltAnims[<span class="source_int">3</span>]=KFWeapAttach.FireAltAnims[<span class="source_int">3</span>];
<a name="3781"></a>        FireCrouchAnims[<span class="source_int">0</span>]=KFWeapAttach.FireCrouchAnims[<span class="source_int">0</span>];
<a name="3782"></a>        FireCrouchAnims[<span class="source_int">1</span>]=KFWeapAttach.FireCrouchAnims[<span class="source_int">1</span>];
<a name="3783"></a>        FireCrouchAnims[<span class="source_int">2</span>]=KFWeapAttach.FireCrouchAnims[<span class="source_int">2</span>];
<a name="3784"></a>        FireCrouchAnims[<span class="source_int">3</span>]=KFWeapAttach.FireCrouchAnims[<span class="source_int">3</span>];
<a name="3785"></a>        FireCrouchAltAnims[<span class="source_int">0</span>]=KFWeapAttach.FireCrouchAltAnims[<span class="source_int">0</span>];
<a name="3786"></a>        FireCrouchAltAnims[<span class="source_int">1</span>]=KFWeapAttach.FireCrouchAltAnims[<span class="source_int">1</span>];
<a name="3787"></a>        FireCrouchAltAnims[<span class="source_int">2</span>]=KFWeapAttach.FireCrouchAltAnims[<span class="source_int">2</span>];
<a name="3788"></a>        FireCrouchAltAnims[<span class="source_int">3</span>]=KFWeapAttach.FireCrouchAltAnims[<span class="source_int">3</span>];
<a name="3789"></a>        HitAnims[<span class="source_int">0</span>]=KFWeapAttach.HitAnims[<span class="source_int">0</span>];
<a name="3790"></a>        HitAnims[<span class="source_int">1</span>]=KFWeapAttach.HitAnims[<span class="source_int">1</span>];
<a name="3791"></a>        HitAnims[<span class="source_int">2</span>]=KFWeapAttach.HitAnims[<span class="source_int">2</span>];
<a name="3792"></a>        HitAnims[<span class="source_int">3</span>]=KFWeapAttach.HitAnims[<span class="source_int">3</span>];
<a name="3793"></a>        PostFireBlendStandAnim = KFWeapAttach.PostFireBlendStandAnim;
<a name="3794"></a>        PostFireBlendCrouchAnim = KFWeapAttach.PostFireBlendCrouchAnim;
<a name="3795"></a>    }
<a name="3796"></a>}
<a name="3797"></a>
<a name="3798"></a>simulated function PlayDirectionalHit(<span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> HitLoc)
<a name="3799"></a>{
<a name="3800"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">Vector</a></span> <span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>, <span class="source_type">Dir</span>;
<a name="3801"></a>
<a name="3802"></a>    if ( DrivenVehicle != None )
<a name="3803"></a>        return;
<a name="3804"></a>
<a name="3805"></a>    GetAxes(<span class="source_type">Rotation</span>, <span class="source_type">X</span>,<span class="source_type">Y</span>,<span class="source_type">Z</span>);
<a name="3806"></a>    HitLoc.<span class="source_type">Z</span> = Location.<span class="source_type">Z</span>;
<a name="3807"></a>
<a name="3808"></a>    <span class="source_comment">// random
</span><a name="3809"></a>    if ( VSize(Location - HitLoc) &lt; <span class="source_int">1.0</span> )
<a name="3810"></a>    {
<a name="3811"></a>        <span class="source_type">Dir</span> = VRand();
<a name="3812"></a>    }
<a name="3813"></a>    <span class="source_comment">// hit location based
</span><a name="3814"></a>    else
<a name="3815"></a>    {
<a name="3816"></a>        <span class="source_type">Dir</span> = -Normal(Location - HitLoc);
<a name="3817"></a>    }
<a name="3818"></a>
<a name="3819"></a>    if ( <span class="source_type">Dir</span> Dot <span class="source_type">X</span> &gt; <span class="source_int">0.7</span> || <span class="source_type">Dir</span> == vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">0</span>))
<a name="3820"></a>    {
<a name="3821"></a>        PlayAnim(HitAnims[<span class="source_int">0</span>],, <span class="source_int">0.1</span>);
<a name="3822"></a>    }
<a name="3823"></a>    else if ( <span class="source_type">Dir</span> Dot <span class="source_type">X</span> &lt; -<span class="source_int">0.7</span> )
<a name="3824"></a>    {
<a name="3825"></a>        PlayAnim(HitAnims[<span class="source_int">1</span>],, <span class="source_int">0.1</span>);
<a name="3826"></a>    }
<a name="3827"></a>    else if ( <span class="source_type">Dir</span> Dot <span class="source_type">Y</span> &gt; <span class="source_int">0</span> )
<a name="3828"></a>    {
<a name="3829"></a>        PlayAnim(HitAnims[<span class="source_int">3</span>],, <span class="source_int">0.1</span>);
<a name="3830"></a>    }
<a name="3831"></a>    else
<a name="3832"></a>    {
<a name="3833"></a>        PlayAnim(HitAnims[<span class="source_int">2</span>],, <span class="source_int">0.1</span>);
<a name="3834"></a>    }
<a name="3835"></a>}
<a name="3836"></a>
<a name="3837"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3838"></a><span class="source_comment">// FootStepping - overriden to support custom footstep volumes
</span><a name="3839"></a><span class="source_comment">//-----------------------------------------------------------------------------
</span><a name="3840"></a>simulated function FootStepping(<span class="source_type">int</span> Side)
<a name="3841"></a>{
<a name="3842"></a>    local <span class="source_type">int</span> SurfaceTypeID, <span class="source_type">i</span>;
<a name="3843"></a>    local <span class="source_type"><a href="../engine/actor.html" class="source">actor</a></span> <span class="source_type">A</span>;
<a name="3844"></a>    local <span class="source_type"><a href="../engine/material.html" class="source">material</a></span> FloorMat;
<a name="3845"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> HL,HN,Start,End,<span class="source_type">HitLocation</span>,<span class="source_type">HitNormal</span>;
<a name="3846"></a>    local <span class="source_type">float</span> FootVolumeMod;
<a name="3847"></a>
<a name="3848"></a>    SurfaceTypeID = <span class="source_int">0</span>;
<a name="3849"></a>    FootVolumeMod = <span class="source_int">1.0</span>;
<a name="3850"></a>
<a name="3851"></a>    for ( <span class="source_type">i</span>=<span class="source_int">0</span>; <span class="source_type">i</span>&lt;Touching.Length; <span class="source_type">i</span>++ )
<a name="3852"></a>        if ( ((<span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>(Touching[<span class="source_type">i</span>]) != None) && <span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>(Touching[<span class="source_type">i</span>]).bWaterVolume)
<a name="3853"></a>            || (<span class="source_type"><a href="../engine/fluidsurfaceinfo.html" class="source">FluidSurfaceInfo</a></span>(Touching[<span class="source_type">i</span>]) != None) )
<a name="3854"></a>        {
<a name="3855"></a>            PlaySound(<span class="source_type"><a href="../engine/sound.html" class="source">sound</a></span><span class="source_name">'Inf_Player.FootStepWaterDeep'</span>, SLOT_Interact, FootstepVolume * <span class="source_int">2</span>,, FootStepSoundRadius);
<a name="3856"></a>
<a name="3857"></a>            <span class="source_comment">// Play a water ring effect as you walk through the water
</span><a name="3858"></a>            if ( !<span class="source_type">Level</span>.bDropDetail && (<span class="source_type">Level</span>.DetailMode != DM_Low) && (<span class="source_type">Level</span>.NetMode != NM_DedicatedServer)
<a name="3859"></a>                && !Touching[<span class="source_type">i</span>].TraceThisActor(<span class="source_type">HitLocation</span>, <span class="source_type">HitNormal</span>,Location - CollisionHeight*vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1.1</span>), Location) )
<a name="3860"></a>            {
<a name="3861"></a>                    Spawn(<span class="source_type">class</span><span class="source_name">'WaterRingEmitter'</span>,,,<span class="source_type">HitLocation</span>,rot(<span class="source_int">16384</span>,<span class="source_int">0</span>,<span class="source_int">0</span>));
<a name="3862"></a>            }
<a name="3863"></a>
<a name="3864"></a>            return;
<a name="3865"></a>        }
<a name="3866"></a>
<a name="3867"></a>    <span class="source_comment">// Lets still play the sounds when walking slow, just play them quieter
</span><a name="3868"></a>    if ( bIsCrouched || bIsWalking )
<a name="3869"></a>    {
<a name="3870"></a>        FootVolumeMod = QuietFootStepVolume;
<a name="3871"></a>    }
<a name="3872"></a>
<a name="3873"></a>    if ( (Base!=None) && (!Base.IsA(<span class="source_name">'LevelInfo'</span>)) && (Base.SurfaceType!=<span class="source_int">0</span>) )
<a name="3874"></a>    {
<a name="3875"></a>        SurfaceTypeID = Base.SurfaceType;
<a name="3876"></a>    }
<a name="3877"></a>    else
<a name="3878"></a>    {
<a name="3879"></a>        Start = Location - Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>)*CollisionHeight;
<a name="3880"></a>        End = Start - Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">16</span>);
<a name="3881"></a>        <span class="source_type">A</span> = Trace(hl,hn,End,Start,false,,FloorMat);
<a name="3882"></a>        if (FloorMat !=None)
<a name="3883"></a>            SurfaceTypeID = FloorMat.SurfaceType;
<a name="3884"></a>    }
<a name="3885"></a>    PlaySound(SoundFootsteps[SurfaceTypeID], SLOT_Interact, (FootstepVolume * FootVolumeMod),,(FootStepSoundRadius * FootVolumeMod));
<a name="3886"></a>}
<a name="3887"></a>
<a name="3888"></a><span class="source_comment">// Footstep sound checking for non local player or non player bots
</span><a name="3889"></a><span class="source_comment">// This function is only called on non owned network clients or bots
</span><a name="3890"></a>simulated function CheckFootSteps(<span class="source_type">float</span> <span class="source_type">DeltaTime</span>)
<a name="3891"></a>{
<a name="3892"></a>    local <span class="source_type">float</span> Speed2D;
<a name="3893"></a>    local <span class="source_type">float</span> OldBobTime;
<a name="3894"></a>    local <span class="source_type">int</span> <span class="source_type">m</span>,<span class="source_type">n</span>;
<a name="3895"></a>
<a name="3896"></a>    OldBobTime = BobTime;
<a name="3897"></a>
<a name="3898"></a>    if (Physics == PHYS_Walking )
<a name="3899"></a>    {
<a name="3900"></a>        Speed2D = VSize(Velocity);
<a name="3901"></a>
<a name="3902"></a>        if ( Speed2D &lt; <span class="source_int">10</span> )
<a name="3903"></a>            BobTime += <span class="source_int">0.2</span> * <span class="source_type">DeltaTime</span>;
<a name="3904"></a>        else
<a name="3905"></a>            BobTime += <span class="source_type">DeltaTime</span> * (<span class="source_int">0.3</span> + <span class="source_int">0.7</span> * Speed2D/GroundSpeed);
<a name="3906"></a>    }
<a name="3907"></a>    else
<a name="3908"></a>    {
<a name="3909"></a>        BobTime = <span class="source_int">0</span>;
<a name="3910"></a>    }
<a name="3911"></a>
<a name="3912"></a>    if ( (Physics != PHYS_Walking) || (VSize(Velocity) &lt; <span class="source_int">10</span>) )
<a name="3913"></a>        return;
<a name="3914"></a>
<a name="3915"></a>    <span class="source_type">m</span> = <span class="source_type">int</span>(<span class="source_int">0.5</span> * Pi + <span class="source_int">9.0</span> * OldBobTime/Pi);
<a name="3916"></a>    <span class="source_type">n</span> = <span class="source_type">int</span>(<span class="source_int">0.5</span> * Pi + <span class="source_int">9.0</span> * BobTime/Pi);
<a name="3917"></a>
<a name="3918"></a>    if ( (<span class="source_type">m</span> != <span class="source_type">n</span>) && !bIsCrawling)
<a name="3919"></a>        FootStepping(<span class="source_int">0</span>);
<a name="3920"></a>}
<a name="3921"></a>
<a name="3922"></a>function CheckBob(<span class="source_type">float</span> <span class="source_type">DeltaTime</span>, <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> <span class="source_type">Y</span>)
<a name="3923"></a>{
<a name="3924"></a>    local <span class="source_type">float</span> Speed2D;
<a name="3925"></a>    local <span class="source_type">float</span> OldBobTime;
<a name="3926"></a>    local <span class="source_type">int</span> <span class="source_type">m</span>,<span class="source_type">n</span>;
<a name="3927"></a>    local <span class="source_type">float</span> UsedBobScaleModifier;
<a name="3928"></a>
<a name="3929"></a>    OldBobTime = BobTime;
<a name="3930"></a>
<a name="3931"></a>    Bob = FClamp(Bob, -<span class="source_int">0.01</span>, <span class="source_int">0.01</span>);
<a name="3932"></a>    UsedBobScaleModifier = BobScaleModifier;
<a name="3933"></a>
<a name="3934"></a>    <span class="source_comment">// Modify the amount of bob based on the movement state
</span><a name="3935"></a>    if( bIsCrouched )
<a name="3936"></a>    {
<a name="3937"></a>        UsedBobScaleModifier = <span class="source_int">2.5</span>;
<a name="3938"></a>    }
<a name="3939"></a>
<a name="3940"></a>    if (Physics == PHYS_Walking )
<a name="3941"></a>    {
<a name="3942"></a>        Speed2D = VSize(Velocity);
<a name="3943"></a>
<a name="3944"></a>        Speed2D *= BobSpeedModifier;
<a name="3945"></a>
<a name="3946"></a>        if ( Speed2D &lt; <span class="source_int">10</span> )
<a name="3947"></a>            BobTime += <span class="source_int">0.2</span> * <span class="source_type">DeltaTime</span>;
<a name="3948"></a>        else
<a name="3949"></a>            BobTime += <span class="source_type">DeltaTime</span> * (<span class="source_int">0.3</span> + <span class="source_int">0.7</span> * Speed2D/GroundSpeed);
<a name="3950"></a>
<a name="3951"></a>        WalkBob = <span class="source_type">Y</span> * (Bob * UsedBobScaleModifier) * Speed2D * sin(<span class="source_int">8</span> * BobTime);
<a name="3952"></a>        AppliedBob = AppliedBob * (<span class="source_int">1</span> - FMin(<span class="source_int">1</span>, <span class="source_int">16</span> * <span class="source_type">deltatime</span>));
<a name="3953"></a>        WalkBob.<span class="source_type">Z</span> = AppliedBob;
<a name="3954"></a>        if ( Speed2D &gt; <span class="source_int">10</span> )
<a name="3955"></a>            WalkBob.<span class="source_type">Z</span> = WalkBob.<span class="source_type">Z</span> + <span class="source_int">0.75</span> * (Bob * UsedBobScaleModifier) * Speed2D * sin(<span class="source_int">16</span> * BobTime);
<a name="3956"></a>        if ( LandBob &gt; <span class="source_int">0.01</span> )
<a name="3957"></a>        {
<a name="3958"></a>            AppliedBob += FMin(<span class="source_int">1</span>, <span class="source_int">16</span> * <span class="source_type">deltatime</span>) * LandBob;
<a name="3959"></a>            LandBob *= (<span class="source_int">1</span> - <span class="source_int">8</span>*<span class="source_type">Deltatime</span>);
<a name="3960"></a>        }
<a name="3961"></a>    }
<a name="3962"></a>    else if ( Physics == PHYS_Swimming )
<a name="3963"></a>    {
<a name="3964"></a>        Speed2D = Sqrt(Velocity.<span class="source_type">X</span> * Velocity.<span class="source_type">X</span> + Velocity.<span class="source_type">Y</span> * Velocity.<span class="source_type">Y</span>);
<a name="3965"></a>        WalkBob = <span class="source_type">Y</span> * Bob *  <span class="source_int">0.5</span> * Speed2D * sin(<span class="source_int">4.0</span> * <span class="source_type">Level</span>.TimeSeconds);
<a name="3966"></a>        WalkBob.<span class="source_type">Z</span> = Bob * <span class="source_int">1.5</span> * Speed2D * sin(<span class="source_int">8.0</span> * <span class="source_type">Level</span>.TimeSeconds);
<a name="3967"></a>    }
<a name="3968"></a>    else
<a name="3969"></a>    {
<a name="3970"></a>        BobTime = <span class="source_int">0</span>;
<a name="3971"></a>        WalkBob = WalkBob * (<span class="source_int">1</span> - FMin(<span class="source_int">1</span>, <span class="source_int">8</span> * <span class="source_type">deltatime</span>));
<a name="3972"></a>    }
<a name="3973"></a>
<a name="3974"></a>    if ( (Physics != PHYS_Walking) || (VSize(Velocity) &lt; <span class="source_int">10</span>)
<a name="3975"></a>        || ((<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != None) && <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).bBehindView) )
<a name="3976"></a>        return;
<a name="3977"></a>
<a name="3978"></a>    <span class="source_type">m</span> = <span class="source_type">int</span>(<span class="source_int">0.5</span> * Pi + <span class="source_int">9.0</span> * OldBobTime/Pi);
<a name="3979"></a>    <span class="source_type">n</span> = <span class="source_type">int</span>(<span class="source_int">0.5</span> * Pi + <span class="source_int">9.0</span> * BobTime/Pi);
<a name="3980"></a>
<a name="3981"></a>    if ( (<span class="source_type">m</span> != <span class="source_type">n</span>) )
<a name="3982"></a>        FootStepping(<span class="source_int">0</span>);
<a name="3983"></a>}
<a name="3984"></a>
<a name="3985"></a>function <span class="source_type"><a href="../engine/sound.html" class="source">Sound</a></span> GetSound(<span class="source_type"><a href="../xgame/xpawnsoundgroup.html" class="source">xPawnSoundGroup</a></span>.<span class="source_type"><a href="../xgame/xpawnsoundgroup.html#ESoundType" class="source">ESoundType</a></span> soundType)
<a name="3986"></a>{
<a name="3987"></a>    local <span class="source_type">int</span> SurfaceTypeID;
<a name="3988"></a>    local <span class="source_type"><a href="../engine/actor.html" class="source">actor</a></span> <span class="source_type">A</span>;
<a name="3989"></a>    local <span class="source_type"><a href="../core/object.html#Vector" class="source">vector</a></span> HL,HN,Start,End;
<a name="3990"></a>    local <span class="source_type"><a href="../engine/material.html" class="source">material</a></span> FloorMat;
<a name="3991"></a>
<a name="3992"></a>    if( SoundGroupClass == none )
<a name="3993"></a>    {
<a name="3994"></a>       return None;
<a name="3995"></a>    }
<a name="3996"></a>
<a name="3997"></a>    if( soundType == EST_Land || soundType == EST_Jump )
<a name="3998"></a>    {
<a name="3999"></a>        if ( (Base!=None) && (!Base.IsA(<span class="source_name">'LevelInfo'</span>)) && (Base.SurfaceType!=<span class="source_int">0</span>) )
<a name="4000"></a>        {
<a name="4001"></a>            SurfaceTypeID = Base.SurfaceType;
<a name="4002"></a>        }
<a name="4003"></a>        else
<a name="4004"></a>        {
<a name="4005"></a>            Start = Location - Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">1</span>)*CollisionHeight;
<a name="4006"></a>            End = Start - Vect(<span class="source_int">0</span>,<span class="source_int">0</span>,<span class="source_int">16</span>);
<a name="4007"></a>            <span class="source_type">A</span> = Trace(hl,hn,End,Start,false,,FloorMat);
<a name="4008"></a>            if (FloorMat !=None)
<a name="4009"></a>                SurfaceTypeID = FloorMat.SurfaceType;
<a name="4010"></a>        }
<a name="4011"></a>    }
<a name="4012"></a>
<a name="4013"></a>    return SoundGroupClass.static.GetSound(soundType, SurfaceTypeID);
<a name="4014"></a>}
<a name="4015"></a>
<a name="4016"></a><span class="source_comment">/* Quickly select syring, alt fire once, select old weapon again */</span>
<a name="4017"></a>simulated exec function QuickHeal()
<a name="4018"></a>{
<a name="4019"></a>    local <span class="source_type"><a href="../kfmod/syringe.html" class="source">Syringe</a></span> <span class="source_type">S</span>;
<a name="4020"></a>    local <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> <span class="source_type">I</span>;
<a name="4021"></a>    local <span class="source_type">byte</span> <span class="source_type">C</span>;
<a name="4022"></a>
<a name="4023"></a>    if ( Health&gt;=HealthMax )
<a name="4024"></a>        return;
<a name="4025"></a>    for( <span class="source_type">I</span>=<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; (<span class="source_type">I</span>!=None && <span class="source_type">C</span>++&lt;<span class="source_int">250</span>); <span class="source_type">I</span>=<span class="source_type">I</span>.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="4026"></a>    {
<a name="4027"></a>        <span class="source_type">S</span> = <span class="source_type"><a href="../kfmod/syringe.html" class="source">Syringe</a></span>(<span class="source_type">I</span>);
<a name="4028"></a>        if( <span class="source_type">S</span>!=None )
<a name="4029"></a>            break;
<a name="4030"></a>    }
<a name="4031"></a>    if ( <span class="source_type">S</span> == none )
<a name="4032"></a>        return;
<a name="4033"></a>
<a name="4034"></a>    if ( <span class="source_type">S</span>.ChargeBar() &lt; <span class="source_int">0.95</span> )
<a name="4035"></a>    {
<a name="4036"></a>        if ( <span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>) != none && <span class="source_type"><a href="../kfmod/hudkillingfloor.html" class="source">HUDKillingFloor</a></span>(<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).myHud) != none )
<a name="4037"></a>        {
<a name="4038"></a>            <span class="source_type"><a href="../kfmod/hudkillingfloor.html" class="source">HUDKillingFloor</a></span>(<span class="source_type"><a href="../engine/playercontroller.html" class="source">PlayerController</a></span>(<span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span>).myHud).ShowQuickSyringe();
<a name="4039"></a>        }
<a name="4040"></a>
<a name="4041"></a>        return; <span class="source_comment">// No can heal.
</span><a name="4042"></a>    }
<a name="4043"></a>
<a name="4044"></a>    bIsQuickHealing = <span class="source_int">1</span>;
<a name="4045"></a>    if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>==None )
<a name="4046"></a>    {
<a name="4047"></a>        PendingWeapon = <span class="source_type">S</span>;
<a name="4048"></a>        ChangedWeapon();
<a name="4049"></a>    }
<a name="4050"></a>    else if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>!=<span class="source_type">S</span> )
<a name="4051"></a>    {
<a name="4052"></a>        PendingWeapon = <span class="source_type">S</span>;
<a name="4053"></a>        <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.PutDown();
<a name="4054"></a>    }
<a name="4055"></a>    else <span class="source_comment">// Syringe already selected, just start healing.
</span><a name="4056"></a>    {
<a name="4057"></a>        bIsQuickHealing = <span class="source_int">0</span>;
<a name="4058"></a>        <span class="source_type">S</span>.HackClientStartFire();
<a name="4059"></a>    }
<a name="4060"></a>}
<a name="4061"></a>
<a name="4062"></a>simulated exec function ToggleFlashlight()
<a name="4063"></a>{
<a name="4064"></a>    local <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span> KFWeap;
<a name="4065"></a>
<a name="4066"></a>    if ( <span class="source_type"><a href="../engine/controller.html" class="source">Controller</a></span> == none )
<a name="4067"></a>    {
<a name="4068"></a>        return;
<a name="4069"></a>    }
<a name="4070"></a>
<a name="4071"></a>    if ( <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none && <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).bTorchEnabled )
<a name="4072"></a>    {
<a name="4073"></a>        <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.ClientStartFire(<span class="source_int">1</span>);
<a name="4074"></a>    }
<a name="4075"></a>    else
<a name="4076"></a>    {
<a name="4077"></a>        KFWeap = <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(FindInventoryType(<span class="source_type">class</span><span class="source_name">'Shotgun'</span>));
<a name="4078"></a>        if ( KFWeap == none )
<a name="4079"></a>        {
<a name="4080"></a>            KFWeap = <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(FindInventoryType(<span class="source_type">class</span><span class="source_name">'BenelliShotgun'</span>));
<a name="4081"></a>            if ( KFWeap == none )
<a name="4082"></a>            {
<a name="4083"></a>                KFWeap = <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(FindInventoryType(<span class="source_type">class</span><span class="source_name">'Dualies'</span>));
<a name="4084"></a>                if ( KFWeap == none || <span class="source_type"><a href="../kfmod/dualdeagle.html" class="source">DualDeagle</a></span>(KFWeap) != none || <span class="source_type"><a href="../kfmod/dual44magnum.html" class="source">Dual44Magnum</a></span>(KFWeap) != none
<a name="4085"></a>                    || <span class="source_type"><a href="../kfmod/dualmk23pistol.html" class="source">DualMK23Pistol</a></span>(KFWeap) != none || <span class="source_type"><a href="../kfmod/dualflarerevolver.html" class="source">DualFlareRevolver</a></span>(KFWeap) != none )
<a name="4086"></a>                {
<a name="4087"></a>                    KFWeap = <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(FindInventoryType(<span class="source_type">class</span><span class="source_name">'Single'</span>));
<a name="4088"></a>                }
<a name="4089"></a>            }
<a name="4090"></a>        }
<a name="4091"></a>
<a name="4092"></a>        if ( KFWeap != none )
<a name="4093"></a>        {
<a name="4094"></a>            KFWeap.bPendingFlashlight = true;
<a name="4095"></a>
<a name="4096"></a>            PendingWeapon = KFWeap;
<a name="4097"></a>
<a name="4098"></a>            if ( <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> != none )
<a name="4099"></a>            {
<a name="4100"></a>                <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>.PutDown();
<a name="4101"></a>            }
<a name="4102"></a>            else
<a name="4103"></a>            {
<a name="4104"></a>                ChangedWeapon();
<a name="4105"></a>            }
<a name="4106"></a>        }
<a name="4107"></a>    }
<a name="4108"></a>}
<a name="4109"></a>
<a name="4110"></a>function GiveWeapon(<span class="source_type">string</span> <span class="source_type">aClassName</span> )
<a name="4111"></a>{
<a name="4112"></a>    local <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>&gt; <span class="source_type">WeaponClass</span>;
<a name="4113"></a>    local <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> <span class="source_type">I</span>;
<a name="4114"></a>    local <span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span> NewWeapon;
<a name="4115"></a>    local <span class="source_type">bool</span> bHasDual9mms, bHasDualHCs, bHasDualRevolvers;
<a name="4116"></a>
<a name="4117"></a>    <span class="source_type">WeaponClass</span> = <span class="source_type">class</span>&lt;<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>&gt;(DynamicLoadObject(<span class="source_type">aClassName</span>, <span class="source_type">class</span><span class="source_name">'Class'</span>));
<a name="4118"></a>
<a name="4119"></a>    for ( <span class="source_type">I</span> = <span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span>; <span class="source_type">I</span> != none; <span class="source_type">I</span> = <span class="source_type">I</span>.<span class="source_type"><a href="../engine/inventory.html" class="source">Inventory</a></span> )
<a name="4120"></a>    {
<a name="4121"></a>        if( <span class="source_type">I</span>.<span class="source_type">Class</span> == <span class="source_type">WeaponClass</span> )
<a name="4122"></a>        {
<a name="4123"></a>            Return; <span class="source_comment">// Already has weapon.
</span><a name="4124"></a>        }
<a name="4125"></a>
<a name="4126"></a>        if ( <span class="source_type">I</span>.<span class="source_type">Class</span> == <span class="source_type">class</span><span class="source_name">'Dualies'</span> )
<a name="4127"></a>        {
<a name="4128"></a>            bHasDual9mms = true;
<a name="4129"></a>        }
<a name="4130"></a>        else if ( <span class="source_type">I</span>.<span class="source_type">Class</span> == <span class="source_type">class</span><span class="source_name">'DualDeagle'</span> || <span class="source_type">I</span>.<span class="source_type">Class</span> == <span class="source_type">class</span><span class="source_name">'GoldenDualDeagle'</span> )
<a name="4131"></a>        {
<a name="4132"></a>            bHasDualHCs = true;
<a name="4133"></a>        }
<a name="4134"></a>        else if ( <span class="source_type">I</span>.<span class="source_type">Class</span> == <span class="source_type">class</span><span class="source_name">'Dual44Magnum'</span> )
<a name="4135"></a>        {
<a name="4136"></a>            bHasDualRevolvers = true;
<a name="4137"></a>        }
<a name="4138"></a>    }
<a name="4139"></a>
<a name="4140"></a>    newWeapon = Spawn(<span class="source_type">WeaponClass</span>);
<a name="4141"></a>    if ( newWeapon != none )
<a name="4142"></a>    {
<a name="4143"></a>        newWeapon.GiveTo(self);
<a name="4144"></a>
<a name="4145"></a>        if ( <span class="source_type">WeaponClass</span> == <span class="source_type">class</span><span class="source_name">'Dualies'</span> || <span class="source_type">WeaponClass</span> == <span class="source_type">class</span><span class="source_name">'DualDeagle'</span> || <span class="source_type">WeaponClass</span> == <span class="source_type">class</span><span class="source_name">'GoldenDualDeagle'</span> || <span class="source_type">WeaponClass</span> == <span class="source_type">class</span><span class="source_name">'Dual44Magnum'</span> )
<a name="4146"></a>        {
<a name="4147"></a>            <span class="source_type"><a href="../roengine/kfsteamstatsandachievements.html" class="source">KFSteamStatsAndAchievements</a></span>(<span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.SteamStatsAndAchievements).OnDualsAddedToInventory(bHasDual9mms, bHasDualHCs, bHasDualRevolvers);
<a name="4148"></a>        }
<a name="4149"></a>
<a name="4150"></a>        if ( <span class="source_type"><a href="../kfmod/kfgametype.html" class="source">KFGameType</a></span>(<span class="source_type">Level</span>.Game) != none )
<a name="4151"></a>        {
<a name="4152"></a>            <span class="source_type"><a href="../kfmod/kfgametype.html" class="source">KFGameType</a></span>(<span class="source_type">Level</span>.Game).WeaponSpawned(newWeapon);
<a name="4153"></a>        }
<a name="4154"></a>    }
<a name="4155"></a>}
<a name="4156"></a>
<a name="4157"></a>function <span class="source_type">bool</span> DoJump( <span class="source_type">bool</span> <span class="source_type">bUpdating</span> )
<a name="4158"></a>{
<a name="4159"></a>    if ( Super.DoJump(<span class="source_type">bUpdating</span>) )
<a name="4160"></a>    {
<a name="4161"></a>        <span class="source_comment">// Take you out of ironsights if you jump on a non-lowgrav map
</span><a name="4162"></a>        if( <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>) != none && <span class="source_type"><a href="../engine/physicsvolume.html" class="source">PhysicsVolume</a></span>.Gravity.<span class="source_type">Z</span> &lt;= <span class="source_type">class</span><span class="source_name">'PhysicsVolume'</span>.default.Gravity.<span class="source_type">Z</span> )
<a name="4163"></a>        {
<a name="4164"></a>            <span class="source_type"><a href="../kfmod/kfweapon.html" class="source">KFWeapon</a></span>(<span class="source_type"><a href="../engine/weapon.html" class="source">Weapon</a></span>).ForceZoomOutTime = <span class="source_type">Level</span>.TimeSeconds + <span class="source_int">0.01</span>;
<a name="4165"></a>        }
<a name="4166"></a>        return true;
<a name="4167"></a>    }
<a name="4168"></a>    return false;
<a name="4169"></a>}
<a name="4170"></a>
<a name="4171"></a>function <span class="source_type">string</span> GetPlayerName()
<a name="4172"></a>{
<a name="4173"></a>    if( <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span> != none )
<a name="4174"></a>    {
<a name="4175"></a>        return <span class="source_type"><a href="../engine/playerreplicationinfo.html" class="source">PlayerReplicationInfo</a></span>.<span class="source_type">PlayerName</span>;
<a name="4176"></a>    }
<a name="4177"></a>
<a name="4178"></a>    return <span class="source_string">""</span>;
<a name="4179"></a>}
<a name="4180"></a>
<a name="4181"></a>defaultproperties
<a name="4182"></a>{
<a name="4183"></a>     GibGroupClass=<span class="source_type">Class</span><span class="source_name">'KFMod.KFHumanGibGroup'</span>
<a name="4184"></a>     bCanBeHealed=True
<a name="4185"></a>     BileFrequency=<span class="source_int">0.500000</span>
<a name="4186"></a>     BurnEffect=<span class="source_type">Class</span><span class="source_name">'KFMod.KFMonsterFlame'</span>
<a name="4187"></a>     bDetailedShadows=True
<a name="4188"></a>     bRealDeathType=True
<a name="4189"></a>     bDoAdjustFeet=True
<a name="4190"></a>     FireAnims(<span class="source_int">0</span>)=<span class="source_string">"Fire_Bullpup"</span>
<a name="4191"></a>     FireAnims(<span class="source_int">1</span>)=<span class="source_string">"Fire_Bullpup"</span>
<a name="4192"></a>     FireAnims(<span class="source_int">2</span>)=<span class="source_string">"Fire_Bullpup"</span>
<a name="4193"></a>     FireAnims(<span class="source_int">3</span>)=<span class="source_string">"Fire_Bullpup"</span>
<a name="4194"></a>     FireAltAnims(<span class="source_int">0</span>)=<span class="source_string">"Fire_Bullpup"</span>
<a name="4195"></a>     FireAltAnims(<span class="source_int">1</span>)=<span class="source_string">"Fire_Bullpup"</span>
<a name="4196"></a>     FireAltAnims(<span class="source_int">2</span>)=<span class="source_string">"Fire_Bullpup"</span>
<a name="4197"></a>     FireAltAnims(<span class="source_int">3</span>)=<span class="source_string">"Fire_Bullpup"</span>
<a name="4198"></a>     FireCrouchAnims(<span class="source_int">0</span>)=<span class="source_string">"CHFire_BullPup"</span>
<a name="4199"></a>     FireCrouchAnims(<span class="source_int">1</span>)=<span class="source_string">"CHFire_BullPup"</span>
<a name="4200"></a>     FireCrouchAnims(<span class="source_int">2</span>)=<span class="source_string">"CHFire_BullPup"</span>
<a name="4201"></a>     FireCrouchAnims(<span class="source_int">3</span>)=<span class="source_string">"CHFire_BullPup"</span>
<a name="4202"></a>     FireCrouchAltAnims(<span class="source_int">0</span>)=<span class="source_string">"CHFire_BullPup"</span>
<a name="4203"></a>     FireCrouchAltAnims(<span class="source_int">1</span>)=<span class="source_string">"CHFire_BullPup"</span>
<a name="4204"></a>     FireCrouchAltAnims(<span class="source_int">2</span>)=<span class="source_string">"CHFire_BullPup"</span>
<a name="4205"></a>     FireCrouchAltAnims(<span class="source_int">3</span>)=<span class="source_string">"CHFire_BullPup"</span>
<a name="4206"></a>     HitAnims(<span class="source_int">0</span>)=<span class="source_string">"HitF_Bullpup"</span>
<a name="4207"></a>     HitAnims(<span class="source_int">1</span>)=<span class="source_string">"HitB_Bullpup"</span>
<a name="4208"></a>     HitAnims(<span class="source_int">2</span>)=<span class="source_string">"HitL_Bullpup"</span>
<a name="4209"></a>     HitAnims(<span class="source_int">3</span>)=<span class="source_string">"HitR_Bullpup"</span>
<a name="4210"></a>     PostFireBlendStandAnim=<span class="source_string">"Blend_Bullpup"</span>
<a name="4211"></a>     PostFireBlendCrouchAnim=<span class="source_string">"CHBlend_Bullpup"</span>
<a name="4212"></a>     FootStepSoundRadius=<span class="source_int">125.000000</span>
<a name="4213"></a>     QuietFootStepVolume=<span class="source_int">0.400000</span>
<a name="4214"></a>     SoundFootsteps(<span class="source_int">0</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepDefault'</span>
<a name="4215"></a>     SoundFootsteps(<span class="source_int">1</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepDirt'</span>
<a name="4216"></a>     SoundFootsteps(<span class="source_int">2</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepDirt'</span>
<a name="4217"></a>     SoundFootsteps(<span class="source_int">3</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepMetal'</span>
<a name="4218"></a>     SoundFootsteps(<span class="source_int">4</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepWood'</span>
<a name="4219"></a>     SoundFootsteps(<span class="source_int">5</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepGrass'</span>
<a name="4220"></a>     SoundFootsteps(<span class="source_int">6</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepDirt'</span>
<a name="4221"></a>     SoundFootsteps(<span class="source_int">7</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepDefault'</span>
<a name="4222"></a>     SoundFootsteps(<span class="source_int">8</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepDefault'</span>
<a name="4223"></a>     SoundFootsteps(<span class="source_int">9</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepWater'</span>
<a name="4224"></a>     SoundFootsteps(<span class="source_int">10</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepBrGlass'</span>
<a name="4225"></a>     SoundFootsteps(<span class="source_int">11</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepDefault'</span>
<a name="4226"></a>     SoundFootsteps(<span class="source_int">12</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepConc'</span>
<a name="4227"></a>     SoundFootsteps(<span class="source_int">13</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepWood'</span>
<a name="4228"></a>     SoundFootsteps(<span class="source_int">14</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepDefault'</span>
<a name="4229"></a>     SoundFootsteps(<span class="source_int">15</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepMetal'</span>
<a name="4230"></a>     SoundFootsteps(<span class="source_int">16</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepDefault'</span>
<a name="4231"></a>     SoundFootsteps(<span class="source_int">17</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepDefault'</span>
<a name="4232"></a>     SoundFootsteps(<span class="source_int">18</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepDefault'</span>
<a name="4233"></a>     SoundFootsteps(<span class="source_int">19</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_StepDefault'</span>
<a name="4234"></a>     BobSpeedModifier=<span class="source_int">0.900000</span>
<a name="4235"></a>     BobScaleModifier=<span class="source_int">1.000000</span>
<a name="4236"></a>     SeveredArmAttachScale=<span class="source_int">1.100000</span>
<a name="4237"></a>     SeveredLegAttachScale=<span class="source_int">1.100000</span>
<a name="4238"></a>     SeveredHeadAttachScale=<span class="source_int">1.100000</span>
<a name="4239"></a>     NeckSpurtEmitterClass=<span class="source_type">Class</span><span class="source_name">'KFMod.DismembermentJetHead'</span>
<a name="4240"></a>     LimbSpurtEmitterClass=<span class="source_type">Class</span><span class="source_name">'KFMod.DismembermentJetLimb'</span>
<a name="4241"></a>     SeveredArmAttachClass=<span class="source_type">Class</span><span class="source_name">'ROEffects.SeveredArmAttachment'</span>
<a name="4242"></a>     SeveredLegAttachClass=<span class="source_type">Class</span><span class="source_name">'ROEffects.SeveredLegAttachment'</span>
<a name="4243"></a>     SeveredHeadAttachClass=<span class="source_type">Class</span><span class="source_name">'ROEffects.SeveredHeadAttachment'</span>
<a name="4244"></a>     ProjectileBloodSplatClass=<span class="source_type">Class</span><span class="source_name">'ROEffects.ProjectileBloodSplat'</span>
<a name="4245"></a>     DetachedArmClass=<span class="source_type">Class</span><span class="source_name">'KFMod.SeveredArmSoldier'</span>
<a name="4246"></a>     DetachedLegClass=<span class="source_type">Class</span><span class="source_name">'KFMod.SeveredLegSoldier'</span>
<a name="4247"></a>     ObliteratedEffectClass=<span class="source_type">Class</span><span class="source_name">'ROEffects.PlayerObliteratedEmitter'</span>
<a name="4248"></a>     DecapitationSound=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_EnemyGlobalSnd.Generic_Decap'</span>
<a name="4249"></a>     DropCashMessageDelay=<span class="source_int">10.000000</span>
<a name="4250"></a>     ShieldStrengthMax=<span class="source_int">100.000000</span>
<a name="4251"></a>     Species=<span class="source_type">Class</span><span class="source_name">'KFMod.SPECIES_KFMaleHuman'</span>
<a name="4252"></a>     GruntVolume=<span class="source_int">0.500000</span>
<a name="4253"></a>     FootstepVolume=<span class="source_int">0.450000</span>
<a name="4254"></a>     SoundGroupClass=<span class="source_type">Class</span><span class="source_name">'KFMod.KFMaleSoundGroup'</span>
<a name="4255"></a>     IdleHeavyAnim=<span class="source_string">"Idle_Bullpup"</span>
<a name="4256"></a>     IdleRifleAnim=<span class="source_string">"Idle_Bullpup"</span>
<a name="4257"></a>     FireRootBone=<span class="source_string">"CHR_Spine1"</span>
<a name="4258"></a>     DeResTime=<span class="source_int">0.000000</span>
<a name="4259"></a>     DeResMat0=<span class="source_type"><a href="../engine/texture.html" class="source">Texture</a></span><span class="source_name">'KFCharacters.KFDeRez'</span>
<a name="4260"></a>     DeResMat1=<span class="source_type"><a href="../engine/texture.html" class="source">Texture</a></span><span class="source_name">'KFCharacters.KFDeRez'</span>
<a name="4261"></a>     DeResLiftVel=(Points=(,(InVal=<span class="source_int">0.000000</span>,OutVal=<span class="source_int">0.000000</span>),(InVal=<span class="source_int">0.000000</span>,OutVal=<span class="source_int">0.000000</span>)))
<a name="4262"></a>     DeResLiftSoftness=(Points=((OutVal=<span class="source_int">0.000000</span>),(InVal=<span class="source_int">0.000000</span>,OutVal=<span class="source_int">0.000000</span>),(InVal=<span class="source_int">0.000000</span>,OutVal=<span class="source_int">0.000000</span>)))
<a name="4263"></a>     DeResLateralFriction=<span class="source_int">0.000000</span>
<a name="4264"></a>     RagdollLifeSpan=<span class="source_int">9999.000000</span>
<a name="4265"></a>     RagDeathVel=<span class="source_int">75.000000</span>
<a name="4266"></a>     RagShootStrength=<span class="source_int">6000.000000</span>
<a name="4267"></a>     RagDeathUpKick=<span class="source_int">100.000000</span>
<a name="4268"></a>     RagImpactSounds(<span class="source_int">0</span>)=<span class="source_type"><a href="../engine/soundgroup.html" class="source">SoundGroup</a></span><span class="source_name">'KF_PlayerGlobalSnd.Player_BodyImpact'</span>
<a name="4269"></a>     RequiredEquipment(<span class="source_int">0</span>)=<span class="source_string">"none"</span>
<a name="4270"></a>     RequiredEquipment(<span class="source_int">1</span>)=<span class="source_string">"none"</span>
<a name="4271"></a>     bScriptPostRender=True
<a name="4272"></a>     MeleeRange=<span class="source_int">80.000000</span>
<a name="4273"></a>     GroundSpeed=<span class="source_int">240.000000</span>
<a name="4274"></a>     WaterSpeed=<span class="source_int">180.000000</span>
<a name="4275"></a>     AirSpeed=<span class="source_int">240.000000</span>
<a name="4276"></a>     JumpZ=<span class="source_int">300.000000</span>
<a name="4277"></a>     BaseEyeHeight=<span class="source_int">44.000000</span>
<a name="4278"></a>     EyeHeight=<span class="source_int">44.000000</span>
<a name="4279"></a>     CrouchRadius=<span class="source_int">20.000000</span>
<a name="4280"></a>     MovementAnims(<span class="source_int">0</span>)=<span class="source_string">"JogF_Bullpup"</span>
<a name="4281"></a>     MovementAnims(<span class="source_int">1</span>)=<span class="source_string">"JogB_Bullpup"</span>
<a name="4282"></a>     MovementAnims(<span class="source_int">2</span>)=<span class="source_string">"JogL_Bullpup"</span>
<a name="4283"></a>     MovementAnims(<span class="source_int">3</span>)=<span class="source_string">"JogR_Bullpup"</span>
<a name="4284"></a>     DodgeSpeedFactor=<span class="source_int">1.000000</span>
<a name="4285"></a>     DodgeSpeedZ=<span class="source_int">0.000000</span>
<a name="4286"></a>     SwimAnims(<span class="source_int">0</span>)=<span class="source_string">"WalkF"</span>
<a name="4287"></a>     SwimAnims(<span class="source_int">1</span>)=<span class="source_string">"WalkB"</span>
<a name="4288"></a>     SwimAnims(<span class="source_int">2</span>)=<span class="source_string">"WalkL"</span>
<a name="4289"></a>     SwimAnims(<span class="source_int">3</span>)=<span class="source_string">"WalkR"</span>
<a name="4290"></a>     CrouchAnims(<span class="source_int">0</span>)=<span class="source_string">"CHwalkF_BullPup"</span>
<a name="4291"></a>     CrouchAnims(<span class="source_int">1</span>)=<span class="source_string">"CHwalkB_BullPup"</span>
<a name="4292"></a>     CrouchAnims(<span class="source_int">2</span>)=<span class="source_string">"CHwalkL_BullPup"</span>
<a name="4293"></a>     CrouchAnims(<span class="source_int">3</span>)=<span class="source_string">"CHwalkR_BullPup"</span>
<a name="4294"></a>     WalkAnims(<span class="source_int">0</span>)=<span class="source_string">"WalkF_Bullpup"</span>
<a name="4295"></a>     WalkAnims(<span class="source_int">1</span>)=<span class="source_string">"WalkB_Bullpup"</span>
<a name="4296"></a>     WalkAnims(<span class="source_int">2</span>)=<span class="source_string">"WalkL_Bullpup"</span>
<a name="4297"></a>     WalkAnims(<span class="source_int">3</span>)=<span class="source_string">"WalkR_Bullpup"</span>
<a name="4298"></a>     AirAnims(<span class="source_int">1</span>)=<span class="source_string">"JumpF_Mid"</span>
<a name="4299"></a>     TakeoffAnims(<span class="source_int">1</span>)=<span class="source_string">"JumpF_Takeoff"</span>
<a name="4300"></a>     LandAnims(<span class="source_int">1</span>)=<span class="source_string">"JumpF_Land"</span>
<a name="4301"></a>     DodgeAnims(<span class="source_int">0</span>)=<span class="source_string">"JumpF_Takeoff"</span>
<a name="4302"></a>     DodgeAnims(<span class="source_int">1</span>)=<span class="source_string">"JumpF_Takeoff"</span>
<a name="4303"></a>     DodgeAnims(<span class="source_int">2</span>)=<span class="source_string">"JumpL_Takeoff"</span>
<a name="4304"></a>     DodgeAnims(<span class="source_int">3</span>)=<span class="source_string">"JumpR_Takeoff"</span>
<a name="4305"></a>     AirStillAnim=<span class="source_string">"JumpF_Mid"</span>
<a name="4306"></a>     TakeoffStillAnim=<span class="source_string">"JumpF_Takeoff"</span>
<a name="4307"></a>     CrouchTurnRightAnim=<span class="source_string">"CH_TurnR"</span>
<a name="4308"></a>     CrouchTurnLeftAnim=<span class="source_string">"CH_TurnL"</span>
<a name="4309"></a>     IdleCrouchAnim=<span class="source_string">"CHIdle_BullPup"</span>
<a name="4310"></a>     IdleWeaponAnim=<span class="source_string">"Idle_Bullpup"</span>
<a name="4311"></a>     IdleRestAnim=<span class="source_string">"Idle_Rifle"</span>
<a name="4312"></a>     RootBone=<span class="source_string">"CHR_Pelvis"</span>
<a name="4313"></a>     HeadBone=<span class="source_string">"CHR_Head"</span>
<a name="4314"></a>     SpineBone1=<span class="source_string">"CHR_Spine2"</span>
<a name="4315"></a>     SpineBone2=<span class="source_string">"CHR_Spine3"</span>
<a name="4316"></a>     HitPoints(<span class="source_int">0</span>)=(PointRadius=<span class="source_int">40.000000</span>,PointHeight=<span class="source_int">60.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_Pelvis"</span>,PointOffset=(<span class="source_type">Y</span>=-<span class="source_int">10.000000</span>))
<a name="4317"></a>     HitPoints(<span class="source_int">1</span>)=(PointRadius=<span class="source_int">6.500000</span>,PointHeight=<span class="source_int">8.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_Head"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">2.000000</span>,<span class="source_type">Y</span>=-<span class="source_int">2.000000</span>),DamageMultiplier=<span class="source_int">5.000000</span>,HitPointType=PHP_Head)
<a name="4318"></a>     HitPoints(<span class="source_int">2</span>)=(PointRadius=<span class="source_int">13.000000</span>,PointHeight=<span class="source_int">15.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_Spine3"</span>,PointOffset=(<span class="source_type">Y</span>=-<span class="source_int">5.000000</span>),DamageMultiplier=<span class="source_int">1.000000</span>,HitPointType=PHP_Torso)
<a name="4319"></a>     HitPoints(<span class="source_int">3</span>)=(PointRadius=<span class="source_int">12.000000</span>,PointHeight=<span class="source_int">11.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_Spine1"</span>,PointOffset=(<span class="source_type">X</span>=-<span class="source_int">3.000000</span>,<span class="source_type">Y</span>=-<span class="source_int">3.000000</span>),DamageMultiplier=<span class="source_int">1.000000</span>,HitPointType=PHP_Torso)
<a name="4320"></a>     HitPoints(<span class="source_int">4</span>)=(PointRadius=<span class="source_int">7.000000</span>,PointHeight=<span class="source_int">12.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_LThigh"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">18.000000</span>,<span class="source_type">Y</span>=<span class="source_int">1.000000</span>),DamageMultiplier=<span class="source_int">0.500000</span>,HitPointType=PHP_Leg)
<a name="4321"></a>     HitPoints(<span class="source_int">5</span>)=(PointRadius=<span class="source_int">7.000000</span>,PointHeight=<span class="source_int">12.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_RThigh"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">18.000000</span>,<span class="source_type">Y</span>=<span class="source_int">1.000000</span>),DamageMultiplier=<span class="source_int">0.500000</span>,HitPointType=PHP_Leg)
<a name="4322"></a>     HitPoints(<span class="source_int">6</span>)=(PointRadius=<span class="source_int">5.000000</span>,PointHeight=<span class="source_int">11.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_LArmUpper"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">8.000000</span>,<span class="source_type">Z</span>=<span class="source_int">1.000000</span>),DamageMultiplier=<span class="source_int">0.300000</span>,HitPointType=PHP_Arm)
<a name="4323"></a>     HitPoints(<span class="source_int">7</span>)=(PointRadius=<span class="source_int">5.000000</span>,PointHeight=<span class="source_int">11.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_RArmUpper"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">8.000000</span>,<span class="source_type">Z</span>=<span class="source_int">1.000000</span>),DamageMultiplier=<span class="source_int">0.300000</span>,HitPointType=PHP_Arm)
<a name="4324"></a>     HitPoints(<span class="source_int">8</span>)=(PointRadius=<span class="source_int">6.000000</span>,PointHeight=<span class="source_int">18.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_LCalf"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">15.000000</span>),DamageMultiplier=<span class="source_int">0.400000</span>,HitPointType=PHP_Leg)
<a name="4325"></a>     HitPoints(<span class="source_int">9</span>)=(PointRadius=<span class="source_int">6.000000</span>,PointHeight=<span class="source_int">18.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_RCalf"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">15.000000</span>),DamageMultiplier=<span class="source_int">0.400000</span>,HitPointType=PHP_Leg)
<a name="4326"></a>     HitPoints(<span class="source_int">10</span>)=(PointRadius=<span class="source_int">4.000000</span>,PointHeight=<span class="source_int">10.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_LArmForeArm"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">6.000000</span>),DamageMultiplier=<span class="source_int">0.200000</span>,HitPointType=PHP_Arm)
<a name="4327"></a>     HitPoints(<span class="source_int">11</span>)=(PointRadius=<span class="source_int">4.000000</span>,PointHeight=<span class="source_int">10.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_RArmForeArm"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">6.000000</span>),DamageMultiplier=<span class="source_int">0.200000</span>,HitPointType=PHP_Arm)
<a name="4328"></a>     HitPoints(<span class="source_int">12</span>)=(PointRadius=<span class="source_int">4.000000</span>,PointHeight=<span class="source_int">4.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_LArmPalm"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">5.000000</span>,<span class="source_type">Y</span>=<span class="source_int">2.000000</span>),DamageMultiplier=<span class="source_int">0.100000</span>,HitPointType=PHP_Hand)
<a name="4329"></a>     HitPoints(<span class="source_int">13</span>)=(PointRadius=<span class="source_int">4.000000</span>,PointHeight=<span class="source_int">4.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_RArmPalm"</span>,PointOffset=(<span class="source_type">X</span>=<span class="source_int">5.000000</span>,<span class="source_type">Y</span>=<span class="source_int">2.000000</span>),DamageMultiplier=<span class="source_int">0.100000</span>,HitPointType=PHP_Hand)
<a name="4330"></a>     HitPoints(<span class="source_int">14</span>)=(PointRadius=<span class="source_int">4.000000</span>,PointHeight=<span class="source_int">8.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_LToe1"</span>,DamageMultiplier=<span class="source_int">0.100000</span>,HitPointType=PHP_Foot)
<a name="4331"></a>     HitPoints(<span class="source_int">15</span>)=(PointRadius=<span class="source_int">4.000000</span>,PointHeight=<span class="source_int">8.000000</span>,PointScale=<span class="source_int">1.000000</span>,PointBone=<span class="source_string">"CHR_RToe1"</span>,DamageMultiplier=<span class="source_int">0.100000</span>,HitPointType=PHP_Foot)
<a name="4332"></a>     PrePivot=(<span class="source_type">Z</span>=<span class="source_int">0.000000</span>)
<a name="4333"></a>     AmbientGlow=<span class="source_int">0</span>
<a name="4334"></a>     bClientAnim=True
<a name="4335"></a>     bForceSkelUpdate=True
<a name="4336"></a>     CollisionRadius=<span class="source_int">20.000000</span>
<a name="4337"></a>     CollisionHeight=<span class="source_int">40.000000</span>
<a name="4338"></a>     bBlockKarma=True
<a name="4339"></a>     bBlockHitPointTraces=False
<a name="4340"></a>     Mass=<span class="source_int">400.000000</span>
<a name="4341"></a>}
<a name="4342"></a></pre></td></tr></table></div>
<hr />
<table class="header">
<tr class="header">
	<td class="header"><a href="../overview.html">Overview</a></td>
	<td class="header"><a href="../kfmod/kfmod-overview.html">Package</a></td>
	<td class="header"><a href="../kfmod/kfpawn.html">Class</a></td>
	<td class="header_hilight">Source</td>
	<td class="header"><a class="header" href="../classtree.html#KFPawn">Class tree</a></td>
	<td class="header"><a class="header" href="../glossary_A.html">Glossary</a></td>
	<td class="logo" rowspan="2">UnrealScript<br />Documentation</td>
</tr>
<tr>
	<td class="subheader" colspan="3"><a href="../Source_kfmod/kfonlinelostrigger.html">previous class</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="../Source_kfmod/kfpawnfootadjuster.html">next class</a></td>
	<td class="subheader" colspan="2"><a href="../index.html" target="_top">frames</a> &nbsp;&nbsp;&nbsp;&nbsp; <a href="" target="_top">no frames</a></td>
</tr>
</table>

<div class="stats">Class file time: Fri 13-10-2023 03:17:26.000 - Creation time: Fri 13-10-2023 03:19:03.895 - Created with <a href="http://wiki.beyondunreal.com/wiki/UnCodeX" target="_blank">UnCodeX</a></div>

</body>
</html>